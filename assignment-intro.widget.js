System.register(["@beyond-js/widgets@1.1.0/render","@beyond-js/kernel@0.1.9/bundle","@beyond-js/kernel@0.1.9/styles","@beyond-js/react-18-widgets@1.1.2/base","@aimpact/ailearn-sdk@1.0.0/core","@aimpact/ailearn-app@0.0.32/model/wrapper","@aimpact/chat@1.0.1/wrapper","@aimpact/chat@1.0.1/chat-control.widget","@beyond-js/reactive@1.1.12/model","@bgroup/media-manager@1.0.0/recorder","@aimpact/chat-sdk@1.0.0/voice","@aimpact/chat-sdk@1.0.0/session","react@18.2.0","@aimpact/ailearn-app@0.0.32/assignments/assessment.widget","@beyond-js/react-18-widgets@1.1.2/hooks","pragmate-ui@0.1.1/icons","pragmate-ui@0.1.1/components","pragmate-ui@0.1.1/toast","@bgroup/media-manager@1.0.0/audio-player","@aimpact/chat-sdk@1.0.0/widgets/markdown","@aimpact/chat-sdk@1.0.0/widgets/playable","@aimpact/ailearn-app@0.0.32/config","pragmate-ui@0.1.1/link","@aimpact/chat@1.0.1/shared/hooks","pragmate-ui@0.1.1/preload","pragmate-ui@0.1.1/alert","pragmate-ui@0.1.1/modal","pragmate-ui@0.1.1/image","react@18.2.0/jsx-runtime"],function(n,e){"use strict";var t,a,s,r,o,i,c,l,d,u,m,p,f,h,g,v,y,E,w,_,b,k,x,C,M,j,R,N,P,A,I;return n({Controller:void 0,AudioPlayer:void 0,RecordingButton:void 0}),{setters:[function(e){t=e},function(e){a=e},function(e){s=e},function(e){r=e},function(e){o=e},function(e){i=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){u=e},function(e){m=e},function(e){p=e},function(e){f=e},function(e){h=e},function(e){g=e},function(e){v=e},function(e){y=e},function(e){E=e},function(e){w=e},function(e){_=e},function(e){b=e},function(e){k=e},function(e){x=e},function(e){C=e},function(e){M=e},function(e){j=e},function(e){R=e},function(e){N=e},function(e){P=e}],execute:function(){I=a.Bundle,(A=new I({module:{vspecifier:"@aimpact/ailearn-app@0.0.32/assignment-intro",multibundle:!0},type:"widget"},e.meta.url).package()).dependencies.update([["@beyond-js/widgets/render",t],["@beyond-js/kernel/styles",s],["@beyond-js/react-18-widgets/base",r],["@aimpact/ailearn-sdk/core",o],["@aimpact/ailearn-app/model/wrapper",i],["@aimpact/chat/wrapper",c],["@aimpact/chat/chat-control.widget",l],["@beyond-js/reactive/model",d],["@bgroup/media-manager/recorder",u],["@aimpact/chat-sdk/voice",m],["@aimpact/chat-sdk/session",p],["react",f],["@aimpact/ailearn-app/assignments/assessment.widget",h],["@beyond-js/react-18-widgets/hooks",g],["pragmate-ui/icons",v],["pragmate-ui/components",y],["pragmate-ui/toast",E],["@bgroup/media-manager/audio-player",w],["@aimpact/chat-sdk/widgets/markdown",_],["@aimpact/chat-sdk/widgets/playable",b],["@aimpact/ailearn-app/config",k],["pragmate-ui/link",x],["@aimpact/chat/shared/hooks",C],["pragmate-ui/preload",M],["pragmate-ui/alert",j],["pragmate-ui/modal",R],["pragmate-ui/image",N],["react/jsx-runtime",P]]),brequire("@beyond-js/widgets/render").widgets.register([{name:"assignment-intro",attrs:["metadata"],vspecifier:"@aimpact/ailearn-app@0.0.32/assignment-intro.widget"}]),brequire("@beyond-js/kernel/styles").styles.register("@aimpact/ailearn-app@0.0.32/assignment-intro.widget"),(I=new Map).set("./controller",{hash:2786205,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0;var a=e("@beyond-js/react-18-widgets/base"),n=e("./views"),s=e("./store");class r extends a.ReactWidgetController{#store;createStore(){var e=JSON.parse(this.attributes.get("metadata"));return this.#store=new s.StoreManager(e),this.#store.on("change",this.listen),this.#store}listen=()=>{this.#store.storeReady&&this.widget.dispatchEvent(new CustomEvent("ready"))};get Widget(){return n.ChatIntro}}t.Controller=r}}),I.set("./store",{hash:884895855,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StoreManager=void 0;var a=e("@aimpact/ailearn-sdk/core"),n=e("@aimpact/ailearn-app/model/wrapper"),s=e("@aimpact/chat/wrapper"),r=e("@aimpact/chat/chat-control.widget"),o=e("@beyond-js/reactive/model"),i=e("@bgroup/media-manager/recorder"),c=e("@aimpact/chat-sdk/voice"),l=e("@aimpact/chat-sdk/session");let d=1;class u extends o.ReactiveModel{#lesson;get lesson(){return this.#lesson}#topic;get topic(){return this.#topic}#model;get model(){return this.#model}#links=[];get links(){return this.#links}#audioManager=new r.AudioManager(this);#introduction;get introduction(){return this.#introduction}get audioManager(){return this.#audioManager}#voice;get voice(){return this.#voice}#metadata;get metadata(){return this.#metadata}get chat(){return s.AppWrapper.currentChat}get userName(){return l.sessionWrapper.user.displayName}#recorder;get recorder(){return this.#recorder}#isTopic;get isTopic(){return!!this.#isTopic}#assessment;get assessment(){return this.#assessment}#storeReady=!1;get storeReady(){return this.#storeReady}#materials=new Map;get materials(){return this.#materials}#__instance=d;constructor(e){super(),d++,this.#metadata=e,this.#voice=new c.Voice({language:s.AppWrapper.language,rate:s.AppWrapper.audioSpeed}),s.AppWrapper.on("app.settings.change",this.#listenAppChanges),this.#metadata.activity?this.loadActivity():(this.#metadata.assignmentId||(this.#metadata.assignmentId=this.#metadata.sessionId),this.#recorder=new i.Recorder,this.reactiveProps(["loadReady"]),this.#assessment=new a.Assessment({assignmentId:e.sessionId}),this.loadReady=!1,e?this.load(this.metadata).then(()=>{this.ready=!0,this.loadReady=!0,this.#storeReady=!0,this.triggerEvent()}):(this.ready=!0,this.loadReady=!0,this.#storeReady=!0,this.triggerEvent()))}async loadActivity(){try{const t=new a.AssignmentActivity({id:this.#metadata.activity.id,assignmentId:this.#metadata.assignment.id});await(this.#model=t).isReady,await t.load({id:this.#metadata.activity.id,assignmentId:this.#metadata.assignment.id}),this.#voice.set({language:t.language}),this.ready=!0,this.loadReady=!0,this.#storeReady=!0,Object.keys(t.materials).forEach(e=>{this.#materials.set(e,t.materials[e])}),this.#process(),this.triggerEvent()}catch(e){console.error(e)}}#listenAppChanges=()=>{this.#voice.set({rate:s.AppWrapper.audioSpeed})};async load(e){e.lesson&&(await this.loadLesson(e.lesson),this.#model=this.#lesson),e.topic&&await this.loadTopic(e),await this.#process()}#process(){n.AiLearnWrapper.sessionModel=this.#model,n.AiLearnWrapper.sessionAssessment=this.#assessment,this.#materials.size?this.#introduction=this.#materials.get("introduction").replace("%1",l.sessionWrapper.user.displayName):console.warn("No materials found")}sendAssessment=async e=>{try{var t={audio:e};return this.#isTopic?t.topicId=this.#topic.id:t.lessonId=this.#lesson.id,this.#assessment.publish(t)}catch(e){console.error(e)}}}t.StoreManager=u}}),I.set("./views/content-manager",{hash:471717907,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ContentManager=function(){let{store:e,activeControl:t}=(0,o.useLessonIntroContext)();const[a,n]=r.default.useState(e.model);if((0,l.useBinder)([e],()=>n(e.model)),!e.model||!e.materials.size)return null;const s=a.chatIntroductions;return r.default.createElement("div",null,r.default.createElement(()=>{var e;return"content"===t?r.default.createElement(i.default,null):"selection"===t?(e=s.items.get("assessment").value.assessment[0],r.default.createElement(c.Selection,{assessments:e,questions:e.questions})):"spoken"===t?r.default.createElement(d.OralAsssessment,null):void 0},null))};var r=e("react"),o=e("./context"),i=e("./content"),c=e("@aimpact/ailearn-app/assignments/assessment.widget"),l=e("@beyond-js/react-18-widgets/hooks"),d=e("./spoken")}}),I.set("./views/content/actions/index",{hash:1741744978,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ContentControls=function({id:e,text:t,player:a}){const[n,s]=c.default.useState("stop"),[,r]=c.default.useState(!1),o=((0,d.useBinder)([a],()=>r(a.speaking)),(0,d.useBinder)([a],()=>{r(!1)},"on.finish"),"play"===n?"stop":"play"),i="play"===n?async({})=>{await a.stop(),s("stop"),r(!1)}:async({})=>{s("play"),a.positionToCut=0,await a.play(t,e)};return c.default.createElement("div",{className:"audio__actions"},c.default.createElement(l.Button,{onClick:i,"data-listen":"api",icon:o}))};var c=e("react"),l=e("pragmate-ui/components"),d=e("@beyond-js/react-18-widgets/hooks")}}),I.set("./views/content/index",{hash:336171064,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const{store:e,texts:t,visible:a}=(0,v.useLessonIntroContext)(),n=d.default.useRef(null),s=e.materials,r=s.has("article")?s.get("article"):void 0,o=s.has("synthesis")?s.get("synthesis"):void 0,i=e.introduction,c=`${f.default?.params.apis.ailearn}/activities/${e.model.id}/materials/article/audio`,l=e=>{var t=e.currentTarget;const a=e.currentTarget.dataset.element;e=n.current.querySelectorAll(".intro__pane"),t.closest(".badges__container").querySelectorAll(".badge").forEach(e=>e.classList.remove("active")),t.classList.add("active"),e.forEach(e=>{e.classList.remove("active"),e.dataset.element===a&&e.classList.add("active")})};return d.default.createElement("section",{className:"collapsible-content"+(a?" visible":"")},d.default.createElement(m.Markdown,{content:i}),d.default.createElement("section",{className:"intro-actions__container  badges__container"},d.default.createElement("div",{className:"audio-player"},d.default.createElement("audio",{controls:!0,preload:"metadata"},d.default.createElement("source",{src:c}),"Your browser does not support the audio element.")),d.default.createElement(u.ButtonGroup,{selected:0},d.default.createElement(u.Button,{"data-element":"synthesis",onClick:l},t.elements.synthesis),d.default.createElement(u.Button,{"data-element":"content",onClick:l},t.elements.content))),d.default.createElement("section",{className:"intro__panes",ref:n},d.default.createElement("article",{className:"intro__pane intro__synthesis active","data-element":"synthesis"},d.default.createElement(m.Markdown,{content:o})),d.default.createElement("article",{className:"intro__pane intro__synthesis","data-element":"content"},d.default.createElement("div",null,d.default.createElement(g.ContentControls,{id:"content",text:r,store:e,player:e.voice}),d.default.createElement("div",{className:"p1"},d.default.createElement(p.Playable,{player:e.voice,content:r,id:"content"}))))),d.default.createElement(h.Links,null))};var d=e("react"),u=e("pragmate-ui/components"),m=e("@aimpact/chat-sdk/widgets/markdown"),p=e("@aimpact/chat-sdk/widgets/playable"),f=e("@aimpact/ailearn-app/config"),h=e("./links"),g=e("./actions"),v=e("../context")}}),I.set("./views/content/links",{hash:1433600420,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Links=function(){var e=(0,n.useLessonIntroContext)().store;return e.chat.children?a.default.createElement("div",{className:"intro__actions actions flex-container"},e.chat.children.map(e=>{var t=r.default.params.baseUrl+"/chat/"+e.id;return a.default.createElement(s.Link,{key:t,href:t,className:"chat-link"},e.name)})):null};var a=e("react"),n=e("../context"),s=e("pragmate-ui/components"),r=e("@aimpact/ailearn-app/config")}}),I.set("./views/content/player",{hash:3008754464,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.TextToSpeech=void 0;var r=e("react"),o=e("../context"),e=({text:t})=>{const a=(0,o.useLessonIntroContext)().store,n="audio/mpeg",[e,s]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async()=>{var e=await a.voice.createBlobAudioFromText(t,n);s(e)})()},[]),r.default.createElement("div",null,r.default.createElement("audio",{controls:!0},r.default.createElement("source",{src:e,type:n})))};t.TextToSpeech=e,t.default=e}}),I.set("./views/content/topic-detail",{hash:2513435789,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({topic:e}){return a.default.createElement("div",{className:"topic"},a.default.createElement("h4",null,e.title),a.default.createElement("p",null,e.synthesis.content),a.default.createElement(n.Link,{className:"topic-navigation",href:"/chat/"+e.id},a.default.createElement(s.Icon,{icon:"chat"}),a.default.createElement("h5",null,"Ir al Tópico")))};var a=e("react"),n=e("pragmate-ui/link"),s=e("pragmate-ui/icons")}}),I.set("./views/context",{hash:3363470639,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useLessonIntroContext=t.LessonIntroContext=void 0;var a=e("react");const n=t.LessonIntroContext=a.default.createContext({});t.useLessonIntroContext=()=>a.default.useContext(n)}}),I.set("./views/header/TabButton",{hash:288045917,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TabButton=function({label:e,onClick:t,value:a}){return n.default.createElement(s.Button,{"data-view":a,variant:"primary",onClick:t},e)};var n=e("react"),s=e("pragmate-ui/components")}}),I.set("./views/header/index",{hash:2465022756,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var{visible:e,toggleVisibility:t,activeControl:a,model:n,texts:{header:s}}=(0,i.useLessonIntroContext)();return s.titles[a],r.default.createElement(r.default.Fragment,null,r.default.createElement("header",{className:"intro__header"},r.default.createElement("section",{className:"header__title flex-container"},r.default.createElement(o.Icon,{icon:"class",className:"circle lg logo"}),r.default.createElement("h3",null,n.title)),r.default.createElement("div",{className:"header__actions"},r.default.createElement(o.IconButton,{icon:"right",className:"md collapse-icon"+(e?" visible":""),onClick:t}))),n.description&&r.default.createElement("p",null,n.description))};var r=e("react"),o=e("pragmate-ui/icons"),i=e("../context")}}),I.set("./views/index",{hash:786320532,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ChatIntro=function({store:e}){const[t,a]=f.default.useState(!0),[n,s]=f.default.useState(e.storeReady),[r,o]=(0,v.useTexts)(h.module.specifier),[i,c]=f.default.useState("content"),l=((0,g.useBinder)([e],()=>s(e.storeReady&&e.loadReady)),f.default.useMemo(()=>({ready:r&&n&&e.loadReady,activeControl:i,updateView:e=>{c(e)},store:e,texts:o,model:e.model,visible:t,toggleVisibility:()=>a(!t)}),[r,n,e.loadReady,i,e,o,t]));return r&&n?f.default.createElement(m.LessonIntroContext.Provider,{value:l},f.default.createElement("article",{className:"lesson-intro"},f.default.createElement("section",{className:"intro-content"},f.default.createElement(u.default,null),f.default.createElement(d.ContentManager,null))),f.default.createElement("slot",null)):f.default.createElement(p.Preload,null)};var d=e("./content-manager"),u=e("./header"),m=e("./context"),p=e("./preload"),f=e("react"),h=e("beyond_context"),g=e("@beyond-js/react-18-widgets/hooks"),v=e("@aimpact/chat/shared/hooks")}}),I.set("./views/preload",{hash:3521073819,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Preload=function(){return a.default.createElement("div",{className:"lesson-intro"},a.default.createElement("section",{className:"intro-content"},a.default.createElement("header",{className:"intro__header"},a.default.createElement("section",{className:"header__title flex-container"},a.default.createElement(n.Icon,{className:"circle lg logo",icon:"class"}),a.default.createElement("h3",null,a.default.createElement(s.Preload,{width:"100px"}))))))};var a=e("react"),n=e("pragmate-ui/icons"),s=e("pragmate-ui/preload")}}),I.set("./views/spoken/AudioPlayer",{hash:2781382207,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioPlayer=function({src:e}){if(!e)return console.warn("not audio to process"),null;e=URL.createObjectURL(e);const t=a.default.useRef(null);return a.default.useEffect(()=>{const e=t.current;e.addEventListener("loadedmetadata",()=>{e.duration===1/0&&(e.currentTime=1e101,e.ontimeupdate=()=>{e.ontimeupdate=null,e.currentTime=0})})},[e]),e?a.default.createElement("div",{className:"audio-player"},a.default.createElement("audio",{controls:!0,preload:"metadata"},a.default.createElement("source",{src:e,type:"audio/mp3",ref:t}),"Your browser does not support the audio element.")):null};var a=e("react")}}),I.set("./views/spoken/analysis/competencies",{hash:118481483,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CompetenciesFeedback=function(){var e=(0,n.useRecorderContext)().store;return a.default.createElement(s.Markdown,{content:e.assessment.competenciesFeedback})};var a=e("react"),n=e("../context"),s=e("@aimpact/chat-sdk/widgets/markdown")}}),I.set("./views/spoken/analysis/index",{hash:3216807206,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Analysis=function(){const{texts:e,setView:t}=(0,l.useRecorderContext)(),[a,n]=i.default.useState("student"),s={teacher:d.TeacherFeedback,student:u.StudentFeedback,competencies:m.CompetenciesFeedback},r=s[a],o=e=>{n(e.currentTarget.dataset.view)};return i.default.createElement("div",{className:"assessment-analysis__container"},i.default.createElement("header",null,i.default.createElement("h3",null,e.analysisTitle),i.default.createElement("div",{className:"flex-container space-between"},i.default.createElement("section",null,i.default.createElement(c.ButtonGroup,{selected:0},i.default.createElement(c.Button,{"data-view":"student",onClick:o},e.feedback),i.default.createElement(c.Button,{"data-view":"competencies",onClick:o},e.competencies),i.default.createElement(c.Button,{"data-view":"teacher",onClick:o},e.analysis))),i.default.createElement(c.Button,{onClick:e=>{e.preventDefault(),t("recording")},variant:"primary"},e.redo))),i.default.createElement(r,null))};var i=e("react"),c=e("pragmate-ui/components"),l=e("../context"),d=e("./teacher"),u=e("./student"),m=e("./competencies")}}),I.set("./views/spoken/analysis/student",{hash:1317064032,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StudentFeedback=function(){var e=(0,n.useRecorderContext)().store;return a.default.createElement(s.Markdown,{content:e.assessment.feedback})};var a=e("react"),n=e("../context"),s=e("@aimpact/chat-sdk/widgets/markdown")}}),I.set("./views/spoken/analysis/teacher",{hash:1474432510,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TeacherFeedback=function(){var e=(0,n.useRecorderContext)().store;return a.default.createElement(a.default.Fragment,null,e.assessment.analysis.map((e,t)=>a.default.createElement("article",{key:e.subject.replace(" ",""),className:"assessment__analysis-item"},a.default.createElement("section",{className:"item__icon__container"},s.Faces[e.grade]),a.default.createElement("section",null,a.default.createElement("header",null,a.default.createElement("h3",null,e.subject)),a.default.createElement("p",null,e.evaluation)))))};var a=e("react"),n=e("../context"),s=e("@aimpact/ailearn-sdk/core")}}),I.set("./views/spoken/context",{hash:489382465,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useRecorderContext=t.RecorderContext=void 0;var a=e("react");const n=t.RecorderContext=a.default.createContext(null);t.useRecorderContext=()=>a.default.useContext(n)}}),I.set("./views/spoken/index",{hash:1628485481,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.OralAsssessment=function(){var{store:e,texts:{assessments:t}}=(0,l.useLessonIntroContext)(),[a,n]=i.default.useState(!1),[s,r]=i.default.useState(e.assessment.analysis.length?"analysis":"recording"),o=t.oralText?.replace("%1",e.userName),a={store:e,recorder:e.recorder,recording:a,setRecording:n,texts:t,audio:e.recorder.audio,setView:r,onSubmit:e=>{e.preventDefault()}},n="analysis"===s?d.Analysis:u.RecordingButton;return i.default.createElement("div",null,i.default.createElement(c.Alert,{type:"info"},o),i.default.createElement(m.RecorderContext.Provider,{value:a},i.default.createElement("div",{className:"recording__container flex-container flex-center"},i.default.createElement(n,null))))};var i=e("react"),c=e("pragmate-ui/alert"),l=e("../context"),d=e("./analysis"),u=e("./recording"),m=e("./context")}}),I.set("./views/spoken/recording",{hash:2915434314,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RecordingButton=void 0;var b=e("react"),k=e("pragmate-ui/components"),x=e("./context"),C=e("../context"),M=e("./timer"),j=e("./AudioPlayer"),R=e("pragmate-ui/modal"),N=e("pragmate-ui/image");t.RecordingButton=({disabled:e=!1})=>{const{texts:r,recorder:a,recording:n,setRecording:s,audio:t,setView:o}=(0,x.useRecorderContext)();var i=(0,C.useLessonIntroContext)().texts["permissions"];const[c,l]=b.default.useState(""),[d,u]=b.default.useState(!1),m=(0,C.useLessonIntroContext)().store,[p,f]=(0,b.useState)(!1),h=b.default.useRef(null);var g=!n&&t,v=n?"stop":g?"redo":"record",y=n?"stop":"mic",E="start"===c?async e=>{await a.stop(),s(!1),l("reset")}:async e=>{try{e.preventDefault();var t=!n;"granted"!==(await a.hasPermissions()).state&&f(!0),await a.record(),s(t),l("start")}catch(e){console.error("error in on play",e)}},w="recording-player__container"+(d?" is-sending":""),_=e=>{f(!1)};return b.default.createElement("section",{ref:h,className:w},b.default.createElement("div",{className:"recording-player__content"},b.default.createElement(M.Timer,{action:c}),p&&b.default.createElement(R.Modal,{open:!0,show:!0,onClose:_},b.default.createElement("h3",null,i.title),b.default.createElement(N.Image,{src:"/assets/permissions2.svg"}),b.default.createElement("p",null,i.description),b.default.createElement("footer",{className:"mt-15"},b.default.createElement(k.Button,{variant:"primary",onClick:_},i.button))),b.default.createElement(k.Button,{icon:y,onClick:E,disabled:e},r[v]),g&&b.default.createElement("div",{className:"recording__result-container"},b.default.createElement(j.AudioPlayer,{src:m.recorder.audio}),b.default.createElement(k.Button,{icon:"send",onClick:e=>{e.preventDefault(),u(!0),m.sendAssessment(t).then(e=>{o("analysis"),u(!1)}),setTimeout(()=>{const t=h.current.querySelector(".sending-message"),a=r.processMessages;let n=1,s;globalThis.setInterval(()=>{t.classList.remove("fade-out-up"),t.classList.add("fade-in-up"),setTimeout(()=>{t.classList.remove("fade-in-up"),t.classList.add("fade-out-up")},8e3),t.innerHTML=a[n];let e=".";s=setInterval(()=>{e="."===e?"..":".."===e?"...":".",t.innerHTML=a[n]+"<br>"+e},1e3),n===a.length-1&&(n=0),n++},8e3),globalThis.setTimeout(()=>{d&&u(!1)},45e3)},100)},variant:"primary"},r.send))),d&&b.default.createElement("div",{className:"sending__data"},b.default.createElement("h3",{className:"sending-message"},r.processMessages[0])))}}}),I.set("./views/spoken/timer/index",{hash:518301096,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=function({action:e}){var t=["restart","start"].includes(e),a=["restart","reset"].includes(e),[,t,a,,]=(0,s.useTimer)(t,a,"reset"===e),e=a.toString().padStart(2,"0"),a=t.toString().padStart(2,"0");return n.default.createElement("div",{className:"timer__container"},n.default.createElement("span",null,""+a),n.default.createElement("span",{className:"timer__separator"},":"),n.default.createElement("span",null,""+e))};var n=e("react"),s=e("./use-timer")}}),I.set("./views/spoken/timer/use-timer",{hash:1583638382,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useTimer=function(t,e,a=!0){const[n,s]=l(0),r=(d(()=>{let e;return a&&s(0),t&&(e=setInterval(()=>{s(e=>e+1)},10)),()=>{clearInterval(e)}},[t]),d(()=>{e&&s(0)},[e]),n%100),o=Math.floor(n/100%60),i=Math.floor(n/6e3%60),c=Math.floor(n/36e4);return[c,i,o,r]};const{useState:l,useEffect:d}=e("react").default}}),A.exports.descriptor=[{im:"./controller",from:"Controller",name:"Controller"},{im:"./views/spoken/AudioPlayer",from:"AudioPlayer",name:"AudioPlayer"},{im:"./views/spoken/recording",from:"RecordingButton",name:"RecordingButton"}],A.exports.process=function({require:e,prop:t,value:a}){!e&&"Controller"!==t||n("Controller",e?e("./controller").Controller:a),!e&&"AudioPlayer"!==t||n("AudioPlayer",e?e("./views/spoken/AudioPlayer").AudioPlayer:a),!e&&"RecordingButton"!==t||n("RecordingButton",e?e("./views/spoken/recording").RecordingButton:a)},n("__beyond_pkg",A),n("hmr",new function(){this.on=(e,t)=>A.hmr.on(e,t),this.off=(e,t)=>A.hmr.off(e,t)}),A.initialise(I)}}});System.register(["@beyond-js/widgets@1.1.0/render","@beyond-js/kernel@0.1.9/bundle","@beyond-js/kernel@0.1.9/styles","@beyond-js/react-18-widgets@1.1.2/base","@aimpact/ailearn-sdk@1.0.0/core","@aimpact/ailearn-app@0.0.32/model/wrapper","@aimpact/chat@1.0.1/wrapper","@aimpact/chat@1.0.1/chat-control.widget","@beyond-js/reactive@1.1.12/model","@bgroup/media-manager@1.0.0/recorder","@aimpact/chat-sdk@1.0.0/voice","@aimpact/chat-sdk@1.0.0/session","react@18.2.0","@aimpact/ailearn-app@0.0.32/assignments/assessment.widget","@beyond-js/react-18-widgets@1.1.2/hooks","pragmate-ui@0.1.1/icons","pragmate-ui@0.1.1/components","pragmate-ui@0.1.1/toast","@bgroup/media-manager@1.0.0/audio-player","@aimpact/chat-sdk@1.0.0/widgets/markdown","@aimpact/chat-sdk@1.0.0/widgets/playable","@aimpact/ailearn-app@0.0.32/config","pragmate-ui@0.1.1/link","@aimpact/chat@1.0.1/shared/hooks","pragmate-ui@0.1.1/preload","pragmate-ui@0.1.1/alert","pragmate-ui@0.1.1/modal","pragmate-ui@0.1.1/image","react@18.2.0/jsx-runtime"],function(n,e){"use strict";var t,a,s,r,o,i,c,l,d,u,m,p,f,h,g,v,y,E,w,_,b,k,x,C,M,j,R,N,P,A,I;return n({Controller:void 0,AudioPlayer:void 0,RecordingButton:void 0}),{setters:[function(e){t=e},function(e){a=e},function(e){s=e},function(e){r=e},function(e){o=e},function(e){i=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){u=e},function(e){m=e},function(e){p=e},function(e){f=e},function(e){h=e},function(e){g=e},function(e){v=e},function(e){y=e},function(e){E=e},function(e){w=e},function(e){_=e},function(e){b=e},function(e){k=e},function(e){x=e},function(e){C=e},function(e){M=e},function(e){j=e},function(e){R=e},function(e){N=e},function(e){P=e}],execute:function(){I=a.Bundle,(A=new I({module:{vspecifier:"@aimpact/ailearn-app@0.0.32/assignment-intro",multibundle:!0},type:"widget"},e.meta.url).package()).dependencies.update([["@beyond-js/widgets/render",t],["@beyond-js/kernel/styles",s],["@beyond-js/react-18-widgets/base",r],["@aimpact/ailearn-sdk/core",o],["@aimpact/ailearn-app/model/wrapper",i],["@aimpact/chat/wrapper",c],["@aimpact/chat/chat-control.widget",l],["@beyond-js/reactive/model",d],["@bgroup/media-manager/recorder",u],["@aimpact/chat-sdk/voice",m],["@aimpact/chat-sdk/session",p],["react",f],["@aimpact/ailearn-app/assignments/assessment.widget",h],["@beyond-js/react-18-widgets/hooks",g],["pragmate-ui/icons",v],["pragmate-ui/components",y],["pragmate-ui/toast",E],["@bgroup/media-manager/audio-player",w],["@aimpact/chat-sdk/widgets/markdown",_],["@aimpact/chat-sdk/widgets/playable",b],["@aimpact/ailearn-app/config",k],["pragmate-ui/link",x],["@aimpact/chat/shared/hooks",C],["pragmate-ui/preload",M],["pragmate-ui/alert",j],["pragmate-ui/modal",R],["pragmate-ui/image",N],["react/jsx-runtime",P]]),brequire("@beyond-js/widgets/render").widgets.register([{name:"assignment-intro",attrs:["metadata"],vspecifier:"@aimpact/ailearn-app@0.0.32/assignment-intro.widget"}]),brequire("@beyond-js/kernel/styles").styles.register("@aimpact/ailearn-app@0.0.32/assignment-intro.widget"),(I=new Map).set("./controller",{hash:2786205,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0;var a=e("@beyond-js/react-18-widgets/base"),n=e("./views"),s=e("./store");class r extends a.ReactWidgetController{#store;createStore(){var e=JSON.parse(this.attributes.get("metadata"));return this.#store=new s.StoreManager(e),this.#store.on("change",this.listen),this.#store}listen=()=>{this.#store.storeReady&&this.widget.dispatchEvent(new CustomEvent("ready"))};get Widget(){return n.ChatIntro}}t.Controller=r}}),I.set("./store",{hash:884895855,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StoreManager=void 0;var a=e("@aimpact/ailearn-sdk/core"),n=e("@aimpact/ailearn-app/model/wrapper"),s=e("@aimpact/chat/wrapper"),r=e("@aimpact/chat/chat-control.widget"),o=e("@beyond-js/reactive/model"),i=e("@bgroup/media-manager/recorder"),c=e("@aimpact/chat-sdk/voice"),l=e("@aimpact/chat-sdk/session");let d=1;class u extends o.ReactiveModel{#lesson;get lesson(){return this.#lesson}#topic;get topic(){return this.#topic}#model;get model(){return this.#model}#links=[];get links(){return this.#links}#audioManager=new r.AudioManager(this);#introduction;get introduction(){return this.#introduction}get audioManager(){return this.#audioManager}#voice;get voice(){return this.#voice}#metadata;get metadata(){return this.#metadata}get chat(){return s.AppWrapper.currentChat}get userName(){return l.sessionWrapper.user.displayName}#recorder;get recorder(){return this.#recorder}#isTopic;get isTopic(){return!!this.#isTopic}#assessment;get assessment(){return this.#assessment}#storeReady=!1;get storeReady(){return this.#storeReady}#materials=new Map;get materials(){return this.#materials}#__instance=d;constructor(e){super(),d++,this.#metadata=e,this.#voice=new c.Voice({language:s.AppWrapper.language,rate:s.AppWrapper.audioSpeed}),s.AppWrapper.on("app.settings.change",this.#listenAppChanges),this.#metadata.activity?this.loadActivity():(this.#metadata.assignmentId||(this.#metadata.assignmentId=this.#metadata.sessionId),this.#recorder=new i.Recorder,this.reactiveProps(["loadReady"]),this.#assessment=new a.Assessment({assignmentId:e.sessionId}),this.loadReady=!1,e?this.load(this.metadata).then(()=>{this.ready=!0,this.loadReady=!0,this.#storeReady=!0,this.triggerEvent()}):(this.ready=!0,this.loadReady=!0,this.#storeReady=!0,this.triggerEvent()))}async loadActivity(){try{const t=new a.AssignmentActivity({id:this.#metadata.activity.id,assignmentId:this.#metadata.assignment.id});await(this.#model=t).isReady,await t.load({id:this.#metadata.activity.id,assignmentId:this.#metadata.assignment.id}),this.#voice.set({language:t.language}),this.ready=!0,this.loadReady=!0,this.#storeReady=!0,Object.keys(t.materials).forEach(e=>{this.#materials.set(e,t.materials[e])}),this.#process(),this.triggerEvent()}catch(e){console.error(e)}}#listenAppChanges=()=>{this.#voice.set({rate:s.AppWrapper.audioSpeed})};async load(e){e.lesson&&(await this.loadLesson(e.lesson),this.#model=this.#lesson),e.topic&&await this.loadTopic(e),await this.#process()}#process(){n.AiLearnWrapper.sessionModel=this.#model,n.AiLearnWrapper.sessionAssessment=this.#assessment,this.#materials.size?this.#introduction=this.#materials.get("introduction").replace("%1",l.sessionWrapper.user.displayName):console.warn("No materials found")}sendAssessment=async e=>{try{var t={audio:e};return this.#isTopic?t.topicId=this.#topic.id:t.lessonId=this.#lesson.id,this.#assessment.publish(t)}catch(e){console.error(e)}}}t.StoreManager=u}}),I.set("./views/content-manager",{hash:471717907,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ContentManager=function(){let{store:e,activeControl:t}=(0,o.useLessonIntroContext)();const[a,n]=r.default.useState(e.model);if((0,l.useBinder)([e],()=>n(e.model)),!e.model||!e.materials.size)return null;const s=a.chatIntroductions;return r.default.createElement("div",null,r.default.createElement(()=>{var e;return"content"===t?r.default.createElement(i.default,null):"selection"===t?(e=s.items.get("assessment").value.assessment[0],r.default.createElement(c.Selection,{assessments:e,questions:e.questions})):"spoken"===t?r.default.createElement(d.OralAsssessment,null):void 0},null))};var r=e("react"),o=e("./context"),i=e("./content"),c=e("@aimpact/ailearn-app/assignments/assessment.widget"),l=e("@beyond-js/react-18-widgets/hooks"),d=e("./spoken")}}),I.set("./views/content/actions/index",{hash:1741744978,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ContentControls=function({id:e,text:t,player:a}){const[n,s]=c.default.useState("stop"),[,r]=c.default.useState(!1),o=((0,d.useBinder)([a],()=>r(a.speaking)),(0,d.useBinder)([a],()=>{r(!1)},"on.finish"),"play"===n?"stop":"play"),i="play"===n?async({})=>{await a.stop(),s("stop"),r(!1)}:async({})=>{s("play"),a.positionToCut=0,await a.play(t,e)};return c.default.createElement("div",{className:"audio__actions"},c.default.createElement(l.Button,{onClick:i,"data-listen":"api",icon:o}))};var c=e("react"),l=e("pragmate-ui/components"),d=e("@beyond-js/react-18-widgets/hooks")}}),I.set("./views/content/index",{hash:336171064,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const{store:e,texts:t,visible:a}=(0,v.useLessonIntroContext)(),n=d.default.useRef(null),s=e.materials,r=s.has("article")?s.get("article"):void 0,o=s.has("synthesis")?s.get("synthesis"):void 0,i=e.introduction,c=`${f.default?.params.apis.ailearn}/activities/${e.model.id}/materials/article/audio`,l=e=>{var t=e.currentTarget;const a=e.currentTarget.dataset.element;e=n.current.querySelectorAll(".intro__pane"),t.closest(".badges__container").querySelectorAll(".badge").forEach(e=>e.classList.remove("active")),t.classList.add("active"),e.forEach(e=>{e.classList.remove("active"),e.dataset.element===a&&e.classList.add("active")})};return d.default.createElement("section",{className:"collapsible-content"+(a?" visible":"")},d.default.createElement(m.Markdown,{content:i}),d.default.createElement("section",{className:"intro-actions__container  badges__container"},d.default.createElement("div",{className:"audio-player"},d.default.createElement("audio",{controls:!0,preload:"metadata"},d.default.createElement("source",{src:c}),"Your browser does not support the audio element.")),d.default.createElement(u.ButtonGroup,{selected:0},d.default.createElement(u.Button,{"data-element":"synthesis",onClick:l},t.elements.synthesis),d.default.createElement(u.Button,{"data-element":"content",onClick:l},t.elements.content))),d.default.createElement("section",{className:"intro__panes",ref:n},d.default.createElement("article",{className:"intro__pane intro__synthesis active","data-element":"synthesis"},d.default.createElement(m.Markdown,{content:o})),d.default.createElement("article",{className:"intro__pane intro__synthesis","data-element":"content"},d.default.createElement("div",null,d.default.createElement(g.ContentControls,{id:"content",text:r,store:e,player:e.voice}),d.default.createElement("div",{className:"p1"},d.default.createElement(p.Playable,{player:e.voice,content:r,id:"content"}))))),d.default.createElement(h.Links,null))};var d=e("react"),u=e("pragmate-ui/components"),m=e("@aimpact/chat-sdk/widgets/markdown"),p=e("@aimpact/chat-sdk/widgets/playable"),f=e("@aimpact/ailearn-app/config"),h=e("./links"),g=e("./actions"),v=e("../context")}}),I.set("./views/content/links",{hash:1433600420,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Links=function(){var e=(0,n.useLessonIntroContext)().store;return e.chat.children?a.default.createElement("div",{className:"intro__actions actions flex-container"},e.chat.children.map(e=>{var t=r.default.params.baseUrl+"/chat/"+e.id;return a.default.createElement(s.Link,{key:t,href:t,className:"chat-link"},e.name)})):null};var a=e("react"),n=e("../context"),s=e("pragmate-ui/components"),r=e("@aimpact/ailearn-app/config")}}),I.set("./views/content/player",{hash:3008754464,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.TextToSpeech=void 0;var r=e("react"),o=e("../context"),e=({text:t})=>{const a=(0,o.useLessonIntroContext)().store,n="audio/mpeg",[e,s]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async()=>{var e=await a.voice.createBlobAudioFromText(t,n);s(e)})()},[]),r.default.createElement("div",null,r.default.createElement("audio",{controls:!0},r.default.createElement("source",{src:e,type:n})))};t.TextToSpeech=e,t.default=e}}),I.set("./views/content/topic-detail",{hash:2513435789,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({topic:e}){return a.default.createElement("div",{className:"topic"},a.default.createElement("h4",null,e.title),a.default.createElement("p",null,e.synthesis.content),a.default.createElement(n.Link,{className:"topic-navigation",href:"/chat/"+e.id},a.default.createElement(s.Icon,{icon:"chat"}),a.default.createElement("h5",null,"Ir al Tópico")))};var a=e("react"),n=e("pragmate-ui/link"),s=e("pragmate-ui/icons")}}),I.set("./views/context",{hash:3363470639,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useLessonIntroContext=t.LessonIntroContext=void 0;var a=e("react");const n=t.LessonIntroContext=a.default.createContext({});t.useLessonIntroContext=()=>a.default.useContext(n)}}),I.set("./views/header/TabButton",{hash:288045917,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TabButton=function({label:e,onClick:t,value:a}){return n.default.createElement(s.Button,{"data-view":a,variant:"primary",onClick:t},e)};var n=e("react"),s=e("pragmate-ui/components")}}),I.set("./views/header/index",{hash:2465022756,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var{visible:e,toggleVisibility:t,activeControl:a,model:n,texts:{header:s}}=(0,i.useLessonIntroContext)();return s.titles[a],r.default.createElement(r.default.Fragment,null,r.default.createElement("header",{className:"intro__header"},r.default.createElement("section",{className:"header__title flex-container"},r.default.createElement(o.Icon,{icon:"class",className:"circle lg logo"}),r.default.createElement("h3",null,n.title)),r.default.createElement("div",{className:"header__actions"},r.default.createElement(o.IconButton,{icon:"right",className:"md collapse-icon"+(e?" visible":""),onClick:t}))),n.description&&r.default.createElement("p",null,n.description))};var r=e("react"),o=e("pragmate-ui/icons"),i=e("../context")}}),I.set("./views/index",{hash:786320532,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ChatIntro=function({store:e}){const[t,a]=f.default.useState(!0),[n,s]=f.default.useState(e.storeReady),[r,o]=(0,v.useTexts)(h.module.specifier),[i,c]=f.default.useState("content"),l=((0,g.useBinder)([e],()=>s(e.storeReady&&e.loadReady)),f.default.useMemo(()=>({ready:r&&n&&e.loadReady,activeControl:i,updateView:e=>{c(e)},store:e,texts:o,model:e.model,visible:t,toggleVisibility:()=>a(!t)}),[r,n,e.loadReady,i,e,o,t]));return r&&n?f.default.createElement(m.LessonIntroContext.Provider,{value:l},f.default.createElement("article",{className:"lesson-intro"},f.default.createElement("section",{className:"intro-content"},f.default.createElement(u.default,null),f.default.createElement(d.ContentManager,null))),f.default.createElement("slot",null)):f.default.createElement(p.Preload,null)};var d=e("./content-manager"),u=e("./header"),m=e("./context"),p=e("./preload"),f=e("react"),h=e("beyond_context"),g=e("@beyond-js/react-18-widgets/hooks"),v=e("@aimpact/chat/shared/hooks")}}),I.set("./views/preload",{hash:3521073819,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Preload=function(){return a.default.createElement("div",{className:"lesson-intro"},a.default.createElement("section",{className:"intro-content"},a.default.createElement("header",{className:"intro__header"},a.default.createElement("section",{className:"header__title flex-container"},a.default.createElement(n.Icon,{className:"circle lg logo",icon:"class"}),a.default.createElement("h3",null,a.default.createElement(s.Preload,{width:"100px"}))))))};var a=e("react"),n=e("pragmate-ui/icons"),s=e("pragmate-ui/preload")}}),I.set("./views/spoken/AudioPlayer",{hash:2781382207,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioPlayer=function({src:e}){if(!e)return console.warn("not audio to process"),null;e=URL.createObjectURL(e);const t=a.default.useRef(null);return a.default.useEffect(()=>{const e=t.current;e.addEventListener("loadedmetadata",()=>{e.duration===1/0&&(e.currentTime=1e101,e.ontimeupdate=()=>{e.ontimeupdate=null,e.currentTime=0})})},[e]),e?a.default.createElement("div",{className:"audio-player"},a.default.createElement("audio",{controls:!0,preload:"metadata"},a.default.createElement("source",{src:e,type:"audio/mp3",ref:t}),"Your browser does not support the audio element.")):null};var a=e("react")}}),I.set("./views/spoken/analysis/competencies",{hash:118481483,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CompetenciesFeedback=function(){var e=(0,n.useRecorderContext)().store;return a.default.createElement(s.Markdown,{content:e.assessment.competenciesFeedback})};var a=e("react"),n=e("../context"),s=e("@aimpact/chat-sdk/widgets/markdown")}}),I.set("./views/spoken/analysis/index",{hash:3216807206,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Analysis=function(){const{texts:e,setView:t}=(0,l.useRecorderContext)(),[a,n]=i.default.useState("student"),s={teacher:d.TeacherFeedback,student:u.StudentFeedback,competencies:m.CompetenciesFeedback},r=s[a],o=e=>{n(e.currentTarget.dataset.view)};return i.default.createElement("div",{className:"assessment-analysis__container"},i.default.createElement("header",null,i.default.createElement("h3",null,e.analysisTitle),i.default.createElement("div",{className:"flex-container space-between"},i.default.createElement("section",null,i.default.createElement(c.ButtonGroup,{selected:0},i.default.createElement(c.Button,{"data-view":"student",onClick:o},e.feedback),i.default.createElement(c.Button,{"data-view":"competencies",onClick:o},e.competencies),i.default.createElement(c.Button,{"data-view":"teacher",onClick:o},e.analysis))),i.default.createElement(c.Button,{onClick:e=>{e.preventDefault(),t("recording")},variant:"primary"},e.redo))),i.default.createElement(r,null))};var i=e("react"),c=e("pragmate-ui/components"),l=e("../context"),d=e("./teacher"),u=e("./student"),m=e("./competencies")}}),I.set("./views/spoken/analysis/student",{hash:1317064032,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StudentFeedback=function(){var e=(0,n.useRecorderContext)().store;return a.default.createElement(s.Markdown,{content:e.assessment.feedback})};var a=e("react"),n=e("../context"),s=e("@aimpact/chat-sdk/widgets/markdown")}}),I.set("./views/spoken/analysis/teacher",{hash:1474432510,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TeacherFeedback=function(){var e=(0,n.useRecorderContext)().store;return a.default.createElement(a.default.Fragment,null,e.assessment.analysis.map((e,t)=>a.default.createElement("article",{key:e.subject.replace(" ",""),className:"assessment__analysis-item"},a.default.createElement("section",{className:"item__icon__container"},s.Faces[e.grade]),a.default.createElement("section",null,a.default.createElement("header",null,a.default.createElement("h3",null,e.subject)),a.default.createElement("p",null,e.evaluation)))))};var a=e("react"),n=e("../context"),s=e("@aimpact/ailearn-sdk/core")}}),I.set("./views/spoken/context",{hash:489382465,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useRecorderContext=t.RecorderContext=void 0;var a=e("react");const n=t.RecorderContext=a.default.createContext(null);t.useRecorderContext=()=>a.default.useContext(n)}}),I.set("./views/spoken/index",{hash:1628485481,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.OralAsssessment=function(){var{store:e,texts:{assessments:t}}=(0,l.useLessonIntroContext)(),[a,n]=i.default.useState(!1),[s,r]=i.default.useState(e.assessment.analysis.length?"analysis":"recording"),o=t.oralText?.replace("%1",e.userName),a={store:e,recorder:e.recorder,recording:a,setRecording:n,texts:t,audio:e.recorder.audio,setView:r,onSubmit:e=>{e.preventDefault()}},n="analysis"===s?d.Analysis:u.RecordingButton;return i.default.createElement("div",null,i.default.createElement(c.Alert,{type:"info"},o),i.default.createElement(m.RecorderContext.Provider,{value:a},i.default.createElement("div",{className:"recording__container flex-container flex-center"},i.default.createElement(n,null))))};var i=e("react"),c=e("pragmate-ui/alert"),l=e("../context"),d=e("./analysis"),u=e("./recording"),m=e("./context")}}),I.set("./views/spoken/recording",{hash:2915434314,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RecordingButton=void 0;var b=e("react"),k=e("pragmate-ui/components"),x=e("./context"),C=e("../context"),M=e("./timer"),j=e("./AudioPlayer"),R=e("pragmate-ui/modal"),N=e("pragmate-ui/image");t.RecordingButton=({disabled:e=!1})=>{const{texts:r,recorder:a,recording:n,setRecording:s,audio:t,setView:o}=(0,x.useRecorderContext)();var i=(0,C.useLessonIntroContext)().texts["permissions"];const[c,l]=b.default.useState(""),[d,u]=b.default.useState(!1),m=(0,C.useLessonIntroContext)().store,[p,f]=(0,b.useState)(!1),h=b.default.useRef(null);var g=!n&&t,v=n?"stop":g?"redo":"record",y=n?"stop":"mic",E="start"===c?async e=>{await a.stop(),s(!1),l("reset")}:async e=>{try{e.preventDefault();var t=!n;"granted"!==(await a.hasPermissions()).state&&f(!0),await a.record(),s(t),l("start")}catch(e){console.error("error in on play",e)}},w="recording-player__container"+(d?" is-sending":""),_=e=>{f(!1)};return b.default.createElement("section",{ref:h,className:w},b.default.createElement("div",{className:"recording-player__content"},b.default.createElement(M.Timer,{action:c}),p&&b.default.createElement(R.Modal,{open:!0,show:!0,onClose:_},b.default.createElement("h3",null,i.title),b.default.createElement(N.Image,{src:"/assets/permissions2.svg"}),b.default.createElement("p",null,i.description),b.default.createElement("footer",{className:"mt-15"},b.default.createElement(k.Button,{variant:"primary",onClick:_},i.button))),b.default.createElement(k.Button,{icon:y,onClick:E,disabled:e},r[v]),g&&b.default.createElement("div",{className:"recording__result-container"},b.default.createElement(j.AudioPlayer,{src:m.recorder.audio}),b.default.createElement(k.Button,{icon:"send",onClick:e=>{e.preventDefault(),u(!0),m.sendAssessment(t).then(e=>{o("analysis"),u(!1)}),setTimeout(()=>{const t=h.current.querySelector(".sending-message"),a=r.processMessages;let n=1,s;globalThis.setInterval(()=>{t.classList.remove("fade-out-up"),t.classList.add("fade-in-up"),setTimeout(()=>{t.classList.remove("fade-in-up"),t.classList.add("fade-out-up")},8e3),t.innerHTML=a[n];let e=".";s=setInterval(()=>{e="."===e?"..":".."===e?"...":".",t.innerHTML=a[n]+"<br>"+e},1e3),n===a.length-1&&(n=0),n++},8e3),globalThis.setTimeout(()=>{d&&u(!1)},45e3)},100)},variant:"primary"},r.send))),d&&b.default.createElement("div",{className:"sending__data"},b.default.createElement("h3",{className:"sending-message"},r.processMessages[0])))}}}),I.set("./views/spoken/timer/index",{hash:518301096,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=function({action:e}){var t=["restart","start"].includes(e),a=["restart","reset"].includes(e),[,t,a,,]=(0,s.useTimer)(t,a,"reset"===e),e=a.toString().padStart(2,"0"),a=t.toString().padStart(2,"0");return n.default.createElement("div",{className:"timer__container"},n.default.createElement("span",null,""+a),n.default.createElement("span",{className:"timer__separator"},":"),n.default.createElement("span",null,""+e))};var n=e("react"),s=e("./use-timer")}}),I.set("./views/spoken/timer/use-timer",{hash:1583638382,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useTimer=function(t,e,a=!0){const[n,s]=l(0),r=(d(()=>{let e;return a&&s(0),t&&(e=setInterval(()=>{s(e=>e+1)},10)),()=>{clearInterval(e)}},[t]),d(()=>{e&&s(0)},[e]),n%100),o=Math.floor(n/100%60),i=Math.floor(n/6e3%60),c=Math.floor(n/36e4);return[c,i,o,r]};const{useState:l,useEffect:d}=e("react").default}}),A.exports.descriptor=[{im:"./controller",from:"Controller",name:"Controller"},{im:"./views/spoken/AudioPlayer",from:"AudioPlayer",name:"AudioPlayer"},{im:"./views/spoken/recording",from:"RecordingButton",name:"RecordingButton"}],A.exports.process=function({require:e,prop:t,value:a}){!e&&"Controller"!==t||n("Controller",e?e("./controller").Controller:a),!e&&"AudioPlayer"!==t||n("AudioPlayer",e?e("./views/spoken/AudioPlayer").AudioPlayer:a),!e&&"RecordingButton"!==t||n("RecordingButton",e?e("./views/spoken/recording").RecordingButton:a)},n("__beyond_pkg",A),n("hmr",new function(){this.on=(e,t)=>A.hmr.on(e,t),this.off=(e,t)=>A.hmr.off(e,t)}),A.initialise(I)}}});