System.register(["@beyond-js/kernel@0.1.9/bundle","dexie@3.2.7","@beyond-js/events@0.0.4/events","@beyond-js/kernel@0.1.9/core"],function(t,e){"use strict";var r,s,a,n,i,o;return t({DatabaseManager:void 0,DBManager:void 0}),{setters:[function(e){r=e},function(e){s=e},function(e){a=e},function(e){n=e}],execute:function(){o=r.Bundle,(i=new o({module:{vspecifier:"@beyond-js/reactive@1.1.12/database"},type:"ts"},e.meta.url).package()).dependencies.update([["dexie",s],["@beyond-js/events/events",a],["@beyond-js/kernel/core",n]]),(o=new Map).set("./database",{hash:1160722982,creator:function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.Database=void 0;var s=e("dexie"),t=e("@beyond-js/events/events"),a=e("@beyond-js/kernel/core");class n extends t.Events{#version=1;#db;get db(){return this.#db}#promise;#currentVersion;static#instance;#ready;#name;get ready(){return this.#ready}constructor(e,r){super(),this.#name=e,this.#version=r,this.create(),this.#promise=new a.PendingPromise,globalThis.db=this.#db}async create(){this.#db=new s.default(this.#name),this.#currentVersion=this.#db.version(this.#version)}#onReady=()=>{this.#ready=!0,this.#promise.resolve(),this.#promise=void 0};#onError=e=>{throw this.#promise.resolve(),this.#promise=void 0,new Error(e)};#nextVersion(){return this.#version++,this.#version}register=async s=>{Object.keys(s).forEach(e=>{var r=s[e].split(","),r=new Set(r);r.add("offline"),r.add("instanceId"),r.add("isDeleted"),r.add("isNew"),s[e]=Array.from(r).join(",")}),this.#currentVersion.stores(s);try{return await this.#db.open(),this.#db}catch(e){console.error("error registering",e)}}}r.Database=n}}),o.set("./index",{hash:1682080146,creator:function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.DatabaseManager=r.DBManager=void 0;var s=e("dexie"),t=e("@beyond-js/events/events"),a=e("@beyond-js/kernel/core"),n=e("./database");class i extends t.Events{#promise;#ready;get ready(){return this.#ready}#db;get db(){return this.#db}#databases=new Map;constructor(){super();var e=new s.default("ReactiveDatabase");(this.#db=e).version(1).stores({schemas:"name, table, fields"}),e.open().then(this.#onFinished).catch(this.#onError)}#onFinished=()=>{this.trigger("loaded.reactive.database"),this.#promise&&this.#promise.resolve()};#onError=e=>{this.trigger("error"),console.error(e)};load(){if(this.ready)return this.ready;if(this.#promise)return this.#promise;this.#promise=new a.PendingPromise;this.on("finished",()=>{this.#ready=!0,this.#promise.resolve(),this.#promise=void 0}),this.on("error",()=>{this.#promise.reject(),this.#promise=void 0})}async open(e){var r,s;if(e)return[r,s=1]=e.split("@"),this.#databases.has(r)?this.#databases.get(r):(s=new n.Database(r,s),this.#databases.set(r,s),s);throw new Error(`Identifier ${e} was not defined correctly`)}get=e=>this.open(e);async config(e,r){return(await this.open(e)).register(r)}}r.DatabaseManager=i;r.DBManager=new i}}),i.exports.descriptor=[{im:"./index",from:"DatabaseManager",name:"DatabaseManager"},{im:"./index",from:"DBManager",name:"DBManager"}],i.exports.process=function({require:e,prop:r,value:s}){!e&&"DatabaseManager"!==r||t("DatabaseManager",e?e("./index").DatabaseManager:s),!e&&"DBManager"!==r||t("DBManager",e?e("./index").DBManager:s)},t("__beyond_pkg",i),t("hmr",new function(){this.on=(e,r)=>i.hmr.on(e,r),this.off=(e,r)=>i.hmr.off(e,r)}),i.initialise(o)}}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9kYXRhYmFzZS50cyIsIi9pbmRleC50cyJdLCJuYW1lcyI6WyJfZGV4aWUiLCJyZXF1aXJlIiwiX2V2ZW50cyIsIl9jb3JlIiwiRGF0YWJhc2UiLCJFdmVudHMiLCIjdmVyc2lvbiIsIiNkYiIsImRiIiwidGhpcyIsIiNwcm9taXNlIiwiI2N1cnJlbnRWZXJzaW9uIiwiI2luc3RhbmNlIiwiI3JlYWR5IiwiI25hbWUiLCJyZWFkeSIsImNvbnN0cnVjdG9yIiwibmFtZSIsInZlcnNpb24iLCJzdXBlciIsImNyZWF0ZSIsIlBlbmRpbmdQcm9taXNlIiwiZ2xvYmFsVGhpcyIsImRlZmF1bHQiLCIjb25SZWFkeSIsInJlc29sdmUiLCJ1bmRlZmluZWQiLCIjb25FcnJvciIsImVycm9yIiwiRXJyb3IiLCIjbmV4dFZlcnNpb24iLCJyZWdpc3RlciIsImRhdGEiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsInN0b3JlIiwiaXRlbXMiLCJzcGxpdCIsImZpbHRlciIsIlNldCIsImFkZCIsIkFycmF5IiwiZnJvbSIsImpvaW4iLCJzdG9yZXMiLCJhd2FpdCIsIm9wZW4iLCJlIiwiY29uc29sZSIsImV4cG9ydHMiLCJfZGF0YWJhc2UiLCJEYXRhYmFzZU1hbmFnZXIiLCIjZGF0YWJhc2VzIiwiTWFwIiwic2NoZW1hcyIsInRoZW4iLCIjb25GaW5pc2hlZCIsImNhdGNoIiwidHJpZ2dlciIsImVyciIsImxvYWQiLCJvbiIsIm9uRmluaXNoZWQiLCJyZWplY3QiLCJpZGVudGlmaWVyIiwic2NoZW1hIiwiaGFzIiwiZ2V0Iiwic2V0IiwiY29uZmlnIiwiREJNYW5hZ2VyIl0sIm1hcHBpbmdzIjoieXBCQUFBLElBQUFBLEVBQUFDLEVBQUEsT0FBQSxFQUNBQyxFQUFBRCxFQUFBLDBCQUFBLEVBQ0FFLEVBQUFGLEVBQUEsd0JBQUEsUUFFYUcsVUFBaUJGLEVBQUFHLE9BQzdCQyxTQUFXLEVBRVhDLElBQ0FDLFNBQ0MsT0FBT0MsS0FBS0YsR0FDYixDQUNBRyxTQUNBQyxnQkFDQUMsZ0JBQ0FDLE9BRUFDLE1BQ0FDLFlBQ0MsT0FBT04sS0FBS0ksTUFDYixDQUVBRyxZQUFZQyxFQUFNQyxHQUNqQkMsTUFBSyxFQUVMVixLQUFLSyxNQUFRRyxFQUNiUixLQUFLSCxTQUFXWSxFQUNoQlQsS0FBS1csT0FBTSxFQUNYWCxLQUFLQyxTQUFXLElBQUlQLEVBQUFrQixlQUVwQkMsV0FBV2QsR0FBS0MsS0FBS0YsR0FDdEIsQ0FFQWEsZUFDQ1gsS0FBS0YsSUFBTSxJQUFJUCxFQUFBdUIsUUFBTWQsS0FBS0ssS0FBSyxFQUMvQkwsS0FBS0UsZ0JBQWtCRixLQUFLRixJQUFJVyxRQUFRVCxLQUFLSCxRQUFRLENBQ3RELENBRUFrQixTQUFXQSxLQUNWZixLQUFLSSxPQUFTLENBQUEsRUFDZEosS0FBS0MsU0FBU2UsUUFBTyxFQUNyQmhCLEtBQUtDLFNBQVdnQixLQUFBQSxDQUNqQixFQUNBQyxTQUFXQyxJQUdWLE1BRkFuQixLQUFLQyxTQUFTZSxRQUFPLEVBQ3JCaEIsS0FBS0MsU0FBV2dCLEtBQUFBLEVBQ1YsSUFBSUcsTUFBTUQsQ0FBSyxDQUN0QixFQUNBRSxlQUVDLE9BREFyQixLQUFLSCxRQUFRLEdBQ05HLEtBQUtILFFBQ2IsQ0FFQXlCLFNBQWlCQyxNQUFBQSxJQUNoQkMsT0FBT0MsS0FBS0YsQ0FBSSxFQUFFRyxRQUFRQyxJQUN6QixJQUFNQyxFQUFRTCxFQUFLSSxHQUFPRSxNQUFNLEdBQUcsRUFDN0JDLEVBQVMsSUFBSUMsSUFBSUgsQ0FBSyxFQUM1QkUsRUFBT0UsSUFBSSxTQUFTLEVBQ3BCRixFQUFPRSxJQUFJLFlBQVksRUFDdkJGLEVBQU9FLElBQUksV0FBVyxFQUN0QkYsRUFBT0UsSUFBSSxPQUFPLEVBQ2xCVCxFQUFLSSxHQUFTTSxNQUFNQyxLQUFLSixDQUFNLEVBQUVLLEtBQUssR0FBRyxDQUMxQyxDQUFDLEVBRURuQyxLQUFLRSxnQkFBZ0JrQyxPQUFPYixDQUFJLEVBRWhDLElBRUMsT0FEQWMsTUFBTXJDLEtBQUtGLElBQUl3QyxLQUFJLEVBQ1p0QyxLQUFLRixHLENBQ1gsTUFBT3lDLEdBQ1JDLFFBQVFyQixNQUFNLG9CQUFxQm9CLENBQUMsQyxDQUV0QyxDLENBQ0FFLEVBQUE5QyxTQUFBQSxDLGlKQ3hFRCxJQUFBSixFQUFBQyxFQUFBLE9BQUEsRUFDQUMsRUFBQUQsRUFBQSwwQkFBQSxFQUNBRSxFQUFBRixFQUFBLHdCQUFBLEVBQ0FrRCxFQUFBbEQsRUFBQSxZQUFBLFFBRXlCbUQsVUFBd0JsRCxFQUFBRyxPQUNoREssU0FDQUcsT0FDQUUsWUFDQyxPQUFPTixLQUFLSSxNQUNiLENBRUFOLElBQ0FDLFNBQ0MsT0FBT0MsS0FBS0YsR0FDYixDQUNBOEMsV0FBYSxJQUFJQyxJQUNqQnRDLGNBQ0NHLE1BQUssRUFFTCxJQUFNWCxFQUFLLElBQUlSLEVBQUF1QixRQUFNLGtCQUFrQixHQUN2Q2QsS0FBS0YsSUFBTUMsR0FDUlUsUUFBUSxDQUFDLEVBQUUyQixPQUFPLENBQUVVLFFBQVMscUJBQXFCLENBQUUsRUFDdkQvQyxFQUFHdUMsS0FBSSxFQUFHUyxLQUFLL0MsS0FBS2dELFdBQVcsRUFBRUMsTUFBTWpELEtBQUtrQixRQUFRLENBQ3JELENBRUE4QixZQUFjQSxLQUNiaEQsS0FBS2tELFFBQVEsMEJBQTBCLEVBQ25DbEQsS0FBS0MsVUFBVUQsS0FBS0MsU0FBU2UsUUFBTyxDQUN6QyxFQUNBRSxTQUFXaUMsSUFDVm5ELEtBQUtrRCxRQUFRLE9BQU8sRUFDcEJWLFFBQVFyQixNQUFNZ0MsQ0FBRyxDQUNsQixFQUVBQyxPQUNDLEdBQUlwRCxLQUFLTSxNQUFPLE9BQU9OLEtBQUtNLE1BQzVCLEdBQUlOLEtBQUtDLFNBQVUsT0FBT0QsS0FBS0MsU0FDL0JELEtBQUtDLFNBQVcsSUFBSVAsRUFBQWtCLGVBTXBCWixLQUFLcUQsR0FBRyxXQUxXQyxLQUNsQnRELEtBQUtJLE9BQVMsQ0FBQSxFQUNkSixLQUFLQyxTQUFTZSxRQUFPLEVBQ3JCaEIsS0FBS0MsU0FBV2dCLEtBQUFBLENBQ2pCLENBQzhCLEVBQzlCakIsS0FBS3FELEdBQUcsUUFBUyxLQUNoQnJELEtBQUtDLFNBQVNzRCxPQUFNLEVBQ3BCdkQsS0FBS0MsU0FBV2dCLEtBQUFBLENBQ2pCLENBQUMsQ0FDRixDQUVBcUIsV0FBV2tCLEdBQ1YsSUFHS2hELEVBRUVpRCxFQUxQLEdBQUtELEVBSUwsTUFESSxDQUFDaEQsRUFBTUMsRUFBVSxHQUFLK0MsRUFBVzNCLE1BQU0sR0FBRyxFQUN6QzdCLEtBQUs0QyxXQUFXYyxJQUFJbEQsQ0FBSSxFQU10QlIsS0FBSzRDLFdBQVdlLElBQUluRCxDQUFJLEdBTHhCaUQsRUFBUyxJQUFJZixFQUFBL0MsU0FBU2EsRUFBTUMsQ0FBTyxFQUN6Q1QsS0FBSzRDLFdBQVdnQixJQUFJcEQsRUFBTWlELENBQU0sRUFDekJBLEdBTlAsTUFBTSxJQUFJckMsb0JBQW9Cb0MsNkJBQXNDLENBVXRFLENBRUFHLElBQU1uRCxHQUFRUixLQUFLc0MsS0FBSzlCLENBQUksRUFFNUJxRCxhQUFhckQsRUFBTTRCLEdBRWxCLE9BRGVDLE1BQU1yQyxLQUFLc0MsS0FBSzlCLENBQUksR0FDckJjLFNBQVNjLENBQU0sQ0FDOUIsQyxDQUNBSyxFQUFBRSxnQkFBQUEsRUFDa0NGLEVBQUFxQixVQUFHLElBQUluQiJ9