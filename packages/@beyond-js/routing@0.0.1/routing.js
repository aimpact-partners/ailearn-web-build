System.register(["@beyond-js/kernel@0.1.9/bundle","@beyond-js/kernel@0.1.9/core"],function(r,t){"use strict";var e,i,u,s,o;return r({routing:void 0,URI:void 0}),{setters:[function(t){e=t},function(t){i=t}],execute:function(){u=t=>{var e=new Map([["@beyond-js/kernel","0.1.9"],["@beyond-js/local","0.1.3"],["socket.io-client","4.7.5"],["@beyond-js/routing","0.0.1"],["@aimpact/ailearn-app","0.1.6-dev.36"]]);return globalThis.bimport(globalThis.bimport.resolve(t,e))},o=e.Bundle,(s=new o({module:{vspecifier:"@beyond-js/routing@0.0.1/routing"},type:"ts"},t.meta.url).package()).dependencies.update([["@beyond-js/kernel/core",i]]),(o=new Map).set("./history/history",{hash:975757917,creator:function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BeyondHistory=void 0;var i=r("./position"),s=r("./records");t.BeyondHistory=class{#position;get position(){return this.#position}#records;get records(){return this.#records}get valid(){return this.#records.valid}get current(){return this.valid?this.#records.current.uri:void 0}#initial=history.length;get initial(){return this.#initial}#processBrowserURI(t){var e,i;if(void 0!==t)return e=r("../routing").routing,i=r("../routing").RoutingMode,e.mode===i.Hash?"#"+t.substr(1):t}#push(t){this.#records.reset(),this.#records.push(t),this.#position.save(this.#records.length)}replaceState(t,e,i){if("object"!=typeof(t=t||{}))throw new Error("Invalid state parameter");this.#records.updateCurrentURI(i);var r=this.#position.value;history.replaceState(t,e,this.#processBrowserURI(i)),this.#position.save(r)}pushState(t,e){if(t!==""+location.pathname+location.search+location.hash){if("object"!=typeof(e=e||{}))throw new Error("Invalid state parameter");history.pushState(e,null,this.#processBrowserURI(t)),this.#push(t)}}back(){var t=this.#records.previous?.position,e=this.#records.current?.position;t&&history.go(t-e)}forward(){var t=this.#records.following?.position,e=this.#records.current?.position;t&&history.go(t-e)}constructor(t,e){this.#position=new i.HistoryPosition,this.#records=new s.HistoryRecords(this.#position),void 0===this.#position.value&&(t=t.mode===e.Hash?location.hash.slice(1):""+location.pathname+location.search+location.hash,this.#push(t))}}}}),o.set("./history/position",{hash:3613484025,creator:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.HistoryPosition=void 0,e.HistoryPosition=class{check(){return!!this.value||(console.error("History state is not defined. This happen when state is changed outside the beyond defined navigation flows."),!1)}get value(){return history.state?.__beyond_navigation_position}save(t){var e=history.state||{};e.__beyond_navigation_position=t,history.replaceState(e,null)}}}}),o.set("./history/records",{hash:3466552890,creator:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.HistoryRecords=void 0,e.HistoryRecords=class{#position;#valid=!0;get valid(){return this.#valid}#entries=[];get entries(){return this.#entries.slice()}get length(){return this.#entries.length}get current(){return this.#entries[this.#position.value-1]}get previous(){var t=this.#position.value-2;if(!(t<0))return this.#entries[t]}get following(){var t=this.#position.value;if(!(t>=this.#entries.length))return this.#entries[t]}constructor(t){this.#position=t;let e;try{var i=sessionStorage.getItem("__beyond_navigation_records");if(!i&&void 0!==t.value)return void(this.#valid=!1);e=i?JSON.parse(i):[]}catch(t){this.#valid=!1,console.error("Error loading beyond navigation state",t instanceof Error?t.stack:t),this.#entries=[]}e instanceof Array||console.warn("The beyond navigation data, stored in session store is invalid.",e),this.#entries=e}#sanitizeURI(t){if(void 0!==t)return t.startsWith("/")?t:"/"+t}get(t){return this.#entries[t]}push(t){t=this.#sanitizeURI(t),this.#entries.push({uri:t,position:history.length}),this.save()}reset(){this.#position.value||(this.#entries=this.#entries.filter(t=>t.position<history.length))}updateCurrentURI(t){var e;this.#valid&&(e=this.#position.value,t=this.#sanitizeURI(t),this.#entries[e-1]={uri:t,position:history.length},this.save())}save(){this.#valid&&sessionStorage.setItem("__beyond_navigation_records",JSON.stringify(this.#entries))}}}}),o.set("./routing",{hash:156439042,creator:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.routing=e.RoutingMode=e.Routing=void 0;var s,o=t("./uri/uri"),i=t("@beyond-js/kernel/core"),r=t("./history/history");(t=s||(e.RoutingMode=s={}))[t.Hash=0]="Hash",t[t.Pathname=1]="Pathname";const n="object"==typeof process;class a extends i.Events{#mode;get mode(){return this.#mode}#history;get history(){return this.#history}#initialised=!1;get initialised(){return this.#initialised}#resolve;#ready=new Promise(t=>this.#resolve=t);get ready(){return this.#ready}#uri;get uri(){return this.#uri}missing;redirect;#resolveConfigured;#configured=new Promise(t=>this.#resolveConfigured=t);constructor(){super();var t=globalThis.__app_package.specifier;n||u(t+"/config").then(({default:t})=>{let e="hash"===t.routing?.mode?s.Hash:s.Pathname;"file:"===location.protocol&&(e=s.Hash),[0,1].includes(e)||(e="file:"===location.protocol?s.Hash:s.Pathname),this.#mode=e,this.#history=new r.BeyondHistory(this,s),this.#resolveConfigured()})}#redirect=async t=>{if("function"==typeof this.redirect){var e=await this.redirect(t);if(e)if("string"!=typeof e)console.error("Invalid route value set by custom routing function",e);else if(t.pathname!==e)return this.pushState(e),!0}};pushState(t,e){this.#configured.then(()=>{this.#history.pushState(t,e),this.update().catch(t=>console.error(t.stack))})}replaceState(t,e,i){this.#configured.then(()=>{this.#history.replaceState(t,e,i),this.update().catch(t=>console.error(t.stack))})}#cancellationToken=new i.CancellationToken;update=async()=>{var t=this.#cancellationToken.reset(),{hash:e,pathname:i,search:r}=location,i=this.#mode===s.Hash?"/"+e.slice(1):i+r+e;this.#uri?.uri!==i&&(r=this.#uri=new o.URI(i),e=await this.#redirect(r),this.#cancellationToken.check(t))&&!e&&(this.#history&&r.uri!==this.#history.current&&console.error(`History current "${this.#history.current}" is not equal to actual uri "${r.uri}"`),this.#initialised?this.trigger("change"):this.#resolve(),this.#initialised=!0)};#started=!1;setup(){this.#started=!0,n||this.update().catch(t=>console.error(t.stack))}back(){this.#history.back()}forward(){this.#history.forward()}}e.Routing=a;const h=e.routing=new a;globalThis.routing=h,n||(beyond.navigate=(t,e)=>h.pushState(t,e)),n||(beyond.pushState=(t,e)=>h.pushState(t,e)),n||(beyond.back=()=>h.back()),n||(beyond.forward=()=>h.forward()),n||window.addEventListener("popstate",()=>h.update().catch(t=>console.error(t.stack)))}}),o.set("./uri/querystring",{hash:187911159,creator:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.QueryString=void 0;class i extends Map{constructor(t){if(super(),""!==t.trim()){var e=(t="?"===t.slice(0,1)?t.slice(1):t).split("&");for(let t=0;t<e.length;++t){var i=e[t].split("=",2),r=i[1]?decodeURIComponent(i[1].replace(/\+/g," ")):void 0;this.set(i[0],r)}}}}e.QueryString=i}}),o.set("./uri/uri",{hash:748332499,creator:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.URI=void 0;var r=t("./querystring");e.URI=class{#uri;get uri(){return this.#uri}#pathname;get pathname(){return this.#pathname}#search;get search(){return this.#search}#qs;get qs(){return this.#qs}#hash;get hash(){return this.#hash}constructor(t){var[t,e]=(this.#uri=t).split("#"),[t,i]=t.split("?");this.#pathname=t.startsWith("/")?t:"/"+t,this.#search=i||"",this.#qs=new r.QueryString(this.#search),this.#hash=e}}}}),s.exports.descriptor=[{im:"./routing",from:"routing",name:"routing"},{im:"./uri/uri",from:"URI",name:"URI"}],s.exports.process=function({require:t,prop:e,value:i}){!t&&"routing"!==e||r("routing",t?t("./routing").routing:i),!t&&"URI"!==e||r("URI",t?t("./uri/uri").URI:i)},r("__beyond_pkg",s),r("hmr",new function(){this.on=(t,e)=>s.hmr.on(t,e),this.off=(t,e)=>s.hmr.off(t,e)}),s.initialise(o)}}});