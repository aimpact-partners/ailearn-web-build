System.register(["@beyond-js/kernel@0.1.9/bundle","zod@3.23.8","@beyond-js/events@0.0.7/events"],function(i,e){var t,r,s,o,a;return i({ReactiveModel:void 0,ModelProperties:void 0,ReactiveProps:void 0,SetPropertiesResult:void 0}),{setters:[function(e){t=e},function(e){r=e},function(e){s=e}],execute:function(){a=t.Bundle,(o=new a({module:{vspecifier:"@aimpact/ailearn-sdk@1.0.0/reactive/model"},type:"ts"},e.meta.url).package()).dependencies.update([["zod",r],["@beyond-js/events/events",s]]),(a=new Map).set("./index",{hash:4285427674,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ReactiveModel=void 0;var r=e("zod"),e=e("./proxy");class i extends e.ProxyBase{_reactiveProps={};properties=[];debounceTimeout;processing=!1;processed=!1;loaded=!1;#ready=!1;#propertyNames=new Set;get ready(){return this.#ready}set ready(e){this.#ready=e,this.triggerEvent("ready"),this.triggerEvent("change")}schema;#initialValues={};get initialValues(){return this.#initialValues}get unpublished(){let t=this.getProperties()??{};return Object.keys(t).some(e=>"id"!==e&&"object"!=typeof t[e]&&t[e]!==this.#initialValues[e])}get isUnpublished(){return this.unpublished}constructor({properties:e,...t}={properties:[]}){super(),this.defineReactiveProps(["fetching","fetched","processing","processed","loaded"],!1),e&&(this.properties=e,this.setInitialValues(t),this.defineReactiveProps(e,{...t}))}setInitialValues(r){if(r){let t={};this.properties.forEach(e=>{r.hasOwnProperty(e)?t[e]=r[e]:t[e]=void 0}),this.set(r),this.#initialValues=t}return this.#initialValues}defineReactiveProp(r,e,i=!1){this._reactiveProps[r]=e,Object.defineProperty(this,r,{get:()=>this._reactiveProps[r],set:e=>{var t;i?(t=this._reactiveProps[r],this.trigger(r+".changed",{value:e,previous:t.getProperties()}),this._reactiveProps[r].set(e)):void 0!==e&&e===this._reactiveProps[r]||(t=this._reactiveProps[r],this._reactiveProps[r]=e,this.trigger(r+".changed",{value:e,previous:t}))},enumerable:!0,configurable:!0})}defineReactiveProps(e,t){for(var r of e){var i,s;"object"==typeof r?(r=(s=r).name,i=Object.getOwnPropertyDescriptor(this,r),i=t?.[r]??i?.value,"function"!=typeof s.value&&"object"!=typeof s.value?console.warn("Invalid value type for  "+r):(s=new s.value(i),this.#propertyNames.add(r),this.defineReactiveProp(r,s,!0))):(this.#propertyNames.add(r),i=Object.getOwnPropertyDescriptor(this,r),s=t?.[r]??i?.value,this.defineReactiveProp(r,s))}}reactiveProps(e){this.defineReactiveProps(e)}getProperty(e){return this._reactiveProps[e]}setProperty(e,t){this._reactiveProps[e]=t}validateProperty(e,t){return this.schema?this.schema.shape[e]?(t=this.schema.shape[e].safeParse(t)).success?{valid:!0,error:null}:{valid:!1,error:t.error}:{valid:!1,error:new r.ZodError([{path:[e],message:`Property ${e} is not defined in the schema`,code:"custom"}])}:{valid:!0,error:null}}isSameObject=(e,t)=>JSON.stringify(e)===JSON.stringify(t);validate(r){let e=Object.keys(r),i={};return e.forEach(e=>{var t;this.properties&&this.properties.includes(e)?(t=this.validateProperty(e,r[e])).valid||(i[e]=t.error):console.trace("is not a property",e)}),{valid:!!Object.keys(i).length,errors:i}}set(i){if(!i)return console.warn("you are trying to set an empty object",this.constructor.name,i),{updated:!1};let e=Object.keys(i),s=!1,o={};return e.forEach(e=>{var t,r;this.#propertyNames.has(e)&&((t=this.validateProperty(e,i[e])).valid?(r="object"==typeof i[e]&&this.isSameObject(i[e],this[e]),this[e]===i[e]||r||Object.getOwnPropertyDescriptor(this,e)?.set&&(this[e]=i[e],s=!0)):o[e]=t)}),s&&(this.triggerEvent("change"),this.trigger("set.executed")),{updated:s,errors:o}}getProperties(){let r={};return this.properties,this.properties.forEach(e=>{let t=e;"object"==typeof e?(t=e.name,r[String(t)]=this[t]?.getProperties()):r[String(t)]=this[t]}),r}triggerEvent=(e="change",t)=>{this.trigger(e)};revert(){this.set(this.initialValues)}save(){this.#initialValues=this.getProperties()}}t.ReactiveModel=i}}),a.set("./proxy",{hash:1157261727,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyBase=void 0,e=e("@beyond-js/events/events");class r extends e.Events{constructor(){super();var e=new Proxy(this,{get:(e,t,r)=>{var i;if(t in e)return"function"==typeof(i=e[t])?i.bind(e):i;if(t in e)return Reflect.get(e,t,r);throw new Error(`Property ${String(t)} does not exist`)},set:(e,t,r)=>(e[t]=r,!0)});return Object.assign(this,e)}}t.ProxyBase=r}}),a.set("./types/index",{hash:3999328397,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),o.exports.descriptor=[{im:"./index",from:"ReactiveModel",name:"ReactiveModel"},{im:"./types/index",from:"ModelProperties",name:"ModelProperties"},{im:"./types/index",from:"ReactiveProps",name:"ReactiveProps"},{im:"./types/index",from:"SetPropertiesResult",name:"SetPropertiesResult"}],o.exports.process=function({require:e,prop:t,value:r}){!e&&"ReactiveModel"!==t||i("ReactiveModel",e?e("./index").ReactiveModel:r),!e&&"ModelProperties"!==t||i("ModelProperties",e?e("./types/index").ModelProperties:r),!e&&"ReactiveProps"!==t||i("ReactiveProps",e?e("./types/index").ReactiveProps:r),!e&&"SetPropertiesResult"!==t||i("SetPropertiesResult",e?e("./types/index").SetPropertiesResult:r)},i("__beyond_pkg",o),i("hmr",new function(){this.on=(e,t)=>o.hmr.on(e,t),this.off=(e,t)=>o.hmr.off(e,t)}),o.initialise(a)}}});