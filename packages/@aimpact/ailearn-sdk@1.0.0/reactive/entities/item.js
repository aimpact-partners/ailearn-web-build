System.register(["@beyond-js/kernel@0.1.9/bundle","@aimpact/ailearn-sdk@1.0.0/reactive/model","uuid@10.0.0"],function(i,e){var t,r,s,a,o;return i({Item:void 0,RegistryFactory:void 0,ItemId:void 0,IItemProps:void 0,IEntityProvider:void 0}),{setters:[function(e){t=e},function(e){r=e},function(e){s=e}],execute:function(){o=t.Bundle,(a=new o({module:{vspecifier:"@aimpact/ailearn-sdk@1.0.0/reactive/entities/item"},type:"ts"},e.meta.url).package()).dependencies.update([["@aimpact/ailearn-sdk/reactive/model",r],["uuid",s]]),(o=new Map).set("./index",{hash:2482507548,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Item=void 0;var r=e("@aimpact/ailearn-sdk/reactive/model"),s=e("./registry/factory");class i extends r.ReactiveModel{#factory;#entity;get entity(){return this.#entity}#registry;#fetched;get fetched(){return this.#fetched}#found=!1;get found(){return this.#found}_dataProvider;get dataProvider(){return this._dataProvider}get registry(){return this.#registry}constructor({entity:e,dataProvider:t,properties:r,...i}){if(super({...i,properties:r}),!e)throw new Error("Entity is required");if(this.id=i.id,t&&"function"!=typeof t)throw new Error("DataProvider must be a class/constructor in object "+e);this.#entity=e,this.onSet=this.onSet.bind(this),this.on("set.executed",this.onSet),t&&(this._dataProvider=new t(this)),this.#factory=s.RegistryFactory.getInstance(e)}initialize({...e}){e=this.#factory.get(this.id,e),this.#registry=e,e=this.#registry.getValues(),this.setInitialValues(e),this.properties.forEach(e=>{"string"==typeof e&&this.on(e+".changed",()=>{this.#registry.setValues({[e]:this.getProperty(e)})})})}registryListener(e){super.set(this.#registry.getValues())}set(e){return super.set(e)}onSet(){this.#registry?.setValues(this.getProperties())}_load(e){}async load(e){if(!this._dataProvider||"function"!=typeof this._dataProvider.load)throw new Error("DataProvider is not defined or does not implement the load() method in object "+this.constructor.name);try{var t=await this._dataProvider.load(e);if(!t)throw this.#found=!1,new Error("DataProvider.load() did not return an item.");this.#found=!0,this.#fetched=!0,this.set(t),this.triggerEvent("load",{...this.getProperties()}),this.trigger("change")}catch(e){throw new Error(e.message)}finally{this.#fetched=!0}}async publish(e){if(this.set(e),super.save(),this._dataProvider&&"function"==typeof this._dataProvider.publish){if((e=await this._dataProvider.publish(e)).status)return this.set(e.data),e.data;throw new Error("Error saving item")}return this.getProperties()}async delete(e){try{if(e=e??this.id,this._dataProvider&&"function"==typeof this._dataProvider.delete)return this.processing=!0,this._dataProvider.delete(e);throw new Error("DataProvider is not defined or does not implement the delete() method.")}catch(e){console.error(e)}}}t.Item=i}}),o.set("./registry/factory",{hash:264840268,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RegistryFactory=void 0;var r=e("@aimpact/ailearn-sdk/reactive/model"),i=e("./");class s extends r.ReactiveModel{static#instances=new Map;items=new Map;#name;constructor(e,t){super({properties:t}),this.#name=e,this.ready=!0}get(e,t){e&&this.items.has(e)||(r=t?{id:e,...t}:{id:e,properties:this.properties,...t},e=(r=new i.Registry(r)).id,this.items.set(e,r));var r=this.items.get(e);return t&&(t.id||delete t.id,r.setValues(t)),r}static getInstance(e,t){return this.#instances.has(e)||this.#instances.set(e,new s(e,t)),this.#instances.get(e)}}t.RegistryFactory=s}}),o.set("./registry/index",{hash:2439480711,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Registry=void 0;var r=e("@aimpact/ailearn-sdk/reactive/model"),i=e("uuid");class s extends r.ReactiveModel{#id;#instanceId;#isDeleted=!1;get id(){return this.#id}get instanceId(){return this.#instanceId}#values;get values(){return this.#values}get deleted(){return this.#isDeleted}#propertyNames=[];set deleted(e){e!==this.#isDeleted&&(this.#isDeleted=e,this.triggerEvent())}constructor({properties:e,...t}={id:void 0}){super({properties:e||[]}),e=t.id,this.#instanceId=(0,i.v4)(),this.#id=e||this.#instanceId,this.#values={...t,id:this.#id},this.setValues(this.#values)}updateValue(e,t){this.#values[e]=t}setValues(e){if(!e)return!1;let t=!1;for(var r in e){var i;Object.prototype.hasOwnProperty.call(e,r)&&(i=e[r])!==this.#values[r]&&(this.updateValue(r,i),t=!0)}return t&&this.trigger("change",{values:this.#values}),t}getValues(){return{...this.#values}}}t.Registry=s}}),o.set("./registry/types/index",{hash:2103332309,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),o.set("./types",{hash:3074177607,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),a.exports.descriptor=[{im:"./index",from:"Item",name:"Item"},{im:"./registry/factory",from:"RegistryFactory",name:"RegistryFactory"},{im:"./types",from:"ItemId",name:"ItemId"},{im:"./types",from:"IItemProps",name:"IItemProps"},{im:"./types",from:"IEntityProvider",name:"IEntityProvider"}],a.exports.process=function({require:e,prop:t,value:r}){!e&&"Item"!==t||i("Item",e?e("./index").Item:r),!e&&"RegistryFactory"!==t||i("RegistryFactory",e?e("./registry/factory").RegistryFactory:r),!e&&"ItemId"!==t||i("ItemId",e?e("./types").ItemId:r),!e&&"IItemProps"!==t||i("IItemProps",e?e("./types").IItemProps:r),!e&&"IEntityProvider"!==t||i("IEntityProvider",e?e("./types").IEntityProvider:r)},i("__beyond_pkg",a),i("hmr",new function(){this.on=(e,t)=>a.hmr.on(e,t),this.off=(e,t)=>a.hmr.off(e,t)}),a.initialise(o)}}});