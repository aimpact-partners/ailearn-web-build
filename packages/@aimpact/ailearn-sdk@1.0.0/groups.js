System.register(["@beyond-js/kernel@0.1.9/bundle","@aimpact/ailearn-sdk@1.0.0/reactive/entities/collection","@aimpact/ailearn-sdk@1.0.0/reactive/model","@aimpact/chat-sdk@1.3.0/session","@aimpact/http-suite@0.0.1/api","@aimpact/ailearn-sdk@1.0.0/config","@aimpact/ailearn-sdk@1.0.0/reactive/entities/item"],function(i,e){var t,r,s,a,o,n,d,p,c;return i({Groups:void 0,DataProvider:void 0,GroupItem:void 0}),{setters:[function(e){t=e},function(e){r=e},function(e){s=e},function(e){a=e},function(e){o=e},function(e){n=e},function(e){d=e}],execute:function(){c=t.Bundle,(p=new c({module:{vspecifier:"@aimpact/ailearn-sdk@1.0.0/groups"},type:"ts"},e.meta.url).package()).dependencies.update([["@aimpact/ailearn-sdk/reactive/entities/collection",r],["@aimpact/ailearn-sdk/reactive/model",s],["@aimpact/chat-sdk/session",a],["@aimpact/http-suite/api",o],["@aimpact/ailearn-sdk/config",n],["@aimpact/ailearn-sdk/reactive/entities/item",d]]),(c=new Map).set("./collection",{hash:2400583736,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Groups=void 0;var r=e("@aimpact/ailearn-sdk/reactive/entities/collection"),i=e("./data-provider");class s extends r.Collection{constructor(e,t){super({entity:e,item:t,dataProvider:i.DataProvider})}}t.Groups=s}}),c.set("./data-provider",{hash:412059673,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DataProvider=void 0;var r=e("@aimpact/ailearn-sdk/reactive/model"),i=e("@aimpact/chat-sdk/session"),s=e("@aimpact/http-suite/api"),a=e("@aimpact/ailearn-sdk/config"),o=e("./error");class n extends r.ReactiveModel{#api;#model;#entity;constructor(e){super(),this.#api=new s.Api(a.default.params.apis.ailearn),this.#model=e,this.#entity=e.entity}setModel(e){this.#model=e}async load(e){return this.#api.bearer(i.sessionWrapper.user.token),(await this.#api.get(`/${this.#entity}/`+e.id)).data}async publish(e={}){if(this.#api.bearer(i.sessionWrapper.user.token),(e=await this.#api.post("/"+this.#entity,e)).status)return e;throw new o.CustomError(e.error.text,e.error.code)}async list(e){try{return this.#api.bearer(i.sessionWrapper.user.token),(await this.#api.get("/"+this.#entity)).data.items}catch(e){console.error(e)}}test(){}async invite(e={}){try{this.#api.bearer(i.sessionWrapper.user.token);var t=await this.#api.post(`/${this.#entity}/${this.#model.id}/invite`,e);if(t.status)return t;throw new Error("error publishing organization")}catch(e){console.error(e)}}async cancelInvitation(e={}){try{this.#api.bearer(i.sessionWrapper.user.token);var t=await this.#api.delete(`/${this.#entity}/${this.#model.id}/invitations/user/`+e.email,e);if(t.status)return t;throw new Error("error publishing organization")}catch(e){console.error(e)}}async join(e={}){if(this.#api.bearer(i.sessionWrapper.user.token),(e=await this.#api.post(`/${this.#entity}/join`,e)).status)return e;if(42===e.error.code||41===e.error.code)throw new Error("ALREADY_MEMBER");if(39===e.error.code)throw new Error("ALREADY_WAITING");if(44===e.error.code)throw new Error("INVALID_CODE");throw new Error("ERROR_PUBLISHING")}async approve(e={}){if(this.#api.bearer(i.sessionWrapper.user.token),(e=await this.#api.post(`/${this.#entity}/${this.#model.id}/approve`,e)).status)return e;throw new o.CustomError(e.error.text,e.error.code)}async delete(e){if(this.#api.bearer(i.sessionWrapper.user.token),(e=await this.#api.delete(`/${this.#entity}/`+e.id)).status)return e;throw new o.CustomError(e.error.text,e.error.code)}async removeMember(e){if(this.#api.bearer(i.sessionWrapper.user.token),(e=await this.#api.delete(`/${this.#entity}/${e.id}/user/`+e.uid)).status)return e;throw new o.CustomError(e.error.text,e.error.code)}async reject(e){try{this.#api.bearer(i.sessionWrapper.user.token);var t=await this.#api.post(`/${this.#entity}/${e.id}/requests/user/${e.uid}/reject`,{});if(t.status)return t;throw new Error("Error rejecting the user from the "+this.#entity)}catch(e){console.error(e)}}}t.DataProvider=n}}),c.set("./error",{hash:1142626891,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CustomError=void 0;class r extends Error{message;code;constructor(e,t){super(e),this.name="CustomError",this.code=t,this.message=e}}t.CustomError=r}}),c.set("./item",{hash:785980699,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.GroupItem=void 0;var r=e("@aimpact/ailearn-sdk/reactive/entities/item"),i=e("./data-provider"),s=e("@aimpact/chat-sdk/session");class a extends r.Item{#hasAccess=!1;get hasAccess(){return this.#hasAccess}#members=[];get members(){return this.#members}#managers=[];get managers(){return this.#managers}#pendings=[];get pendings(){return this.#pendings}#isAdmin;get isAdmin(){return this.#isAdmin}get authorizedPeople(){return this.people.filter(e=>e.authorized)}#ready=!1;get ready(){return this.#ready}constructor(e,{properties:t,...r}){super({entity:e,...r,dataProvider:i.DataProvider,properties:["timeCreated","timeUpdated","name","address","description","people","joinSpecs","id",...t]}),this.dataProvider.setModel(this)}async load(e){if(await super.load({id:e??this.id}),this.people){this.#hasAccess=!0;let t=(e=this.people).some(e=>"manager"===e.role&&e.uid===s.sessionWrapper.user.id);this.#isAdmin=t,this.#ready=!0,e.forEach(e=>{!t||e.authorized&&!e.invited?e.role&&("manager"===e.role?this.#managers:this.#members).push(e):this.#pendings.push(e)})}}async approve(e){if(!e||!e.uid)throw new Error("Invalid specifications provided.");(await this.dataProvider.approve(e)).status;let t=e.uid;if(-1===(r=this.#pendings.findIndex(e=>e.uid===t)))throw new Error(`Pending member with id ${t} not found.`);var[r]=this.#pendings.splice(r,1);("member"===e.role?this.#members:this.#managers).push(r),this.triggerEvent()}async removeMember(t){(await this.dataProvider.removeMember(t)).status&&(this.people=this.people.filter(e=>e.uid!==t.uid),this.#managers=this.#managers.filter(e=>e.uid!==t.uid),this.#members=this.#members.filter(e=>e.uid!==t.uid),this.triggerEvent())}async reject(t){(await this.dataProvider.reject({id:this.id,...t})).status&&(this.people=this.people.filter(e=>e.uid!==t.uid),this.#pendings=this.#pendings.filter(e=>e.uid!==t.uid),this.triggerEvent())}async invite(e){var t=await this.dataProvider.invite(e),e={...e,invited:!0};return this.people.push(e),this.#pendings.push(e),this.trigger("change"),t}async cancelInvitation(t){(await this.dataProvider.cancelInvitation(t)).status&&(this.people=this.people.filter(e=>e.email!==t.email),this.#pendings=this.#pendings.filter(e=>e.email!==t.email),this.triggerEvent())}async delete(){var e=await this.dataProvider.delete({id:this.id});return e.status&&this.triggerEvent(),e}}t.GroupItem=a}}),p.exports.descriptor=[{im:"./collection",from:"Groups",name:"Groups"},{im:"./data-provider",from:"DataProvider",name:"DataProvider"},{im:"./item",from:"GroupItem",name:"GroupItem"}],p.exports.process=function({require:e,prop:t,value:r}){!e&&"Groups"!==t||i("Groups",e?e("./collection").Groups:r),!e&&"DataProvider"!==t||i("DataProvider",e?e("./data-provider").DataProvider:r),!e&&"GroupItem"!==t||i("GroupItem",e?e("./item").GroupItem:r)},i("__beyond_pkg",p),i("hmr",new function(){this.on=(e,t)=>p.hmr.on(e,t),this.off=(e,t)=>p.hmr.off(e,t)}),p.initialise(c)}}});