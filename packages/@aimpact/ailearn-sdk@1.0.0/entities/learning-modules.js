System.register(["@beyond-js/kernel@0.1.9/bundle","@aimpact/http-suite@0.0.1/api","@aimpact/ailearn-sdk@1.0.0/reactive/entities/collection","@aimpact/ailearn-sdk@1.0.0/reactive/model","@aimpact/ailearn-sdk@1.0.0/config","@aimpact/ailearn-sdk@1.0.0/reactive/entities/item","zod@3.23.8","@aimpact/chat-sdk@1.3.0/session"],function(s,e){var t,i,a,r,n,o,c,d,u,p;return s({Activity:void 0,ActivityTypes:void 0,LearningModules:void 0,LearningModule:void 0,Credits:void 0,Draft:void 0,IActivityDraftData:void 0,ISuggestionResponse:void 0,ILearningModuleDraft:void 0,IOwnerData:void 0,ICreditsConsumptionsData:void 0,ActivityType:void 0,IActivityObjective:void 0,IActivityBase:void 0,IContentTheoryActivity:void 0,ICharacterTalkActivity:void 0,IDebateActivity:void 0,IMultipleChoiceActivity:void 0,ISpokenActivity:void 0}),{setters:[function(e){t=e},function(e){i=e},function(e){a=e},function(e){r=e},function(e){n=e},function(e){o=e},function(e){c=e},function(e){d=e}],execute:function(){p=t.Bundle,(u=new p({module:{vspecifier:"@aimpact/ailearn-sdk@1.0.0/entities/learning-modules"},type:"ts"},e.meta.url).package()).dependencies.update([["@aimpact/http-suite/api",i],["@aimpact/ailearn-sdk/reactive/entities/collection",a],["@aimpact/ailearn-sdk/reactive/model",r],["@aimpact/ailearn-sdk/config",n],["@aimpact/ailearn-sdk/reactive/entities/item",o],["zod",c],["@aimpact/chat-sdk/session",d]]),(p=new Map).set("./activities/collection",{hash:3631286273,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Activities=void 0;var i=e("@aimpact/http-suite/api"),s=e("@aimpact/ailearn-sdk/reactive/model"),a=e("./item"),r=e("@aimpact/ailearn-sdk/config");class n extends s.ReactiveModel{#api;#learningModule;#map=new Map;get items(){return[...this.#map.values()]}#saveTimeout;constructor(e,t){super(),this.#api=new i.Api(r.default.params.apis.ailearn),this.#learningModule=e}setParent(e){this.#learningModule=e}getItems(){let t=[];return this.#map.forEach(e=>t.push(e.getProperties())),t}get valid(){return this.items.every(e=>"completed"===e.state)}clear(){this.#map.clear(),this.trigger("change")}get availableTypes(){return["content-theory","debate","multiple-choice","character-talk","spoken"]}setItems(e){return e.forEach((e,t)=>{this.#map.has(e.id)?this.#map.get(e.id).set(e):(e=new a.Activity(this.#learningModule,{...e,index:t}),this.#map.set(e.id,e))}),{updated:!0}}set(e){return Array.isArray(e)?this.setItems(e):super.set(e)}async add(e,t=0){return e=new a.Activity(this.#learningModule,{type:e,order:this.items.length,language:this.#learningModule.language}),this.#map.set(e.id,e),await this.#learningModule.saveDraft(),e}async reorder(e){e.forEach((e,t)=>{e.order=t}),this.#saveTimeout&&clearTimeout(this.#saveTimeout),this.#saveTimeout=setTimeout(()=>this.#learningModule.saveDraft(),500)}async remove(e){this.#map.has(e)?(this.#map.delete(e),await this.#learningModule.saveDraft(),this.trigger("change")):console.warn("The activity",e,"does not exist in the collection")}clean(){}get(e){return this.#map.get(e)}has(e){return this.#map.has(e)}}t.Activities=n}}),p.set("./activities/item",{hash:1452398887,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Activity=void 0;var i=e("@aimpact/http-suite/api"),s=e("@aimpact/ailearn-sdk/reactive/entities/item"),a=e("./materials"),r=e("../suggestions"),n=e("@aimpact/chat-sdk/session"),o=e("@aimpact/ailearn-sdk/config"),c=e("./specs/factory");class d extends s.Item{#api;#suggestions;get state(){return this.specs.valid?"completed":"processing"}get prepared(){return this.specs.objective&&this.title&&this.description}#learningModule;constructor(e,t={}){super({...t,entity:"LearningModuleActivity",properties:["id","type","title","description","order","types","duration",{name:"materials",value:a.ActivityMaterials},{name:"specs",value:c.ActivitySpecsFactory.get(t.type)},"picture","language","pictureSuggestions","type"]}),this.#learningModule=e,this.#suggestions=new r.Suggestions,this.#api=new i.Api(o.default.params.apis.ailearn),this.initialize(t),this.materials.setParents(this,this.#learningModule),this.specs?.setParents(this,this.#learningModule),this.specs.on("properties.changed",()=>{this.triggerEvent("properties.changed")})}async generate(e){try{this.fetching=!0;var t=await this.#getSuggestions({type:"activity",id:this.#learningModule.id,activity:this.type,activityId:this.id,language:this.language,notes:e});return await this.set(t),this.#learningModule.saveDraft(),t}catch(e){throw new Error(e.message)}finally{this.fetching=!1}}async#getSuggestions(e){return e=await this.#suggestions.generate(e),await this.#learningModule.set({credits:e.credits}),e}async generatePicture(e=""){if(!e)throw new Error("Prompt is required to generate a picture for the activity.");e=(t=(t={es:{prefix:"Ilustación:",sufix:"genera la imagen en formato 16:9."},en:{prefix:"Illustration:",sufix:"generate the image in 16:9 format."},de:{prefix:"Illustration:",sufix:"generieren Sie das Bild im 16:9-Format."}})[this.language]??t.en).prefix+` ${e} `+t.sufix;var t=(await this.#suggestions.image({prompt:e,size:"1792x1024",format:"url"})).url,e=(this.#api.bearer(n.sessionWrapper.user.token),`/modules/drafts/${this.#learningModule.id}/activities/${this.id}/image`),e=await this.#api.post(e,{url:t});if(this.#learningModule.set({credits:e.data.credits}),this.#learningModule.trigger("credits.change"),this.picture=e.data.picture,this.triggerEvent("image.generated"),e.status)return this.picture;throw new Error(e.error)}async clearContent(){await this.specs.clear(),await this.#learningModule.saveDraft()}async save(e){return e&&await this.set(e),super.save(this.getProperties()),e=await this.#learningModule.saveDraft(),this.trigger("activity.saved"),e}remove(e){}}t.Activity=d}}),p.set("./activities/materials/index",{hash:256919260,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ActivityMaterials=void 0;var i=e("@aimpact/http-suite/api"),s=e("@aimpact/ailearn-sdk/reactive/model"),a=e("@aimpact/ailearn-sdk/config"),r=e("@aimpact/chat-sdk/session");class n extends s.ReactiveModel{#api;#parent;#learningModule;#emptyData={article:"",synthesis:"",introduction:"",dyslexia:"",flashcard:{}};constructor(){super({properties:["article","synthesis","introduction","dyslexia","flashcard","audios"]}),this.#api=new i.Api(a.default.params.apis.ailearn)}setParents=(e,t)=>{this.#parent=e,this.#learningModule=t};getData(){return this.getProperties()}clear(){this.set(this.#emptyData)}async generateContent(e){try{this.#api.bearer(r.sessionWrapper.user.token);var t=`/modules/drafts/${this.#learningModule.id}/activities/${this.#parent.id}/materials/article`,{status:i,data:s}=await this.#api.post(t,{title:this.#parent.title,objective:this.#parent.specs.objective,notes:e});if(this.set(s),await this.#learningModule.saveDraft({credits:s.credits}),this.#learningModule.trigger("credits.change"),i)return this.set(s),s;throw new Error("error generating article material")}catch(e){console.error(e)}finally{this.fetching=!1}}async generate(e,t){if(this.fetching=!0,"article"===e)return this.generateContent(t);this.#api.bearer(r.sessionWrapper.user.token);var e=`/modules/drafts/${this.#learningModule.id}/activities/${this.#parent.id}/materials`,{status:e,data:t}=await this.#api.post(e,{title:this.#parent.title,type:this.#parent.type,description:this.#parent.description,article:this.article,language:this.#parent.language,objective:this.#parent.specs.objective,notes:t});if(e)return this.set(t),await this.#learningModule.saveDraft(t),this.fetching=!1,this.#learningModule.trigger("credits.change"),t;throw new Error("error generating materials")}async generateAudio(e){this.#api.bearer(r.sessionWrapper.user.token);var t=`/modules/drafts/${this.#learningModule.id}/activities/${this.#parent.id}/materials/audio`,{status:t,data:i}=await this.#api.post(t,{});if(t)return await Promise.all([this.#learningModule.set({credits:i.credits}),this.set(i)]),this.#learningModule.trigger("credits.change"),i;throw new Error("error generating article material")}async deleteAudios(){return this.set({audios:void 0}),this.#learningModule.saveDraft()}}t.ActivityMaterials=n}}),p.set("./activities/specs/base",{hash:332691888,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ActivitySpecs=void 0;var i=e("@aimpact/ailearn-sdk/reactive/model"),s=e("../../suggestions");class a extends i.ReactiveModel{get structure(){return{}}#learningModule;#parent;ignoredProperties=["objective"];#suggestions;get suggestions(){return this.#suggestions}get valid(){return Object.entries(this.structure).every(([e,t])=>{var i,s;return"array"===t.type?(i=this[e],s=t.fields,Array.isArray(i)&&0<i.length&&i.every(t=>Object.keys(s).every(e=>t[e]))):!!t.optional||!!this[e]})}constructor(e={properties:[]}){super({...e,properties:["objective",...e.properties]}),this.#suggestions=new s.Suggestions}empty(){let e=!0,t=0;for(;e&&t<this.properties.length;)"objective"!==this.properties[t]&&this[this.properties[t]]&&(e=!1),t++;return e}setParents(e,t){this.#parent=e,this.#learningModule=t}set(e){return super.set(e),this.trigger("properties.changed"),{updated:!0}}async clear(){this.properties.forEach(e=>{"objective"!==e&&(this[e]=void 0)}),this.trigger("specs.cleaned")}async generate(e,t){this.fetching=!0;try{var i=await this.suggestions.generate({type:"specifications",id:this.#learningModule.id,activityId:this.#parent.id,activity:this.#parent.type,notes:"string"==typeof e?e:e?.notes,...t});return await this.set(i),this.#parent.save(),this.trigger("specs.generated"),i}catch(e){throw this.fetching=!1,e}}getLearningModule(){return this.#learningModule}getParent(){return this.#parent}}t.ActivitySpecs=a}}),p.set("./activities/specs/character-talk",{hash:2769880414,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterTalkActivitySpecs=void 0,e=e("./base");class i extends e.ActivitySpecs{get structure(){return{role:"input",task:"textarea",instructions:{type:"textarea",optional:!0},objectives:{type:"array",fields:{name:"input",objective:"textarea"}}}}constructor(e={}){super({...e,properties:["objective","role","objectives","task","instructions"]})}}t.CharacterTalkActivitySpecs=i}}),p.set("./activities/specs/chat",{hash:3437788342,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ChatActivitySpecs=void 0,e=e("./base");class i extends e.ActivitySpecs{constructor(e={}){super({...e,properties:["objective","objectives"]})}}t.ChatActivitySpecs=i}}),p.set("./activities/specs/content-theory",{hash:867459663,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ContentTheoryActivitySpecs=void 0,e=e("./base");class i extends e.ActivitySpecs{get structure(){return{topic:"input",task:"textarea",objectives:{type:"array",fields:{name:"input",objective:"textarea"}},instructions:{type:"textarea",optional:!0}}}constructor(e={}){super({...e,properties:["objective","role","objectives","task","instructions","topic"]})}}t.ContentTheoryActivitySpecs=i}}),p.set("./activities/specs/debate",{hash:2533423074,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DebateActivitySpecs=void 0,e=e("./base");class i extends e.ActivitySpecs{get structure(){return{subject:"input",role:"textarea",task:"textarea",instructions:{type:"textarea",optional:!0},objectives:{type:"array",fields:{name:"input",objective:"textarea"}}}}constructor(e={}){super({...e,properties:["objective","role","instructions","subject","objectives","task"]})}}t.DebateActivitySpecs=i}}),p.set("./activities/specs/factory",{hash:3925601858,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ActivitySpecsFactory=void 0;var i=e("./character-talk"),s=e("./chat"),a=e("./content-theory"),r=e("./debate"),n=e("./multiple-choice"),e=e("./spoken");class o{static registry=new Map;static register(e,t){this.registry.set(e,t)}static create(e){var t=this.registry.get(e);if(t)return new t;throw new Error(`Activity type "${e}" is not registered.`)}static get(e){return this.registry.has(e)||console.warn("the activity type passed is not registered, type: "+e),this.registry.get(e)}}(t.ActivitySpecsFactory=o).register("chat",s.ChatActivitySpecs),o.register("debate",r.DebateActivitySpecs),o.register("character-talk",i.CharacterTalkActivitySpecs),o.register("content-theory",a.ContentTheoryActivitySpecs),o.register("multiple-choice",n.MultipleChoiceActivitySpecs),o.register("spoken",e.SpokenActivitySpecs)}}),p.set("./activities/specs/multiple-choice",{hash:3954746659,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MultipleChoiceActivitySpecs=void 0,e=e("./base");class i extends e.ActivitySpecs{ignoredProperties=["objective","related"];get structure(){return{questions:{type:"array",fields:{question:"input",answers:{type:"array",fields:{answer:"input",correct:"boolean"}}}}}}get valid(){return!(!this.questions||!this.questions.length)&&this.questions.every(e=>e.question&&0<e.options.length&&0<=e.correctAnswer&&e.correctAnswer<e.options.length)}constructor(e={}){super({...e,properties:["questions","related"]})}async generate(e,{related:t}){return(t=await this.suggestions.generate({type:"questions",id:this.getLearningModule().id,related:t,notes:"string"==typeof e?e:e?.notes})).error||(this.set(t),this.getLearningModule().saveDraft(),this.trigger("specs.generated")),t}async generateAnswers({notes:e,question:t}){return this.fetching=!0,(await this.suggestions.generate({type:"answers",id:this.getLearningModule().id,question:t,notes:e})).options}}t.MultipleChoiceActivitySpecs=i}}),p.set("./activities/specs/spoken",{hash:990312585,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SpokenActivitySpecs=void 0,e=e("./base");class i extends e.ActivitySpecs{get structure(){return{task:"textarea",assessment:"textarea",criteria:{type:"array",fields:{name:"input",subject:"textarea"}}}}constructor(e={}){super({...e,properties:["objective","task","assessment","criteria"]})}}t.SpokenActivitySpecs=i}}),p.set("./activity-types",{hash:2374617754,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ActivityTypes=void 0;var i=e("./types/module-activities");t.ActivityTypes=new class{#types=[{id:i.ActivityType.ContentTheory,name:"Content/Theory",specs:["objective"],aiContent:["title","description","objective"],materials:[{name:"article"},{dependencies:"article",name:"synthesis"},{dependencies:"article",name:"dyslexia"},{dependencies:["article"],name:"audios"}],fields:["language"]},{id:i.ActivityType.Debate,name:"Debate",specs:["objective","subject"],aiContent:["title","description","objective"]},{id:i.ActivityType.CharacterTalk,name:"Character Talk",specs:["objective","role"],aiContent:["title","description","objective","role"],fields:["language"]},{id:i.ActivityType.MultipleChoice,name:"Multiple-Choice",specs:["questions"],materials:[],suggestions:"questions",fields:["questions","language"]},{id:i.ActivityType.Spoken,name:"Spoken",aiContent:["title","description","objective"],fields:["language"],specs:["objective","assessment","task",{name:"criteria",fields:["name","subject"]}]}];get items(){return this.#types}#map=new Map;get entries(){return this.#map}constructor(){this.#types.forEach(e=>{this.#map.set(e.id,e.id)})}get(e){return this.#map.get(e)}}}}),p.set("./assignments/collection",{hash:2151746492,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Assignments=void 0,e=e("@aimpact/ailearn-sdk/reactive/entities/collection");class i extends e.Collection{constructor(e){super(e)}}t.Assignments=i}}),p.set("./assignments/item",{hash:1059948364,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Assignment=void 0;var i=e("@aimpact/ailearn-sdk/reactive/entities/item"),s=e("zod");class a extends i.Item{schema=s.z.object({id:s.z.string(),name:s.z.string(),description:s.z.string().optional()});constructor(e={}){super({...e,properties:[]})}}t.Assignment=a}}),p.set("./collection",{hash:2666864610,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LearningModules=void 0,e=e("@aimpact/ailearn-sdk/reactive/entities/collection");class i extends e.Collection{constructor(e){super({entity:"LearningModule",...e})}}t.LearningModules=i}}),p.set("./community",{hash:1076592687,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LearningModule=void 0;var i=e("@aimpact/ailearn-sdk/reactive/entities/item"),s=e("./suggestions"),a=e("./activities/collection"),r=e("@aimpact/http-suite/api"),n=e("@aimpact/ailearn-sdk/config"),o=e("./credits"),c=e("./provider");class d extends i.Item{#suggestions;#saved;static instances=new Map;#api;#assignments;#credits;get credits(){return{...this.#credits.getProperties(),available:this.#credits.available}}set credits(e){e&&this.#credits.set(e)}#activities;get activities(){return this.#activities}set activities(e){this.#activities.clear(),this.#activities.set(e),this.triggerEvent()}constructor({id:e=void 0,type:t="module",...i}){super({id:e,entity:"LearningModule",dataProvider:c.ModuleProvider,properties:["id","title","description","status","userId","picture","duration","ia","audience","language","objective","audience","duration","audience","public","playground","totalActivities","target","duration","type","owner","creator","timeCreated","timeUpdated","pictureSuggestions","state","manual"]}),this.#credits=new o.Credits,this.#suggestions=new s.Suggestions,this.#credits=new o.Credits,this.defineReactiveProps(["fetchingDraft"]),this.#activities=new a.Activities(this),this.#activities.on("change",this.triggerEvent),this.#api=new r.Api(n.default.params.apis.ailearn),this.initialize({...i})}set(e){var t=super.set(e);return e.assignments&&this.#assignments.set(e.assignments),this.credits=e.credits,e.activities&&this.#activities.set(e.activities),t}async saveDraft(e={}){return e={...this.getProperties(),...e,activities:this.activities.getItems(),type:"draft"},this.#saved=!0,e=super.publish(e),d.instances.set(this.id,this),e}async getModuleSuggestion(e){try{this.fetchingDraft=!0,this.set(e);var t=await this.#getSuggestions({id:this.id,objective:this.objective,type:"module",observations:e.notes,notes:e.notes});t.title||console.warn("the activity was generated without title",t),await this.set({...t,id:t.id,state:"mudule-generated"}),await this.saveDraft({state:"confirmed"}),this.fetchingDraft=!1,this.triggerEvent("activities.generated")}catch(e){throw new Error("ERR_GENERATING_ACTIVITIES")}finally{this.fetchingDraft=!1}}async#getSuggestions(e){return e=await this.#suggestions.generate(e),await this.#credits.set(e.credits),this.trigger("credits.change"),e}async load(){var e=await this.dataProvider.load();this.set(e),this.activities.setItems(e.activities)}static async get(e){var t;return e?.id&&this.instances.has(e.id)?this.instances.get(e.id):(t=new d(e),e.id&&await t.load(),e.id&&this.instances.set(e.id,t),t)}}t.LearningModule=d}}),p.set("./credits/index",{hash:3358821034,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Credits=void 0,e=e("@aimpact/ailearn-sdk/reactive/model");class i extends e.ReactiveModel{get available(){return this.total-this.consumed||0}constructor(e){super({properties:["consumed","total"],...e})}}t.Credits=i}}),p.set("./credits/types",{hash:2037358772,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),p.set("./draft",{hash:2812231193,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Draft=void 0;var s=e("./suggestions"),a=e("./activities/collection"),r=e("./credits"),e=e("./item");class i extends e.LearningModule{#suggestions;#saved;#assignments;get valid(){return!!(this.id&&this.title&&this.description&&this.objective)}constructor({id:e=void 0,type:t="module",...i}){super({id:e,type:t,properties:[{name:"credits",value:r.Credits},{name:"activities",value:a.Activities}],...i}),this.#suggestions=new s.Suggestions,this.defineReactiveProps(["fetchingDraft"]),this.initialize({...i})}async saveDraft(e={}){return e={...this.getProperties(),...e,activities:this.activities.getItems(),type:"draft"},this.#saved=!0,e=super.publish(e)}async getModuleSuggestion(t){try{this.fetchingDraft=!0,this.set(t),await this.saveDraft();let e=await this.#getSuggestions({id:this.id,objective:this.objective,type:"module",observations:t.notes,notes:t.notes,totalActivities:t.totalActivities});return e.title||console.warn("the activity was generated without title",e),setTimeout(async()=>{await this.saveDraft({...e,state:"confirmed"}),this.fetchingDraft=!1,this.triggerEvent("activities.generated")},10),e}catch(e){throw new Error("ERR_GENERATING_ACTIVITIES")}finally{this.fetchingDraft=!1}}async#getSuggestions(e){return e=await this.#suggestions.generate(e),await this.set(e),this.trigger("credits.change"),e}async load(){var e=await this.dataProvider.load();this.set(e),this.activities.setItems(e.activities)}consumeCoins=async()=>{var e=await this.dataProvider.consumeCoins();return e.status&&(await this.set(e.data),this.trigger("credits.change","add")),e};async getObjectiveImprovements({objective:e}){try{return this.fetching=!0,await this.#getSuggestions({type:"objective",id:this.id,objective:e})}catch(e){throw new Error("ERR_GENERATING_ACTIVITIES")}finally{this.fetching=!1}}async generateObjective({objective:e,improvements:t}){try{return this.fetching=!0,await this.#getSuggestions({type:"objective-refinements",improvements:t,id:this.id,objective:e})}catch(e){throw new Error("ERR_GENERATING_ACTIVITIES")}finally{this.fetching=!1}}async generatePicture(e=""){try{if(!e)throw new Error("Prompt is required");var t={es:{prefix:"Ilustación:",sufix:"genera la imagen en formato 16:9."},en:{prefix:"Illustration:",sufix:"generate the image in 16:9 format."},de:{prefix:"Illustration:",sufix:"generieren Sie das Bild im 16:9-Format."}},i=t[this.language]??t.en,s=(e=i.prefix+` ${e} `+i.sufix,await this.#suggestions.image({prompt:e,size:"1792x1024",format:"url"})),a=await this.dataProvider.savePicture(s.url);if(this.set(a.data),this.trigger("credits.change"),this.picture=a.data.picture+"?"+performance.now(),this.triggerEvent("image.generated"),a.status)return this.picture;throw new Error("error saving image")}catch(e){console.error(e)}}}t.Draft=i}}),p.set("./item",{hash:1687928503,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LearningModule=void 0;var i=e("@aimpact/ailearn-sdk/reactive/entities/item"),a=e("./suggestions"),r=e("./provider");class s extends i.Item{#suggestions;#saved;static instances=new Map;#assignments;get valid(){return!!(this.id&&this.title&&this.description&&this.objective)}get completed(){return this.valid&&this.activities.valid}constructor({id:e=void 0,properties:t,type:i="module",...s}){super({id:e,entity:"LearningModule",dataProvider:r.ModuleProvider,properties:[...t,"id","title","description","status","userId","picture","duration","ia","audience","language","objective","audience","duration","audience","public","playground","totalActivities","target","duration","type","owner","creator","timeCreated","timeUpdated","pictureSuggestions","state","manual"]}),this.#suggestions=new a.Suggestions,this.activities.setParent(this),this.defineReactiveProps(["fetchingDraft"]),this.initialize({...s})}async saveDraft(e={}){return e={...this.getProperties(),...e,activities:this.activities.getItems(),type:"draft"},this.#saved=!0,e=super.publish(e),console.log(.3),s.instances.set(this.id,this),e}async load(){var e=await this.dataProvider.load();this.set(e),this.activities.setItems(e.activities)}static async get(e){var t;return e?.id&&this.instances.has(e.id)?this.instances.get(e.id):(t=new s(e),e.id&&await t.load(),e.id&&this.instances.set(e.id,t),t)}}t.LearningModule=s}}),p.set("./provider/index",{hash:3075280971,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ModuleProvider=void 0;var i=e("@aimpact/ailearn-sdk/reactive/model"),s=e("@aimpact/http-suite/api"),a=e("@aimpact/ailearn-sdk/config"),r=e("@aimpact/chat-sdk/session");class n extends i.ReactiveModel{#api;#parent;constructor(e){super(),this.#api=new s.Api(a.default.params.apis.ailearn),this.#parent=e}load=async e=>{this.#api.bearer(r.sessionWrapper.user.token);var{status:t,data:i}=await this.#api.get("/modules/drafts/"+this.#parent.id);if(t)return i;throw new Error("error loading module")};list=async e=>{this.#api.bearer(r.sessionWrapper.user.token);var{status:t,data:i}=await this.#api.get("/modules/drafts/"+this.#parent.id);return{status:t,data:i}};async getDraft(e){this.#api.bearer(r.sessionWrapper.user.token);var{status:e,data:t}=await this.#api.get("/modules/drafts/"+e);if(e)return t;throw new Error("error getting module draft")}async delete(){return this.#api.bearer(r.sessionWrapper.user.token),this.#api.delete("/modules/drafts/"+this.#parent.id)}async deleteItem(){return this.#api.bearer(r.sessionWrapper.user.token),this.#api.delete("/modules/"+this.#parent.id)}async publish(e={}){return"draft"===e.type?this.saveDraft(e):(this.#api.bearer(r.sessionWrapper.user.token),this.#api.post(`/modules/drafts/${this.#parent.id}/publish`,e))}async saveDraft(e){return this.#api.bearer(r.sessionWrapper.user.token),(e=await this.#api.post("/modules/drafts",e)).status,e}async consumeCoins(){return this.#api.bearer(r.sessionWrapper.user.token),this.#api.post(`/modules/drafts/${this.#parent.id}/coins/consume`,{})}async clone({moduleId:e,ownerId:t,entity:i,type:s}){return this.#api.bearer(r.sessionWrapper.user.token),s=(e={community:`/community/modules/${e}/clone`,module:`/modules/${e}/clone`})[s]??e.module,r.sessionWrapper.user.id===t||"user"===i?this.#api.post(s,{}):this.#api.post(s,{organizationId:t,entity:i})}async savePicture(e){return this.#api.bearer(r.sessionWrapper.user.token),this.#api.post(`/modules/drafts/${this.#parent.id}/image`,{url:e})}}t.ModuleProvider=n}}),p.set("./suggestions/index",{hash:3772059283,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Suggestions=void 0;var i=e("@aimpact/ailearn-sdk/reactive/model"),s=e("@aimpact/http-suite/api"),a=e("@aimpact/ailearn-sdk/config"),r=e("@aimpact/chat-sdk/session");class n extends i.ReactiveModel{#api;constructor(){super(),this.reactiveProps(["type","content"]),this.#api=new s.Api(a.default.params.apis.ailearn)}async generate(e){try{this.#api.bearer(r.sessionWrapper.user.token);var t,i=await this.#api.post("/suggestions",{...e});return i.status?i.data:(t=i.error.text,t.includes("The related activity")?{error:"NO_RELATED_ACTIVITY"}:t.includes("The draft does not have the following parameters to process the suggestion:")?{error:"INCOMPLETE_MODULE",fields:t.split(":")[1]}:{error:t})}catch(e){throw new Error(e.message)}}async image(e){if(this.#api.bearer(r.sessionWrapper.user.token),(e=await this.#api.post("/images/generate",{language:"es",...e})).status)return e.data[0];throw new Error(e.error.code)}}t.Suggestions=n}}),p.set("./types/activities",{hash:2813416681,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),p.set("./types/draft-improvements",{hash:2979653217,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),p.set("./types/drafts",{hash:1841187194,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),p.set("./types/index",{hash:1067830134,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),p.set("./types/interfaces",{hash:3371199714,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),p.set("./types/learning-module",{hash:3158504342,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),p.set("./types/module-activities",{hash:70447942,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ActivityType=void 0,t.ActivityType={Spoken:"spoken",MultipleChoice:"multiple-choice",CharacterTalk:"character-talk",ContentTheory:"content-theory",Debate:"debate",Written:"written"}}}),u.exports.descriptor=[{im:"./activities/item",from:"Activity",name:"Activity"},{im:"./activity-types",from:"ActivityTypes",name:"ActivityTypes"},{im:"./collection",from:"LearningModules",name:"LearningModules"},{im:"./community",from:"LearningModule",name:"LearningModule"},{im:"./credits/index",from:"Credits",name:"Credits"},{im:"./draft",from:"Draft",name:"Draft"},{im:"./item",from:"LearningModule",name:"LearningModule"},{im:"./types/drafts",from:"IActivityDraftData",name:"IActivityDraftData"},{im:"./types/index",from:"ISuggestionResponse",name:"ISuggestionResponse"},{im:"./types/learning-module",from:"ILearningModuleDraft",name:"ILearningModuleDraft"},{im:"./types/learning-module",from:"IOwnerData",name:"IOwnerData"},{im:"./types/learning-module",from:"ICreditsConsumptionsData",name:"ICreditsConsumptionsData"},{im:"./types/module-activities",from:"ActivityType",name:"ActivityType"},{im:"./types/module-activities",from:"IActivityObjective",name:"IActivityObjective"},{im:"./types/module-activities",from:"IActivityBase",name:"IActivityBase"},{im:"./types/module-activities",from:"IContentTheoryActivity",name:"IContentTheoryActivity"},{im:"./types/module-activities",from:"ICharacterTalkActivity",name:"ICharacterTalkActivity"},{im:"./types/module-activities",from:"IDebateActivity",name:"IDebateActivity"},{im:"./types/module-activities",from:"IMultipleChoiceActivity",name:"IMultipleChoiceActivity"},{im:"./types/module-activities",from:"ISpokenActivity",name:"ISpokenActivity"}],u.exports.process=function({require:e,prop:t,value:i}){!e&&"Activity"!==t||s("Activity",e?e("./activities/item").Activity:i),!e&&"ActivityTypes"!==t||s("ActivityTypes",e?e("./activity-types").ActivityTypes:i),!e&&"LearningModules"!==t||s("LearningModules",e?e("./collection").LearningModules:i),!e&&"LearningModule"!==t||s("LearningModule",e?e("./community").LearningModule:i),!e&&"Credits"!==t||s("Credits",e?e("./credits/index").Credits:i),!e&&"Draft"!==t||s("Draft",e?e("./draft").Draft:i),!e&&"LearningModule"!==t||s("LearningModule",e?e("./item").LearningModule:i),!e&&"IActivityDraftData"!==t||s("IActivityDraftData",e?e("./types/drafts").IActivityDraftData:i),!e&&"ISuggestionResponse"!==t||s("ISuggestionResponse",e?e("./types/index").ISuggestionResponse:i),!e&&"ILearningModuleDraft"!==t||s("ILearningModuleDraft",e?e("./types/learning-module").ILearningModuleDraft:i),!e&&"IOwnerData"!==t||s("IOwnerData",e?e("./types/learning-module").IOwnerData:i),!e&&"ICreditsConsumptionsData"!==t||s("ICreditsConsumptionsData",e?e("./types/learning-module").ICreditsConsumptionsData:i),!e&&"ActivityType"!==t||s("ActivityType",e?e("./types/module-activities").ActivityType:i),!e&&"IActivityObjective"!==t||s("IActivityObjective",e?e("./types/module-activities").IActivityObjective:i),!e&&"IActivityBase"!==t||s("IActivityBase",e?e("./types/module-activities").IActivityBase:i),!e&&"IContentTheoryActivity"!==t||s("IContentTheoryActivity",e?e("./types/module-activities").IContentTheoryActivity:i),!e&&"ICharacterTalkActivity"!==t||s("ICharacterTalkActivity",e?e("./types/module-activities").ICharacterTalkActivity:i),!e&&"IDebateActivity"!==t||s("IDebateActivity",e?e("./types/module-activities").IDebateActivity:i),!e&&"IMultipleChoiceActivity"!==t||s("IMultipleChoiceActivity",e?e("./types/module-activities").IMultipleChoiceActivity:i),!e&&"ISpokenActivity"!==t||s("ISpokenActivity",e?e("./types/module-activities").ISpokenActivity:i)},s("__beyond_pkg",u),s("hmr",new function(){this.on=(e,t)=>u.hmr.on(e,t),this.off=(e,t)=>u.hmr.off(e,t)}),u.initialise(p)}}});