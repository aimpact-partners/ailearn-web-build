System.register(["@beyond-js/kernel@0.1.9/bundle","@beyond-js/reactive@1.2.0/entities","@beyond-js/kernel@0.1.9/core","firebase@10.12.0/auth","@aimpact/chat-sdk@1.0.1/startup","@aimpact/chat-sdk@1.0.1/api","@aimpact/chat-sdk@1.0.1/config"],function(r,e){"use strict";var t,i,s,a,n,o,d,c,h;return r({IChatUser:void 0,User:void 0}),{setters:[function(e){t=e},function(e){i=e},function(e){s=e},function(e){a=e},function(e){n=e},function(e){o=e},function(e){d=e}],execute:function(){h=t.Bundle,(c=new h({module:{vspecifier:"@aimpact/chat-sdk@1.0.1/users"},type:"ts"},e.meta.url).package()).dependencies.update([["@beyond-js/reactive/entities",i],["@beyond-js/kernel/core",s],["firebase/auth",a],["@aimpact/chat-sdk/startup",n],["@aimpact/chat-sdk/api",o],["@aimpact/chat-sdk/config",d]]),(h=new Map).set("./interface",{hash:4186078931,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),h.set("./item",{hash:1556460778,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var i=e("@beyond-js/reactive/entities"),r=e("./provider"),s=e("@beyond-js/kernel/core"),a=e("@aimpact/chat-sdk/startup");class n extends i.Item{properties=["displayName","id","email","photoURL","phoneNumber","token"];#logged;#promiseInit;#firebaseUser;get logged(){return this.#logged}get firebaseToken(){return this.#firebaseUser?this.#firebaseUser.getIdToken():null}constructor(e){super({id:e.id,db:"chat-api",storeName:"User",provider:r.UserProvider})}initialize=async e=>{if(super.initialise(),this.#promiseInit)return this.#promiseInit;this.#promiseInit=new s.PendingPromise,await this.isReady,await this.set(e),this.#promiseInit.resolve(),this.loaded=!0,this.trigger("user.initialized")};setFirebaseUser=async e=>{this.#firebaseUser=e};async login(e){if(await this.isReady,!this.#logged){if(e={...this.getProperties(),id:this.id,firebaseToken:e},(e=await this.provider.load(e)).status)return await this.set(e.data,!0),this.#logged=!0,this.trigger("login"),!0;throw new Error(e.error)}}static async getModel(e){return new(a.sdkConfig.userModel||n)(e)}}t.User=n}}),h.set("./provider",{hash:3883569924,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.UserProvider=void 0;var i=e("@aimpact/chat-sdk/api"),r=e("@aimpact/chat-sdk/startup");t.UserProvider=class{#api;constructor(){this.#api=new i.Api(r.sdkConfig.api)}async load(e){this.#api.bearer(e.firebaseToken);var{status:e,data:t}=await this.#api.post("/auth/login",e);if(e)return{status:e,data:t};throw new Error("error loading user data")}}}}),c.exports.descriptor=[{im:"./interface",from:"IChatUser",name:"IChatUser"},{im:"./item",from:"User",name:"User"}],c.exports.process=function({require:e,prop:t,value:i}){!e&&"IChatUser"!==t||r("IChatUser",e?e("./interface").IChatUser:i),!e&&"User"!==t||r("User",e?e("./item").User:i)},r("__beyond_pkg",c),r("hmr",new function(){this.on=(e,t)=>c.hmr.on(e,t),this.off=(e,t)=>c.hmr.off(e,t)}),c.initialise(h)}}});