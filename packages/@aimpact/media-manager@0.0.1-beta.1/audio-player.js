System.register(["@beyond-js/kernel@0.1.9/bundle","@beyond-js/kernel@0.1.9/styles","react@18.2.0","@beyond-js/kernel@0.1.9/core","pragmate-ui@1.0.0-beta.2/icons"],function(r,e){var t,a,n,o,u,l,i;return r("AudioPlayer",void 0),{setters:[function(e){t=e},function(e){a=e},function(e){n=e},function(e){o=e},function(e){u=e}],execute:function(){i=t.Bundle,(l=new i({module:{vspecifier:"@aimpact/media-manager@0.0.1-beta.1/audio-player"},type:"code"},e.meta.url).package()).dependencies.update([["@beyond-js/kernel/styles",a],["react",n],["@beyond-js/kernel/core",o],["pragmate-ui/icons",u]]),brequire("@beyond-js/kernel/styles").styles.register("@aimpact/media-manager@0.0.1-beta.1/audio-player"),(i=new Map).set("./context",{hash:1420102872,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useComponentAudioContext=t.ComponentAudioContext=void 0;var a=e("react");let r=t.ComponentAudioContext=(0,a.createContext)({});t.useComponentAudioContext=()=>(0,a.useContext)(r)}}),i.set("./hooks/use-audio",{hash:35183569,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useAudio=function(a,e){let t=h.default.useRef(null),[r,n]=h.default.useState(null),[o,u]=h.default.useState(null),[l,i]=h.default.useState(!1),[s,d]=h.default.useState({src:a}),[c,f]=h.default.useState(!1),m=e=>new Promise((a,t)=>{let r=new AudioContext,n=new FileReader;n.onload=()=>{var e=n.result;r.decodeAudioData(e).then(t=>{d(e=>({...e,duration:parseFloat(t.duration.toFixed(2))})),u(t),a()}).catch(t)},n.readAsArrayBuffer(e)}),p=(t,a)=>{t.addEventListener("loadedmetadata",()=>{d(e=>({...e,duration:parseFloat(t.duration.toFixed(2)),fileName:a instanceof Blob?a.name:a.split("/").pop()})),n(t),i(!0)}),t.addEventListener("error",()=>{f(!0)})};return h.default.useEffect(()=>{try{var e;a instanceof Blob?(e=new Audio,p(e,a),e.src=URL.createObjectURL(a),e.load(),m(a).catch(console.error)):fetch(a).then(async e=>{if(!e.ok)throw new Error(e.statusText);var e=await e.blob(),t=new Audio;p(t,a),t.src=URL.createObjectURL(e),t.load(),n(t),m(e).catch(console.error)}).catch(e=>{console.error(e),f(!0)})}catch(e){console.error(e.message),f(!0)}},[a]),{ready:l,audioRef:t,buffer:o,audio:r,data:s,error:c}};var h=e("react")}}),i.set("./index",{hash:2977058227,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioPlayer=function({src:e,convert:t}){let{ready:a,error:r,audio:n,data:o,buffer:u}=(0,h.useAudio)(e,t),[l,i]=p.default.useState(!1),[s,d]=p.default.useState(0);if(!a||r)return p.default.createElement(E.Preload,null);let c={play:e=>{e.stopPropagation(),n.play(),i(!0)},pause:e=>{e.stopPropagation(),n.pause(),i(!1)},restart:e=>{e.stopPropagation()}},f=l?"pause":"play",m={audio:n,data:o,playing:l,buffer:u,setPlaying:i,currentTime:s,setCurrentTime:d};return p.default.createElement(_.ComponentAudioContext.Provider,{value:m},p.default.createElement("div",{className:"player__container"},p.default.createElement(v.IconButton,{icon:f,"data-action":f,onClick:e=>{var t=e.currentTarget.dataset.action;c[t](e)}}),p.default.createElement("div",{className:"audio__container"},p.default.createElement("div",{className:"audio__thumb"},p.default.createElement(y.ProgressBar,null),p.default.createElement(g.Visualizer,null)),p.default.createElement(b.Timer,null))))};var p=e("react"),h=e("./hooks/use-audio"),v=e("pragmate-ui/icons"),_=e("./context"),y=e("./progressbar"),b=e("./timer"),g=e("./visualizer"),E=e("./preload")}}),i.set("./preload",{hash:258477212,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Preload=function({}){return a.default.createElement("div",{className:"player__container player__container--preload"},a.default.createElement(r.IconButton,{disabled:!0,icon:"play"}),a.default.createElement("div",{className:"audio__container"},a.default.createElement("div",{className:"audio__thumb"},a.default.createElement("div",{className:"range__preload"})),a.default.createElement("div",{className:"timer__container"},a.default.createElement("span",{className:"timer__numbers"},"00"),a.default.createElement("div",{className:"timer__separator"},":"),a.default.createElement("span",{className:"timer__numbers"},"00"))))};var a=e("react"),r=e("pragmate-ui/icons")}}),i.set("./progressbar",{hash:2365172175,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressBar=function(){let e=(0,i.useRef)(null),{audio:a,setCurrentTime:t,setPlaying:r,data:{duration:n}}=(0,s.useComponentAudioContext)(),[o,u]=(0,i.useState)(0),l=((0,i.useEffect)(()=>{let e=()=>{var e=a.currentTime;u(e)};return a.addEventListener("timeupdate",e),a.addEventListener("ended",e=>{r(!1),u(.1),t(.1)}),()=>{a.removeEventListener("timeupdate",e)}},[a,n]),e=>{e.stopPropagation();var t=parseFloat(e.currentTarget.value);for(let e=0;e<a.buffered.length;e++)if(a.buffered.start(e)<=t&&a.buffered.end(e)>=t)return a.currentTime=t,void u(t);console.warn("Desired time not in buffered range",a.buffered.length)});return i.default.createElement("input",{type:"range",name:"rang",onClick:l,onChange:l,title:"audio duration",value:o,ref:e,max:n})};var i=e("react"),s=e("./context")}}),i.set("./timer",{hash:2388829827,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=function(){let{data:{duration:e},audio:t}=(0,s.useComponentAudioContext)();if([1/0,void 0].includes(e))return null;let[a,r]=i.default.useState(e),n=(i.default.useEffect(()=>{t.addEventListener("play",()=>{r(t.currentTime)}),t.addEventListener("pause",()=>{r(e)}),t.addEventListener("stop",()=>{r(e)}),t.addEventListener("timeupdate",()=>{r(t.currentTime)})},[]),Math.floor(a/3600)),o=Math.floor(a%3600/60),u=Math.round(a%60),l=[];return 0<n&&l.push(i.default.createElement("span",{key:"hours",className:"timer__numbers timer__numbers--hours"},n)),o<10&&(o="0"+o),l.push(i.default.createElement(i.default.Fragment,{key:"minutes"},i.default.createElement("span",{className:"timer__numbers timer__number--minutes"},o??"00"),i.default.createElement("span",{className:"timer__separator"},":"))),u<10&&(u="0"+u),l.push(i.default.createElement("span",{key:"seconds",className:"timer__numbers timer__number--seconds"},u??"00")),i.default.createElement("section",{className:"timer__container"},l)};var i=e("react"),s=e("./context")}}),i.set("./types/IAudioInterface",{hash:2991908883,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),i.set("./visualizer",{hash:3138334151,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Visualizer=function(){let e=(0,r.useComponentAudioContext)().buffer,t=a.default.useRef(null);return a.default.useEffect(()=>{n(e,t.current)},[]),a.default.createElement(a.default.Fragment,null,a.default.createElement("canvas",{ref:t}))};var a=e("react"),r=e("./context");let n=(e,t)=>{var n,o,u,l,i=t,s=(e=>{let t=Math.pow(Math.max(...e),-1);return e.map(e=>e*t)})((()=>{if(!e)return[];var r=e.getChannelData(0),n=Math.floor(r.length/70),o=[];for(let e=0;e<70;e++){let t=n*e,a=0;for(let e=0;e<n;e++)a+=Math.abs(r[t+e]);o.push(a/n)}return o})()),t=window.devicePixelRatio||1.5,d=(i.width=i.offsetWidth*t,i.height=(i.offsetHeight+40)*t,i.getContext("2d")),t=(d.scale(t,t),d.translate(0,i.offsetHeight/2+20),d.strokeStyle="#cc0000",d.lineWidth=1,d.beginPath(),d.moveTo(0,0),d.lineTo(i.offsetWidth,0),d.stroke(),i.offsetWidth),c=Math.floor(t/4);for(let r=0;r<c;r++){let e=Math.floor(r/c*s.length),t=4*r,a=s[e]*i.offsetHeight-20;a<0?a=0:a>i.offsetHeight/2&&(a=i.offsetHeight/2),n=d,o=t,u=a,l=4,n.lineWidth=1,n.strokeStyle="#fff",n.beginPath(),n.moveTo(o+l/2,0),n.lineTo(o+l/2,-u),n.stroke(),n.beginPath(),n.moveTo(o+l/2,0),n.lineTo(o+l/2,u),n.stroke()}}}}),l.exports.descriptor=[{im:"./index",from:"AudioPlayer",name:"AudioPlayer"}],l.exports.process=function({require:e,prop:t,value:a}){!e&&"AudioPlayer"!==t||r("AudioPlayer",e?e("./index").AudioPlayer:a)},r("__beyond_pkg",l),r("hmr",new function(){this.on=(e,t)=>l.hmr.on(e,t),this.off=(e,t)=>l.hmr.off(e,t)}),l.initialise(i)}}});