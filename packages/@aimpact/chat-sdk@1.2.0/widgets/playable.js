System.register(["@beyond-js/kernel@0.1.9/bundle","@beyond-js/kernel@0.1.9/styles","react@18.2.0","pragmate-ui@1.0.0-beta.6/icons","prismjs@1.29.0","@beyond-js/react-18-widgets@1.1.2/hooks","@aimpact/chat-sdk@1.2.0/widgets/markdown"],function(r,e){"use strict";var t,a,n,o,l,s,i,c,u;return r({PlayerButton:void 0,parseText:void 0,Playable:void 0}),{setters:[function(e){t=e},function(e){a=e},function(e){n=e},function(e){o=e},function(e){l=e},function(e){s=e},function(e){i=e}],execute:function(){u=t.Bundle,(c=new u({module:{vspecifier:"@aimpact/chat-sdk@1.2.0/widgets/playable"},type:"code"},e.meta.url).package()).dependencies.update([["@beyond-js/kernel/styles",a],["react",n],["pragmate-ui/icons",o],["prismjs",l],["@beyond-js/react-18-widgets/hooks",s],["@aimpact/chat-sdk/widgets/markdown",i]]),brequire("@beyond-js/kernel/styles").styles.register("@aimpact/chat-sdk@1.2.0/widgets/playable"),(u=new Map).set("./button/PlayerButton",{hash:2994120359,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerButton=function(e){const{player:t,id:a,content:r}=e,[n,o]=u.default.useState("stop"),[,l]=u.default.useState(!1),s=a===t.id,i=s||"play"===n?"stop":"play",c=s||"play"===n?async({})=>{await t.stop(),o("stop"),l(!1)}:async({})=>{o("play"),t.positionToCut=0,await t.play(r,a)};return u.default.createElement(d.IconButton,{onClick:c,"data-listen":"api",icon:i,className:"lg"})};var u=e("react"),d=e("pragmate-ui/icons")}}),u.set("./code/clipboard",{hash:235325129,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Clipboard=function({text:e}){const n=a.default.useRef(null);return a.default.createElement("div",null,a.default.createElement("div",{className:"clipboard__container","data-text":e,ref:n,onClick:async e=>{if(e=e.currentTarget.dataset.text,navigator.clipboard)try{await navigator.clipboard.writeText(e);const r=n.current.querySelector(".action-copied");r.classList.add("show"),globalThis.setTimeout(()=>{r.classList.add("hide"),globalThis.setTimeout(()=>r.classList.remove("show","hide"),300)},500)}catch(e){console.error("some error",e)}else{var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var a=document.execCommand("copy")?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+a)}catch(e){console.error("Fallback: Oops, unable to copy",e)}}}},a.default.createElement(r.IconButton,{icon:"copy"}),a.default.createElement("span",{className:"action-copied"},"Copied")))};var a=e("react"),r=e("pragmate-ui/icons")}}),u.set("./code/code",{hash:700390424,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Code=function({language:e="typescript",children:t,clipboard:a=!0}){return r.default.createElement("div",{className:"code-container"+(a?" has-clipboard":"")},r.default.createElement("pre",null,r.default.createElement("code",{className:"regular__code language-"+e,dangerouslySetInnerHTML:t?{__html:n.highlight(t,n.languages.javascript,e)}:{__html:""}})),a&&r.default.createElement(o.Clipboard,{text:t,message:""}))};var r=e("react"),n=e("prismjs"),o=e("./clipboard")}}),u.set("./parse-content",{hash:753101501,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.parseText=void 0;const o={};t.parseText=(e,a,r)=>{if(!a)return[[],""];if("string"!=typeof a)return console.warn("Input must be a string.",a),[[],""];if(!(e in o&&o[e][1]?.length===a.length)){if(!a)return o[e]=[[],""],[[],""];a=function(t){if("string"==typeof t){var a=[];let e=0;for(const c of t.matchAll(/😸(.*?)🖋️/g)){var[r,n]=c,o=t.slice(e,c.index);if(o)a.push({type:"string",value:o});else try{var{type:l,data:s}=JSON.parse(n);a.push({type:l,data:s}),e=c.index+r.length}catch(e){console.error(e)}}var i=t.slice(e);return i&&a.push({type:"string",value:i}),a}console.warn("Input must be a string.",t)}(a);let t=[];const n=[];a.forEach(e=>{r.includes(e.type)?n.push(e):(e=e.value.split(/(```[\s\S]*?```|`[\s\S]*?`)/).filter(e=>""!==e.trim()).map(e=>({content:e,type:e.startsWith("```")||e.startsWith("`")?"code":"text"})),t=[...t,...e])}),a=t.filter(e=>"text"===e.type).map(e=>e.content).join(" "),o[e]=[t,a,n]}return o[e]}}}),u.set("./playable/index",{hash:2930800631,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Playable=void 0;var p=e("react"),y=e("@beyond-js/react-18-widgets/hooks"),f=e("../use-boundary"),m=e("../parse-content"),h=e("./item");t.Playable=p.default.memo(function({className:e,id:a,playable:r=!0,content:n,player:o,onClickWord:l}){const t=["transcription","fetching-tool-data","kb-processed-response","function","kb-response"],[s,i]=(0,m.parseText)(a,n,t);var{ref:c,text:u,removeHighlight:d}=(0,f.useBoundary)(a,o,i);if(p.default.useEffect(()=>{r&&s.filter(e=>"code"===e.type)},[!1,r]),o)return(0,y.useBinder)([o],d,"on.finish"),"string"!=typeof u?null:(d=s.filter(e=>!t.includes(e.type)).map((e,t)=>p.default.createElement(h.PlayableItem,{key:"content-"+t,onClickWord:l,text:n,block:e,index:t,id:a,playable:r,player:o})),p.default.createElement("div",{className:"playable-container"+(e?" "+e:""),ref:c},d));throw new Error("Player is not defined")})}}),u.set("./playable/interfaces/playable-props",{hash:4182143472,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),u.set("./playable/item",{hash:577460672,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PlayableItem=void 0;var i=e("react"),c=e("../code/code"),u=e("@aimpact/chat-sdk/widgets/markdown");t.PlayableItem=function({block:e,text:a,id:r,index:n,playable:t,player:o,onClickWord:l}){var s=(0,u.useMarked)(),t=t?{onClick:e=>{var t;e.preventDefault(),e.stopPropagation(),e.target.classList.contains("word")&&(e=e.target.dataset.word,t=a.split(" ").slice(e).join(" "),o.positionToCut=parseInt(e),o.textId=r,o.play(t.replaceAll(/[-\\*_#]+/g,"").trim()),l)&&l()}}:{};return"code"===e.type?i.default.createElement(c.Code,{key:"code-"+n},e.content.replaceAll("`","")):(s=s(e.content).split(" ").map(function(e,a){return e.replace(/([^<]+)|(<[^>]+>)/g,(e,t)=>t?t.split(/\s+/).map(e=>{return!e.trim()||e.match(/[\.,¿¡!\?;:\-\n\t]/)?e:`<span data-word="${t=a++}" data-index="${t}${n}" class="word">${e}</span>`;var t}).join(" "):e)}).join(" "),i.default.createElement(u.Markdown,{key:"content-"+n,"data-block":n,className:"message-text__container",...t},s))}}}),u.set("./use-boundary",{hash:1124656709,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useBoundary=function(n,o,l){const s=a.default.useRef(null),[,,]=a.default.useState(l??""),i=()=>{s.current.querySelectorAll(".highlight").forEach(e=>e.classList.remove("highlight"))};return a.default.useEffect(()=>{l=l.replaceAll(/[-\\*_#\n\t]+/g,"").trim();const e=()=>{if(n===o.textId){var t=o.currentWord,a=s.current.querySelector(".message-text__container")?.dataset.block;let e="0";if(0<o.positionToCut)return r=o.text.slice(0,t).split(" ").length-1,e=""+(o.positionToCut+r)+a,i(),s.current.querySelector(`[data-index="${e}"]`)?void s.current.querySelector(`[data-index="${e}"]`).classList.add("highlight"):void 0;var r=l.slice(0,t).split(" ").length-1;e=""+r+a,i(),s.current.querySelector(`[data-index="${e}"]`)?.classList.add("highlight")}};return o.on("boundary",e),()=>{o.off("boundary",e)}},[l]),{ref:s,text:l,removeHighlight:i}};var a=e("react")}}),c.exports.descriptor=[{im:"./button/PlayerButton",from:"PlayerButton",name:"PlayerButton"},{im:"./parse-content",from:"parseText",name:"parseText"},{im:"./playable/index",from:"Playable",name:"Playable"}],c.exports.process=function({require:e,prop:t,value:a}){!e&&"PlayerButton"!==t||r("PlayerButton",e?e("./button/PlayerButton").PlayerButton:a),!e&&"parseText"!==t||r("parseText",e?e("./parse-content").parseText:a),!e&&"Playable"!==t||r("Playable",e?e("./playable/index").Playable:a)},r("__beyond_pkg",c),r("hmr",new function(){this.on=(e,t)=>c.hmr.on(e,t),this.off=(e,t)=>c.hmr.off(e,t)}),c.initialise(u)}}});