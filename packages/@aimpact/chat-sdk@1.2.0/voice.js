System.register(["@beyond-js/kernel@0.1.9/bundle","@beyond-js/kernel@0.1.9/core","@aimpact/chat-sdk@1.2.0/config","@beyond-js/reactive@1.2.0/model"],function(a,e){"use strict";var t,i,s,n,r,o;return a({VoiceLab:void 0,Voice:void 0}),{setters:[function(e){t=e},function(e){i=e},function(e){s=e},function(e){n=e}],execute:function(){o=t.Bundle,(r=new o({module:{vspecifier:"@aimpact/chat-sdk@1.2.0/voice"},type:"ts"},e.meta.url).package()).dependencies.update([["@beyond-js/kernel/core",i],["@aimpact/chat-sdk/config",s],["@beyond-js/reactive/model",n]]),(o=new Map).set("./voice-lab",{hash:3598784126,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.VoiceLab=void 0;var i=e("@beyond-js/kernel/core"),a=e("@aimpact/chat-sdk/config");class s extends i.Events{#apiKey=a.default.params.elevenlabs.key;#voiceId=a.default.params.elevenlabs.id;#url=`https://api.elevenlabs.io/v1/text-to-speech/${this.#voiceId}/stream`;#headers={"Content-Type":"application/json","xi-api-key":this.#apiKey};#audio;get audio(){return this.#audio}stop(){this.#audio&&this.#audio.pause()}#blob;get blob(){return this.#blob}async play(e){if(e){console.warn("call API");const t=await fetch(this.#url,{method:"POST",headers:this.#headers,body:JSON.stringify({text:e,voice_id:this.#voiceId,voice_settings:{stability:0,similarity_boost:0}})}),n=new MediaSource;e=URL.createObjectURL(n),this.#audio=new Audio(e),n.addEventListener("sourceopen",async()=>{const i=n.addSourceBuffer("audio/mpeg"),a=t.body.getReader(),s=async()=>{var{value:e,done:t}=await a.read();if(t)return n.endOfStream();i.appendBuffer(e),s()};s()}),this.#audio.play()}else console.warn("No hay texto para interpretar")}}t.VoiceLab=s}}),o.set("./voice",{hash:1282259821,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Voice=void 0;var i=e("@beyond-js/reactive/model"),a=e("@beyond-js/kernel/core");class s extends i.ReactiveModel{#speaking=!1;get speaking(){return this.#speaking}#id;#text;get text(){return this.#text}set text(e){this.#text=e}#currentWord=-1;get currentWord(){return this.#currentWord}get paused(){return speechSynthesis.paused}#lang;get lang(){return this.#lang}set lang(e){e!==this.#lang&&(this.#lang=e,this.trigger("change"))}#instance;get instance(){return this.#instance}#rate=1.2;get rate(){return this.#rate}set rate(e){e!==this.#rate&&(this.#rate=e,this.trigger("change"))}#languages={en:"en-EN",es:"es-MX",pr:"pt-BR"};constructor({language:e,rate:t}={rate:1.25}){super(),e=e||a.languages.current,this.reactiveProps(["positionToCut","textId","playing"]),this.positionToCut=0,this.lang=e,this.rate=t,this.initialValues({lang:e,rate:t})}set({language:e,rate:t}){e&&(this.lang=e),t&&(this.rate=t)}_web(){this.#speaking&&(speechSynthesis.cancel(),this.trigger("on.finish"));var e=this.#text;(e=new SpeechSynthesisUtterance(e)).lang=this.#languages[this.lang],e.rate=this.rate,e.onstart=()=>{this.#speaking=!0,this.trigger("change")},globalThis.addEventListener("beforeunload",()=>{speechSynthesis.cancel()}),e.onpause=()=>{this.trigger("change")},e.onresume=()=>this.trigger("change"),e.onboundary=e=>{this.#currentWord=0===e.charIndex?0:e.charIndex,this.trigger("change"),this.trigger("boundary")},e.onend=()=>{this.#speaking=!1,this.#currentWord=-1,this.trigger("change"),this.trigger("on.finish")},speechSynthesis.speak(e)}play(e,t){e&&(this.#text=e),this.#id=t,globalThis.cordova?this._mobile():this._web()}stop(){speechSynthesis.cancel()}}t.Voice=s}}),r.exports.descriptor=[{im:"./voice-lab",from:"VoiceLab",name:"VoiceLab"},{im:"./voice",from:"Voice",name:"Voice"}],r.exports.process=function({require:e,prop:t,value:i}){!e&&"VoiceLab"!==t||a("VoiceLab",e?e("./voice-lab").VoiceLab:i),!e&&"Voice"!==t||a("Voice",e?e("./voice").Voice:i)},a("__beyond_pkg",r),a("hmr",new function(){this.on=(e,t)=>r.hmr.on(e,t),this.off=(e,t)=>r.hmr.off(e,t)}),r.initialise(o)}}});