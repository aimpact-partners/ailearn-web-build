System.register(["@beyond-js/kernel@0.1.9/bundle","@beyond-js/kernel@0.1.9/core","@beyond-js/reactive@1.2.0/model"],function(s,e){var t,r,a,i,n;return s("Api",void 0),{setters:[function(e){t=e},function(e){r=e},function(e){a=e}],execute:function(){n=t.Bundle,(i=new n({module:{vspecifier:"@aimpact/http-suite@0.0.1/api"},type:"ts"},e.meta.url).package()).dependencies.update([["@beyond-js/kernel/core",r],["@beyond-js/reactive/model",a]]),(n=new Map).set("./api",{hash:896303390,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Api=void 0;var r=e("./fetcher"),e=e("@beyond-js/kernel/core");class s extends e.Events{#url;get url(){return this.#url??""}#fetcher;get actions(){return this.#fetcher.actions}get streamResponse(){return this.#fetcher.streamResponse}get metadata(){return this.#fetcher.metadata}constructor(e){super(),this.#url=e,this.#fetcher=new r.Fetcher,this.#fetcher.on("action.received",()=>this.trigger("action.received")),this.#fetcher.on("stream.response",this.#getResponse)}#getResponse=()=>{this.trigger("stream.response")};async action(e="get",t,r={}){return this.#fetcher[e](this.getURL(t),r)}getURL(e){return""+this.#url+e}bearer(e){return this.#fetcher.bearer(e),this}get(e,t){return this.action("get",e,t)}post(e,t){return this.action("post",e,t)}put(e,t){return this.action("put",e,t)}delete(e,t){return this.action("delete",e,t)}stream(e,t={}){return this.action("stream",e,t)}}t.Api=s}}),n.set("./fetcher",{hash:1856040650,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Fetcher=void 0;var r=e("@beyond-js/reactive/model"),s=e("./stream");class a extends r.ReactiveModel{#bearer;streamer;formDataInstance;customHeaders={"Content-Type":"application/json"};defaultHeaders={"Content-Type":"application/json"};constructor(){super(),this.streamer=new s.Stream(this)}get actions(){return this.streamer.actions}get streamResponse(){return this.streamer.response}get metadata(){return this.streamer.metadata}bearer(e){return e&&(this.#bearer=e),this}setHeaders(e){return this.customHeaders={...this.defaultHeaders,...e},this}getHeaders(e={},t=!1){var r,s,e={...this.customHeaders,...e},a=new Headers,i=e.Authorization||this.#bearer;i&&a.append("Authorization","Bearer "+i);for([r,s]of Object.entries(e))"Authorization"!==r&&"bearer"!==r&&a.append(r,s);return t&&a.delete("Content-Type"),a}createFormData(e={}){this.formDataInstance=new FormData;for(var[t,r]of Object.entries(e))this.formDataInstance.append(t,r);return this.formDataInstance}processGetParams(e={}){if(0===Object.entries(e).length)return"";var t,r,s=new URLSearchParams;for([t,r]of Object.entries(e))[NaN,void 0,""].includes(r)||s.append(t,r);return s}processParams(e={},t=!1,r){return"get"===r?this.processGetParams(e).toString():0!==Object.entries(e).length?t?this.createFormData(e):JSON.stringify(e):void 0}async execute(e,t="get",r={},s=!1){var a=r.multipart,i=this.getHeaders({bearer:r.bearer},a),i=(delete r.multipart,delete r.bearer,{method:t,headers:i,mode:"cors"});return["post","put","DELETE"].includes(t)?i.body=this.processParams(r,a,t):"get"===t&&(r=this.processParams(r,a,t))&&(e+="?"+r),s?this.streamer.execute(e,i):(await fetch(e,i)).json()}stream(e,t={}){return this.execute(e,"post",t,!0)}get(e,t={}){return this.execute(e,"get",t)}post(e,t={}){return this.execute(e,"post",t)}delete(e,t={}){return this.execute(e,"DELETE",t)}put(e,t={}){return this.execute(e,"put",t)}}t.Fetcher=a}}),n.set("./stream",{hash:3674916421,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;var s=e("@beyond-js/kernel/core");t.Stream=class{#SEPARATORS={METADATA:"ÿ",START:"😸",END:"🖋️"};#metadata={started:!1,value:"",parsed:{value:void 0}};get metadata(){return this.#metadata.parsed}#actions=[];get actions(){return this.#actions}#response="";get response(){return this.#response}#executingPromise;#parent;#currentTool={started:!1,value:"",parsed:{value:void 0}};constructor(e){this.#parent=e}#processResponse=e=>{var t=this.#metadata;try{this.#metadata.parsed.value=JSON.parse(t.value)}catch(e){console.log(t),console.error(e),this.#metadata.parsed.error="Error parsing metadata"}e.resolve({value:this.#response,...t.parsed.value}),this.#metadata={started:!1,value:"",parsed:{value:void 0}},this.#response=void 0,this.#executingPromise=void 0};#cleanCurrentTool(){this.#currentTool={started:!1,value:"",parsed:{value:void 0}}}async#handleMetadata(e,t){return this.#metadata.started=!0,e=e.split(this.#SEPARATORS.METADATA),this.#metadata.value+=e[1],e[0]?t+e[0]:t}handleStart(e,t){var r=e.split(this.#SEPARATORS.START);return this.#currentTool.started=!0,e="",r[1].includes(this.#SEPARATORS.END)?(e=r[1].split(this.#SEPARATORS.END),this.#currentTool.value=e[0],this.#actions.push(e[0]),t+=this.#SEPARATORS.START+this.#currentTool.value+this.#SEPARATORS.END):(t+=r[0],this.#currentTool.value+=r[1]),t}handleEnd(e,t){return e=e.split(this.#SEPARATORS.END),this.#currentTool.value+=e[0],this.#currentTool.started=!1,this.#actions.push(this.#currentTool.value),this.#response+=this.#SEPARATORS.START+this.#currentTool.value+this.#SEPARATORS.END,e[1]}async#read(e,t){for(var r=e.body?.getReader();;){var{done:s,value:a}=await r.read(),a=(new TextDecoder).decode(a);if(s)return this.#processResponse(t);if(a.includes(this.#SEPARATORS.METADATA))this.#handleMetadata(a,this.#response);else{if(this.#metadata.started)return this.#metadata.value+=a,void this.#parent.trigger("stream.response");a.includes(this.#SEPARATORS.START)?this.handleStart(a,this.#response):this.#currentTool.started&&a.includes(this.#SEPARATORS.END)&&(this.handleEnd(a,this.#response),this.#cleanCurrentTool()),this.#response+=a,this.#parent.triggerEvent("action.received"),this.#parent.triggerEvent("stream.response")}}}async execute(e,t){try{this.#executingPromise=new s.PendingPromise,this.#response="";var r=await fetch(e,t);if(r.ok)return this.#read(r,this.#executingPromise),this.#executingPromise;throw new Error("error in stream")}catch(e){console.error(e)}}}}}),n.set("./types",{hash:573802250,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),i.exports.descriptor=[{im:"./api",from:"Api",name:"Api"}],i.exports.process=function({require:e,prop:t,value:r}){!e&&"Api"!==t||s("Api",e?e("./api").Api:r)},s("__beyond_pkg",i),s("hmr",new function(){this.on=(e,t)=>i.hmr.on(e,t),this.off=(e,t)=>i.hmr.off(e,t)}),i.initialise(n)}}});