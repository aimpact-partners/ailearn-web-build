System.register(["@beyond-js/widgets@1.1.0/render","@beyond-js/kernel@0.1.9/bundle","@beyond-js/kernel@0.1.9/styles","@beyond-js/react-18-widgets@1.1.2/base","@beyond-js/reactive@1.2.0/model","@aimpact/chat-sdk@1.0.1/core","@aimpact/chat@1.0.2/wrapper","@aimpact/chat-sdk@1.0.1/session","@beyond-js/kernel@0.1.9/core","react@18.2.0","pragmate-ui@1.0.0-beta.1/components","pragmate-ui@1.0.0-beta.1/form","pragmate-ui@1.0.0-beta.1/modal","@aimpact/chat@1.0.2/shared/hooks","@beyond-js/kernel@0.1.9/routing","@aimpact/chat@1.0.2/shared/components","@beyond-js/react-18-widgets@1.1.2/hooks","@aimpact/chat@1.0.2/ui/manager","pragmate-ui@1.0.0-beta.1/icons","pragmate-ui@1.0.0-beta.1/tooltip"],function(n,e){var t,a,r,o,s,i,l,c,d,u,m,p,h,f,g,v,C,b,x,w,y,E;return n({Controller:void 0,Conversations:void 0}),{setters:[function(e){t=e},function(e){a=e},function(e){r=e},function(e){o=e},function(e){s=e},function(e){i=e},function(e){l=e},function(e){c=e},function(e){d=e},function(e){u=e},function(e){m=e},function(e){p=e},function(e){h=e},function(e){f=e},function(e){g=e},function(e){v=e},function(e){C=e},function(e){b=e},function(e){x=e},function(e){w=e}],execute:function(){E=a.Bundle,(y=new E({module:{vspecifier:"@aimpact/chat@1.0.2/conversations/explorer",multibundle:!0},type:"widget"},e.meta.url).package()).dependencies.update([["@beyond-js/widgets/render",t],["@beyond-js/kernel/styles",r],["@beyond-js/react-18-widgets/base",o],["@beyond-js/reactive/model",s],["@aimpact/chat-sdk/core",i],["@aimpact/chat/wrapper",l],["@aimpact/chat-sdk/session",c],["@beyond-js/kernel/core",d],["react",u],["pragmate-ui/components",m],["pragmate-ui/form",p],["pragmate-ui/modal",h],["@aimpact/chat/shared/hooks",f],["@beyond-js/kernel/routing",g],["@aimpact/chat/shared/components",v],["@beyond-js/react-18-widgets/hooks",C],["@aimpact/chat/ui/manager",b],["pragmate-ui/icons",x],["pragmate-ui/tooltip",w]]),brequire("@beyond-js/widgets/render").widgets.register([{name:"chat-explorer-view",vspecifier:"@aimpact/chat@1.0.2/conversations/explorer.widget"}]),brequire("@beyond-js/kernel/styles").styles.register("@aimpact/chat@1.0.2/conversations/explorer.widget"),(E=new Map).set("./controller",{hash:2460949071,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0;var a=e("@beyond-js/react-18-widgets/base"),n=e("./store"),r=e("./views");class o extends a.ReactWidgetController{#store;createStore(){return this.#store=new n.StoreManager,this.#store}get Widget(){return r.Conversations}}t.Controller=o}}),E.set("./store",{hash:417115612,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StoreManager=void 0;var a=e("@beyond-js/reactive/model"),n=e("@aimpact/chat-sdk/core"),r=e("@aimpact/chat/wrapper"),o=e("@aimpact/chat-sdk/session"),s=e("@beyond-js/kernel/core");class i extends a.ReactiveModel{get chats(){return r.AppWrapper.chats}get knowledgeBoxes(){return r.AppWrapper.knowledgeBoxes}get sharedKnowledgeBoxes(){return r.AppWrapper.sharedKnowledgeBoxes}get currentChat(){return r.AppWrapper.currentChat}constructor(){super(),r.AppWrapper.on("change",this.triggerEvent)}isReady(){return r.AppWrapper.ready}save=async(e,t)=>{var a=new n.Chat,e={name:e,userId:o.sessionWrapper.userId,language:{default:s.languages.current}};return t&&(e.knowledgeBoxId=t),await a.publish(e),{status:!0,chat:a}};edit=async(e,t)=>{var a=new n.Chat;return await a.load({id:e}),{status:!0,savedChat:e=await a.save({name:t})}}}t.StoreManager=i}}),E.set("./views/chat-form/KnowledgeBoxes",{hash:370843520,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.KnowledgeBoxes=void 0;var i=e("react"),l=e("pragmate-ui/components"),c=e("../context");t.KnowledgeBoxes=({texts:e,onClose:t,kbId:a,setKbId:n})=>{var{knowledgeBoxes:r,sharedKnowledgeBoxes:o}=(0,c.useConversationsContext)(),r=r?.items.map((e,t)=>i.default.createElement("option",{key:e.id+" - "+t,value:e.id},e.path)),o=o?.map((e,t)=>i.default.createElement("option",{key:e.id+" - "+t,value:e.id},e.path)),s=i.default.useRef(null);return i.default.createElement(i.default.Fragment,null,r?.length?i.default.createElement("select",{title:"Knowledge boxes",ref:s,value:a,onChange:e=>n(e.target.value)},i.default.createElement("option",{value:""},e.chatWithModel),[...r,...o]):i.default.createElement("section",null,i.default.createElement("h4",{className:"dialog__info"},e.noKbInfo),i.default.createElement("p",null,e.createNewKb," ",i.default.createElement(l.Link,{onClick:t,href:"/documents"},e.documentsLink),e.continueCreatingChat)))}}}),E.set("./views/chat-form/index",{hash:2667889105,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AddChat=void 0;var h=e("react"),f=e("pragmate-ui/form"),g=e("pragmate-ui/components"),v=e("pragmate-ui/modal"),C=e("@aimpact/chat/shared/hooks"),b=e("beyond_context"),x=e("@beyond-js/kernel/routing"),w=e("@aimpact/chat/wrapper"),y=e("@aimpact/chat/shared/components"),E=e("@beyond-js/react-18-widgets/hooks"),_=e("../context"),k=e("./KnowledgeBoxes");let I=h.default.useState;t.AddChat=({})=>{let{store:t,closeDialog:a}=(0,_.useConversationsContext)(),[n,r]=I(""),[e,o]=I(""),[s,i]=I(!1),[l,c]=I(""),d,u,[m,p]=(0,C.useTexts)(b.module.specifier);if((0,E.useBinder)([w.AppWrapper],()=>{var e=w.AppWrapper.selectedKnowledgeBoxId;c(e??"")}),m)return m=async()=>{try{i(!0);var e=await t.save(n,l);e.status?(x.routing.pushState("/chat/"+e.chat.id),a(),r(""),c("")):o(e.error)}catch(e){console.error(e),o(e.message)}finally{i(!1)}},u={disabled:!n||s},h.default.createElement(v.Modal,{show:!0,onClose:d=()=>{r(""),o(""),i(!1),w.AppWrapper.selectedKnowledgeBoxId="",a()},className:"chat__form"},e&&h.default.createElement("div",{className:"error error-container"},p.error),h.default.createElement("header",null,h.default.createElement("h1",null,p.header)),h.default.createElement(f.Form,{onSubmit:m,className:"chat__form"},h.default.createElement(y.Input,{type:"text",name:"name",value:n,onChange:e=>r(e.target.value),required:!0,disabled:s,placeholder:p.addNamePlaceholder}),h.default.createElement(k.KnowledgeBoxes,{kbId:l,setKbId:c,texts:p,onClose:d}),h.default.createElement("footer",null,h.default.createElement(g.Button,{icon:"close-circle",label:p.cancelButton,variant:"secondary outline",onClick:a}),h.default.createElement(g.Button,{icon:"save",type:"submit",label:p.saveButton,variant:"primary",onClick:m,fetching:s,...u}))))}}}),E.set("./views/context",{hash:2444812138,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useItemConversationsContext=t.useConversationsContext=t.ItemConversationsContext=t.ConversationsContext=void 0;var a=e("react");let n=t.ConversationsContext=a.default.createContext({}),r=(t.useConversationsContext=()=>a.default.useContext(n),t.ItemConversationsContext=a.default.createContext({}));t.useItemConversationsContext=()=>a.default.useContext(r)}}),E.set("./views/index",{hash:2589374136,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Conversations=function({store:e}){let[t,a]=c.default.useState(""),n=c.default.useRef(null),[r,o]=c.default.useState(!1),[s,i]=(0,m.useTexts)(p.module.specifier),l;return(0,u.useBinder)([d.UIManager],()=>{o(d.UIManager.modalOpened)},"modalOpened"),s?c.default.createElement(v.ConversationsContext.Provider,{value:{store:e,closeDialog:()=>o(!1),openDialog:l=()=>o(!0),totalChats:e.chats?.items?.length,chats:e.chats,showChildren:!1,knowledgeBoxes:e.knowledgeBoxes,sharedKnowledgeBoxes:e.sharedKnowledgeBoxes}},c.default.createElement("article",null,c.default.createElement("header",{className:"aside__top"},c.default.createElement("h3",null,i.title)),c.default.createElement("div",{className:"sidebar__search"},c.default.createElement(f.Input,{label:"Search Chats",disabled:!!e.chats?.items?.length,onChange:function(e){a(e.target.value)},type:"search",required:!0,value:t}),c.default.createElement(h.Button,{onClick:l,icon:"plus"})),c.default.createElement(C.ChatList,{search:t}),r&&c.default.createElement(g.AddChat,{dialogRef:n}))):null};var c=e("react"),d=e("@aimpact/chat/ui/manager"),u=e("@beyond-js/react-18-widgets/hooks"),m=e("@aimpact/chat/shared/hooks"),p=e("beyond_context"),h=e("pragmate-ui/components"),f=e("@aimpact/chat/shared/components"),g=e("./chat-form"),v=e("./context"),C=e("./list")}}),E.set("./views/item/child",{hash:2336134897,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ChildItem=void 0;var a=e("react"),n=e("@beyond-js/kernel/routing");t.ChildItem=({item:e})=>{var t=`sidebar-item ${(t=n.routing.uri.pathname).split("/")[2]===e.id?"current":""} `+(e.children?" is-parent":"");return a.default.createElement("li",{key:e.id,className:t})}}}),E.set("./views/item/editing",{hash:2416652880,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EditingItem=function(){let{chatId:t,editing:a,setEditing:n,item:e}=(0,p.useItemConversationsContext)(),r=(0,p.useConversationsContext)().store,[o,s]=l.default.useState(""),i=async e=>{e.stopPropagation(),await r.edit(t,o)};return l.default.createElement("div",{className:"item-label__container"},l.default.createElement(m.Tooltip,{placement:"top",content:e?.name},l.default.createElement(u.Link,{className:"item-label",href:"/chat/"+e.id},l.default.createElement(d.Icon,{icon:"chat",className:"xs"}),l.default.createElement("form",{onSubmit:i},l.default.createElement(c.Input,{type:"text",value:o,placeholder:e?.name,onChange:e=>s(e.target.value)})))),l.default.createElement("div",{className:"item__actions"},l.default.createElement(d.IconButton,{icon:"check",type:"submit",onClick:i}),l.default.createElement(d.IconButton,{icon:"close",onClick:e=>{e.stopPropagation(),n(!a)}})))};var l=e("react"),c=e("pragmate-ui/form"),d=e("pragmate-ui/icons"),u=e("pragmate-ui/components"),m=e("pragmate-ui/tooltip"),p=e("../context")}}),E.set("./views/item/index",{hash:3140734552,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ChatListItem=void 0;var m=e("react"),p=e("@beyond-js/kernel/routing"),h=e("../context"),f=e("./label"),g=e("./editing");let v=({item:e})=>{var t=p.routing.uri.pathname,a=(t=t.split("/")[2])===e.id,n=!!e.children.length,r=(0,h.useConversationsContext)().showChildren,[o,s]=m.default.useState(!1),[i,l]=m.default.useState(!1);let c=[];n&&e.children.forEach(e=>{c.push(m.default.createElement(v,{key:e.id,item:e}))});var d="subitems__list "+(o?"visible":""),u=i?g.EditingItem:f.ItemLabel;return m.default.createElement(h.ItemConversationsContext.Provider,{value:{item:e,chatId:t,setExpanded:s,editing:i,setEditing:l,expanded:o,isParent:n,isCurrent:a}},m.default.createElement("li",{className:`sidebar-item ${a?"current":""} `+(n?" is-parent":"")},m.default.createElement(u,null),n&&r&&m.default.createElement("ul",{className:d},c)))};t.ChatListItem=v}}),E.set("./views/item/label",{hash:3542675124,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ItemLabel=function(){let{expanded:t,item:e,isParent:a,setExpanded:n}=(0,c.useItemConversationsContext)(),r=(0,c.useConversationsContext)().showChildren;return o.default.createElement("div",{className:"item__container"},o.default.createElement(l.Tooltip,{placement:"top",content:e?.name},o.default.createElement(i.Link,{className:"item__label-container",href:"/chat/"+e.id},o.default.createElement(s.Icon,{icon:"chat",className:"xs"}),o.default.createElement("span",{className:"item__label-text"},e?.name)),o.default.createElement("div",{className:"item__actions-container"},a&&r&&o.default.createElement(s.IconButton,{icon:"expandMore",className:t?"expanded":"",onClick:e=>{e.stopPropagation(),n(!t)}}))))};var o=e("react"),s=e("pragmate-ui/icons"),i=e("pragmate-ui/components"),l=e("pragmate-ui/tooltip"),c=e("../context")}}),E.set("./views/list",{hash:2522110075,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ChatList=function({}){let e=(0,i.useConversationsContext)().chats,[t,a]=r.default.useState((0,l.organizeByParent)(e?.items)),n;return(0,o.useBinder)([e],()=>a((0,l.organizeByParent)(e.items))),t.length?(n=t.map((e,t)=>r.default.createElement(s.ChatListItem,{key:t,item:e})),r.default.createElement("div",{className:"sidebar__list"},r.default.createElement("ul",null,n))):null};var r=e("react"),o=e("@beyond-js/react-18-widgets/hooks"),s=e("./item"),i=e("./context"),l=e("./organizer")}}),E.set("./views/organizer",{hash:3273672725,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.organizeByParent=function(e){var t,a={};for(t of e=e.map(e=>e.getProperties()))a[t.id]=t,a[t.id].children=[];var n,r=[];for(n of e){var o,s=n.parent;[0,"0"].includes(s)?r.push(n):(o=a[s])?o.children.push(n):console.warn(`Parent with ID "${s}" not found for item with ID "${n.id}"`)}return r}}}),y.exports.descriptor=[{im:"./controller",from:"Controller",name:"Controller"},{im:"./views/index",from:"Conversations",name:"Conversations"}],y.exports.process=function({require:e,prop:t,value:a}){!e&&"Controller"!==t||n("Controller",e?e("./controller").Controller:a),!e&&"Conversations"!==t||n("Conversations",e?e("./views/index").Conversations:a)},n("__beyond_pkg",y),n("hmr",new function(){this.on=(e,t)=>y.hmr.on(e,t),this.off=(e,t)=>y.hmr.off(e,t)}),y.initialise(E)}}});