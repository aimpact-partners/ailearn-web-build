System.register(["@beyond-js/kernel@0.1.9/bundle","@beyond-js/kernel@0.1.9/styles","@beyond-js/reactive@1.2.0/model","@aimpact/chat-sdk@1.1.0/voice","@aimpact/chat-sdk@1.1.0/wrapper","@aimpact/chat-sdk@1.1.0/core","@aimpact/chat-sdk@1.1.0/session","@beyond-js/kernel@0.1.9/texts","@beyond-js/kernel@0.1.9/core","react@18.2.0","pragmate-ui@1.0.0-beta.6/icons","@beyond-js/react-18-widgets@1.1.2/hooks","@aimpact/chat-sdk@1.1.0/messages","pragmate-ui@1.0.0-beta.6/components","@aimpact/chat-sdk@1.1.0/components/icons","pragmate-ui@1.0.0-beta.6/form","pragmate-ui@1.0.0-beta.6/modal"],function(a,e){var t,r,n,s,o,i,c,l,d,u,h,m,p,g,f,v,y,C,b;return a({AudioManager:void 0,Recorder:void 0,Chat:void 0,AgentsChatContainer:void 0,ChatContext:void 0,useChatContext:void 0,AgentsChatPanel:void 0,AgentsChatInput:void 0,PermissionsErrorModal:void 0,RecordingButton:void 0,PermissionsModal:void 0}),{setters:[function(e){t=e},function(e){r=e},function(e){n=e},function(e){s=e},function(e){o=e},function(e){i=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){u=e},function(e){h=e},function(e){m=e},function(e){p=e},function(e){g=e},function(e){f=e},function(e){v=e},function(e){y=e}],execute:function(){b=t.Bundle,(C=new b({module:{vspecifier:"@aimpact/chat-sdk@1.1.0/chat-component",multibundle:!0},type:"code"},e.meta.url).package()).dependencies.update([["@beyond-js/kernel/styles",r],["@beyond-js/reactive/model",n],["@aimpact/chat-sdk/voice",s],["@aimpact/chat-sdk/wrapper",o],["@aimpact/chat-sdk/core",i],["@aimpact/chat-sdk/session",c],["@beyond-js/kernel/texts",l],["@beyond-js/kernel/core",d],["react",u],["pragmate-ui/icons",h],["@beyond-js/react-18-widgets/hooks",m],["@aimpact/chat-sdk/messages",p],["pragmate-ui/components",g],["@aimpact/chat-sdk/components/icons",f],["pragmate-ui/form",v],["pragmate-ui/modal",y]]),brequire("@beyond-js/kernel/styles").styles.register("@aimpact/chat-sdk@1.1.0/chat-component.code"),(b=new Map).set("./interfaces/messages",{hash:775952468,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),b.set("./store/audio",{hash:1303539854,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioManager=void 0;var r=e("@beyond-js/reactive/model"),a=e("@aimpact/chat-sdk/voice"),n=e("@aimpact/chat-sdk/wrapper"),s=e("./recorder");class o extends r.ReactiveModel{#parent;#recorder;get recorder(){return this.#recorder}#players={web:a.Voice,lab:a.VoiceLab};#player="web";get player(){return this.#currentPlayer}#currentPlayer;constructor(e){super({}),this.#recorder=new s.Recorder,this.#parent=e,this.reactiveProps(["autoplay"]),this.#currentPlayer=new this.#players.web({language:n.AppWrapper.language,rate:n.AppWrapper.audioSpeed}),n.AppWrapper.on("app.settings.change",this.listenAppChanges)}listenAppChanges=()=>{var{rate:e,language:t}=n.AppWrapper;this.#currentPlayer.set({rate:e,language:t})};selectPlayer(e){if(!this.#players[e])throw new Error(`Player ${e} not found`);this.#player=e,this.trigger("change")}}t.AudioManager=o}}),b.set("./store/index",{hash:2260288212,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StoreManager=void 0;var r=e("@beyond-js/reactive/model"),a=e("@aimpact/chat-sdk/core"),n=e("@aimpact/chat-sdk/wrapper"),s=e("./audio"),o=e("@aimpact/chat-sdk/session"),i=e("@beyond-js/kernel/texts"),c=e("beyond_context");class l extends r.ReactiveModel{#EXTENSIONS=["chat-intro"];#messages;get messages(){return this.#messages?.items}#name;get name(){return this.#name}#category;get category(){return this.#category}#chat;get chat(){return this.#chat}get model(){return this.#chat}#chats=n.AppWrapper.chats;get chats(){return this.#chats.items??[]}#texts=new i.CurrentTexts(c.module.specifier);get textsModel(){return this.#texts}get texts(){return this.#texts?.value}#audio=new s.AudioManager(this);get audioManager(){return this.#audio}#processTranscription=!1;get proccessTranscription(){return this.#processTranscription}#selectedModel="GPT 4";get selectedModel(){return this.#selectedModel}set selectedModel(e){this.#selectedModel=e}#notFound;get notFound(){return this.#notFound}set notFound(e){this.#notFound=e}#currentMessage;get currentMessage(){return this.#currentMessage}set currentMessage(e){e?.id!==this.#currentMessage?.id&&(this.#currentMessage=e)}#disabled;get disabled(){return this.#disabled}set disabled(e){this.#disabled!==e&&(this.#disabled=e,this.triggerEvent("change"))}#extensions=new Map;get extensions(){return this.#extensions}#id;get ready(){return super.ready&&this.#texts.ready}constructor(e){super(),this.#texts.on("change",this.triggerEvent),this.#id=e,this.reactiveProps(["waitingResponse","autoplay"]),this.autoplay=!0,(globalThis.store=this).load(this.#id)}load=async e=>{var t;e?o.sessionWrapper.user?.logged?(this.fetching=!0,t=new a.Chat({id:e}),this.#chat=t,this.#messages=t.messages,await t.loadAll({id:e}),globalThis.chat=t,(n.AppWrapper.currentChat=t).found?(e=t.language?.default??n.AppWrapper.language,this.audioManager.player.set({language:e}),this.fetching=!1,super.ready=!0,this.notFound=!1,this.trigger("change")):(this.fetching=!1,super.ready=!0,this.notFound=!0)):o.sessionWrapper.on("login",this.load):(console.warn("you're tring to load a chat without an id"),super.ready=!0,this.notFound=!0)};async sendMessage(e){try{if(performance.mark("start"),this.#currentMessage=void 0,"string"!=typeof e||![void 0,"",null].includes(e))return this.fetching=!0,this.#chat.sendMessage(e)}catch(e){console.error(e)}}async sendAudio(e){try{return performance.mark("start"),this.#currentMessage=void 0,this.fetching=!0,this.#chat.sendAudio(e)}catch(e){console.error(e)}finally{this.fetching=!1}}transcribe(e){return this.#chat.transcribe(e)}unmount(){this.#audio.player?.stop()}clean(){this.fetching=!1,super.ready=!1}}t.StoreManager=l}}),b.set("./store/recorder",{hash:4195704006,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Recorder=void 0;var r=e("@beyond-js/kernel/core"),e=e("@beyond-js/reactive/model");class a extends e.ReactiveModel{#initialised=!1;#source;#stream;#startTime;#initPromise;#stopPromise;#audioContext;#recordingPromise;#mediaRecorder;#chunks=[];get chunks(){return this.#chunks}#status;get status(){return this.#status}#recording=!1;get recording(){return this.#recording}#error;get error(){return this.#error}get valid(){return!this.#error}#audio;get audio(){return this.#audio}#analyser;get analyser(){return this.#analyser}#speechRecognition;#transcription="";get transcription(){return this.#transcription}#promiseSpeech;#permissions;#permissionObserver;#permissionState;constructor(){super(),this.init()}async hasPermissions(){try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop()),!0}catch(e){return this.#error=e,!1}}async init(){try{var e=await navigator.permissions.query({name:"microphone"});this.#permissions="granted"===e.state,this.#permissionObserver=e,this.#permissionState=e.state,e.onchange=this.#onChangeStatus.bind(this)}catch(e){}finally{this.ready=!0}}#onChangeStatus(){this.#permissionState=this.#permissionObserver.state,this.trigger("change")}getSpeechRecognition(){console.log("getSpeechRecognition"),this.#speechRecognition=new webkitSpeechRecognition,this.#speechRecognition.lang="es-ES",this.#speechRecognition.continuous=!0,this.#speechRecognition.interimResults=!0,this.#promiseSpeech=new r.PendingPromise,this.#speechRecognition.onresult=t=>{let r="",a="";for(let e=t.resultIndex;e<t.results.length;++e)t.results[e].isFinal?(a+=t.results[e][0].transcript,this.#transcription=a,this.#promiseSpeech.resolve(this.#transcription)):r+=t.results[e][0].transcript},this.#speechRecognition.onerror=e=>console.error("error in transcription"),this.#speechRecognition.start()}#onDataAvailable=e=>{0!==e.data.size&&(this.#chunks.push(e.data),this.trigger("dataavailable"))};#startRecording=(e,t)=>{this.#mediaRecorder=new MediaRecorder(e),this.#stream=e,this.#mediaRecorder.addEventListener("dataavailable",this.#onDataAvailable)};async initialise(t={}){return this.#initPromise||(this.#initPromise=new r.PendingPromise,globalThis?.navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{console.log("stream",e),this.#startRecording(e,t)}).catch(e=>{this.#error=e.message,this.#initPromise.reject()}).finally(()=>{this.#initialised=!0,this.#initPromise.resolve()})),this.#initPromise}record(t={analyser:!0}){try{if(!this.#recordingPromise){if(this.#recordingPromise=new r.PendingPromise,this.#recording)throw new Error("Wait for recorder to be stopped and transcription ready");this.#status="started",this.#recording=!0,this.trigger("change"),globalThis?.navigator.mediaDevices.getUserMedia({audio:!0}).then(async e=>{this.#startRecording(e,t),this.#recordingPromise.resolve(),this.#initialised=!0,this.#mediaRecorder?.start()}).catch(e=>{console.error(e),this.#error=e.message,this.#recordingPromise.reject()})}return this.#recordingPromise}catch(e){}}stopStream=()=>{this.#mediaRecorder.stop(),this.#stream.getTracks().forEach(e=>{e.stop(),console.log("track stopped",e.kind,"aja")}),this.#audioContext&&(this.#audioContext.close(),this.#audioContext.createMediaStreamSource(this.#stream).disconnect,this.#audioContext.close().then(()=>{console.log("AudioContext closed"),this.#audioContext=void 0}).catch(e=>{console.error("Error closing AudioContext",e)})),this.#stream=void 0};stop(){if(this.#mediaRecorder){if(!this.#stopPromise){if(this.#stopPromise=new r.PendingPromise,!this.#recording)throw new Error("Recorder is not currently recording");this.#status="stopped";var e=()=>{this.#chunks=[],this.#recording=!1,this.#mediaRecorder.addEventListener("stop",async()=>{let e=new Blob(this.#chunks,{type:this.#mediaRecorder.mimeType});this.#audio=e;var t=()=>{this.#stopPromise.resolve(e),this.#stopPromise=void 0};this.#promiseSpeech?this.#promiseSpeech.then(t):this.#stopPromise&&t(),this.#recordingPromise&&(this.#recordingPromise.resolve(e),this.#recordingPromise=void 0),this.stopStream(),this.#mediaRecorder=void 0,this.#stream=void 0,this.#initPromise=void 0}),this.#mediaRecorder?.stop(),this.#speechRecognition?.stop(),this.trigger("change")};this.#initialised?e():this.record().then(e)}return this.#stopPromise}console.warn("this.#mediaRecorder no initialize")}}t.Recorder=a}}),b.set("./store/types",{hash:1416087461,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),b.set("./views/chat/back-arrow",{hash:3094757389,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BackArrow=function({store:e,separator:t}){let r=i.default.useRef(null),a=(0,d.useChatContext)().attributes,n=i.default.useRef(null),s=((0,l.useBinder)([e],()=>globalThis.setTimeout(()=>{var e=n.current?.closest(".chat-control__container")?.querySelector(".chat__content");e&&(e.scrollHeight-e.clientHeight-e.scrollTop<=100?(n.current.classList.remove("show"),s()):n.current.classList.add("show"))},100),"new.message"),()=>{t.current?.scrollIntoView({block:"end",behavior:"smooth"})}),o=(i.default.useEffect(()=>{let e=n.current.closest(".chat-control__container").querySelector(".chat__content"),t=()=>{e&&(e.scrollHeight-e.clientHeight-e.scrollTop<=100?n.current.classList.remove("show"):n.current.classList.add("show"))};return e.addEventListener("scroll",t),()=>{e?.removeEventListener("scroll",t)}},[]),"scroll-bottom show circle");return a.has("container")&&(o+="scroll-bottom--"+a.get("container")),e="container__icon "+(a.has("container")?" container--"+a.get("container"):""),i.default.createElement("div",{className:e,ref:n},i.default.createElement(c.IconButton,{ref:r,icon:"backArrow",variant:"tertiary",className:o,onClick:s}))};var i=e("react"),c=e("pragmate-ui/icons"),l=e("@beyond-js/react-18-widgets/hooks"),d=e("../context")}}),b.set("./views/chat/global",{hash:553480393,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),b.set("./views/chat/index",{hash:3017491944,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Chat=function(){let[e]=d.default.useState(!1),t=d.default.useRef(null),{store:r,texts:a,systemIcon:n,empty:s}=(0,u.useChatContext)(),o=r.messages,[,i]=d.default.useState(o?.length??[].length),c="chat-control__container"+(e?" reader__container":""),l;return d.default.useEffect(()=>{globalThis.setTimeout(()=>{t.current?.scrollIntoView({behavior:"smooth",block:"end"})},100)},[]),(0,m.useBinder)([r.chat],()=>{i(r.messages.length),globalThis.setTimeout(()=>{t.current.scrollIntoView({behavior:"smooth",block:"end"})},100)},"new.message"),r.messages.length?d.default.createElement("div",{className:c},d.default.createElement("section",{className:"chat__content"},d.default.createElement(h.Messages,{chat:r.chat,player:r.audioManager.player,current:r.currentMessage,store:r,systemIcon:n,messages:r?.messages??[],texts:a}),d.default.createElement("div",{ref:t,className:"separator"}))):(l=s||d.default.createElement(d.default.Fragment,null,"No hay contenido"),d.default.createElement(l,null))};var d=e("react"),u=e("../context"),h=e("@aimpact/chat-sdk/messages"),m=e("@beyond-js/react-18-widgets/hooks")}}),b.set("./views/chat/skeleton",{hash:286511885,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ChatSkeleton=function(){var{}=(0,a.useChatContext)();return r.default.createElement("div",{className:"chat-container"},r.default.createElement(n.Spinner,{active:!0}))};var r=e("react"),a=e("../context"),n=e("pragmate-ui/components")}}),b.set("./views/chat/use-extension",{hash:2889823330,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useExtension=function(e){let[t,r]=o.default.useState(!1),a=o.default.useRef(null),n=(0,i.useChatContext)().store.extensions,s=n.get(e)?.control;return o.default.useEffect(()=>{let e=e=>r(!0);if(a?.current)return a.current.addEventListener("ready",e),()=>a.current?.removeEventListener("ready",e)},[a?.current]),[a,t||!s,s]};var o=e("react"),i=e("../context")}}),b.set("./views/container",{hash:1819983516,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AgentsChatContainer=function({children:e,icon:t,autoplay:r,empty:a,player:n,...s}){let[o,i]=h.default.useState("top"),{ready:c,store:l}=(0,m.useManager)(s.id),d=l||{};var u;return c?(u=d.messages,r={setScrollPosition:e=>{e||console.trace("setScrollPosition called with no value"),i(e)},scrollPosition:o,store:l,ready:l.ready,texts:l.texts,recorder:l?.audioManager?.recorder,autoplay:r,systemIcon:t,empty:a,messages:u,player:n,attributes:s.attributes},h.default.createElement(p.ChatContext.Provider,{value:r},e)):null};var h=e("react"),m=e("./use-manager"),p=e("./context")}}),b.set("./views/context",{hash:1970597908,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useChatContext=t.ChatContext=void 0;var r=e("react");let a=t.ChatContext=r.default.createContext({});t.useChatContext=()=>r.default.useContext(a)}}),b.set("./views/index",{hash:2366537853,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AgentsChatPanel=function(){var{ready:e,store:t}=(0,n.useChatContext)();return t.notFound&&e?r.default.createElement(o.ChatNotFound,null):e?r.default.createElement(a.Chat,null):r.default.createElement(s.ChatSkeleton,null)};var r=e("react"),a=e("./chat"),n=e("./context"),s=e("./chat/skeleton"),o=e("./not-found")}}),b.set("./views/input/action-button",{hash:684652056,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.InputActionButton=function({buttonIsDisabled:e}){var{onSubmit:t,text:r}=(0,o.useInputContext)();return r.length?a.default.createElement("span",{className:"input__icon  input__icon--right"},a.default.createElement(s.AppIconButton,{icon:"arrowUpward",className:"circle",variant:"primary",onClick:t,disabled:e})):a.default.createElement("span",{className:"input__icon  input__icon--right"},a.default.createElement(n.RecordingButton,null))};var a=e("react"),n=e("./recording"),s=e("@aimpact/chat-sdk/components/icons"),o=e("./context")}}),b.set("./views/input/context",{hash:4109674778,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useInputContext=t.InputContext=void 0;var r=e("react");let a=t.InputContext=r.default.createContext(null);t.useInputContext=()=>r.default.useContext(a)}}),b.set("./views/input/hooks/use-input-form",{hash:610095468,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useInputForm=function(){let{store:t,recorder:r}=(0,d.useChatContext)(),[a,n]=l.default.useState(!1),[e,s]=l.default.useState(!1),[o,i]=l.default.useState(""),c=o.length?async e=>{try{e?.stopPropagation(),i(""),s(!0),await t.sendMessage(o),s(!1)}catch(e){console.error("error",e)}}:async e=>{s(!0),e.preventDefault(),e.stopPropagation(),e=await r.stop(),t.sendAudio(e),n(!a),s(!1)};return{recording:a,text:o,setText:i,setFetching:s,setRecording:n,fetching:e,onSubmit:c}};var l=e("react"),d=e("../../context")}}),b.set("./views/input/index",{hash:611636456,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AgentsChatInput=void 0;var f=e("react"),v=e("pragmate-ui/form"),y=e("@beyond-js/react-18-widgets/hooks"),C=e("./context"),b=e("./text-input"),x=e("./action-button"),w=e("../context"),_=e("@aimpact/chat-sdk/components/icons"),P=e("./hooks/use-input-form");t.AgentsChatInput=({isWaiting:e=!1,autoTranscribe:t=!1,disabled:r=!1,onClick:a})=>{let[n,s]=f.default.useState(!1),{store:o,recorder:i}=(0,w.useChatContext)();var{text:c,setText:l,onSubmit:d,fetching:u,recording:h,setRecording:m,setFetching:p}=(0,P.useInputForm)(),e=((0,y.useBinder)([o],()=>s(o.waitingResponse)),u||h||n||e),g=o.disabled||r,t={store:o,onSubmit:d,recorder:i,autoTranscribe:t,fetching:u,setText:l,setRecording:m,recording:h,text:c,setFetching:p,disabled:g},m=(u={disabled:r||o.disabled}).disabled||o.waitingResponse||h,r={className:`chat-input-container ${e?"is-fetching":""} `+(g?"is-disabled":"")},h={onClick:a,className:"chat-input-form "+(g?"is-disabled":"")};return!["",void 0,null].includes(c.replaceAll("\n",""))&&c.trim().length||(u.disabled=!0),f.default.createElement(C.InputContext.Provider,{value:t},f.default.createElement(v.Form,{onSubmit:d,...h},f.default.createElement("div",{...r},f.default.createElement("div",null,f.default.createElement(_.AppIconButton,{className:"chat-input__icon",icon:"attachFile"})),f.default.createElement(b.TextInput,{text:c,setFetching:p,fetching:e,setText:l,handleSend:d,disabled:g}),f.default.createElement(x.InputActionButton,{buttonIsDisabled:m}))))}}}),b.set("./views/input/recording/error-modal",{hash:1828955527,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PermissionsErrorModal=void 0;var a=e("react"),n=e("pragmate-ui/icons"),s=e("pragmate-ui/modal"),o=e("../../context");t.PermissionsErrorModal=({show:e,onClose:t})=>{var r;return e?(e=(0,o.useChatContext)().texts,{title:e,description:r}=e.permissions.error,a.default.createElement(a.default.Fragment,null,a.default.createElement(s.AlertModal,{className:"modal--centered",onClose:t,centered:!0},a.default.createElement("div",{className:"permissions__modal-container"},a.default.createElement("div",{className:"title-intro__modal-container"},a.default.createElement("h3",null,e)),a.default.createElement(n.Icon,{className:"mic__modal-icon lg my-10",icon:"mic"}),a.default.createElement("p",{className:"description__modal-text"},r))))):null}}}),b.set("./views/input/recording/index",{hash:1528174594,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RecordingButton=void 0;var u=e("react"),h=e("pragmate-ui/components"),m=e("./player"),p=e("../context"),g=e("./modal"),f=e("./error-modal");t.RecordingButton=({disabled:e=!1})=>{let{recorder:t,recording:r,setRecording:a}=(0,p.useInputContext)(),[n,s]=(0,u.useState)(!1),[o,i]=(0,u.useState)(!1),[c,l]=(0,u.useState)(!1),[,d]=(0,u.useState)(globalThis?.localStorage.getItem("aimpact.recording.permission"));return e=e||n,r?u.default.createElement(m.Player,null):u.default.createElement(u.default.Fragment,null,u.default.createElement(h.Button,{icon:"mic",fetching:n,onClick:async e=>{try{e.preventDefault(),s(!0),await t.hasPermissions()?(async()=>{try{await t.record(),a(!r)}catch(e){l(!0)}})():i(!0)}catch(e){l(!0)}finally{s(!1)}},disabled:e}),u.default.createElement(g.PermissionsModal,{show:o,onClose:e=>{s(!1),i(!1)},onConfirm:()=>{t.hasPermissions().then(()=>{globalThis?.localStorage.setItem("aimpact.recording.permission","true"),d("true")}).catch(e=>{console.log("permisos no concedidos"),l(!0)})}}),u.default.createElement(f.PermissionsErrorModal,{show:c,onClose:()=>l(!1)}))}}}),b.set("./views/input/recording/modal",{hash:2752701704,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PermissionsModal=void 0;var s=e("react"),o=e("pragmate-ui/icons"),i=e("pragmate-ui/modal"),c=e("../../context");t.PermissionsModal=({show:e,onClose:t,onConfirm:r})=>{var a,n;return e?(a=(e=(0,c.useChatContext)().texts).permissions.title,n=e.permissions.description,s.default.createElement(s.default.Fragment,null,s.default.createElement(i.AlertModal,{onClose:t,centered:!0,onConfirm:r},s.default.createElement("div",{className:"permissions__modal-container"},s.default.createElement("div",{className:"title-intro__modal-container"},s.default.createElement("span",{className:"intro__modal-text p2"},e.permissions.intro),s.default.createElement("h3",null,a)),s.default.createElement(o.Icon,{className:"mic__modal-icon lg my-10",icon:"mic"}),s.default.createElement("p",{className:"description__modal-text"},n))))):null}}}),b.set("./views/input/recording/player",{hash:2340691925,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0;var l=e("react"),d=e("pragmate-ui/icons"),u=e("../timer"),h=e("../context"),m=e("pragmate-ui/components"),p=e("@aimpact/chat-sdk/components/icons");t.Player=()=>{let{recorder:r,setRecording:a,autoTranscribe:n,store:s,setText:o,setFetching:i}=(0,h.useInputContext)(),[e,c]=l.default.useState(!1);return l.default.createElement("div",{className:"recording-player__container"},l.default.createElement(d.IconButton,{className:"circle",icon:"delete",onClick:async e=>{e.preventDefault(),await r.stop(),a(!1)}}),l.default.createElement(u.Timer,{action:"start"}),l.default.createElement("div",{className:"recording-button__container"},e?l.default.createElement(m.Button,null,l.default.createElement(m.Spinner,{active:!0})):l.default.createElement(p.AppIconButton,{icon:"arrowUpward",className:"circle",variant:"primary",onClick:async e=>{e.preventDefault(),e.stopPropagation();try{if(i(!0),n)return(async()=>{c(!0);var e=await r.stop();(e=await s.transcribe(e)).error?console.error(e.error):(o(e.data.text),a(!1))})();var t=await r.stop();s.sendAudio(t),a(!1),i(!1)}catch(e){console.error(e)}}})))}}}),b.set("./views/input/text-input",{hash:1228120398,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TextInput=function({setFetching:e,setText:r,handleSend:a,fetching:t,text:n,disabled:s}){let o=(0,u.useInputContext)().store,i=l.default.useRef(null),c=(l.default.useEffect(()=>{var e=i.current;e.style.height="auto",e.style.height=1==n.length?"auto":e.scrollHeight+"px",["undefined",void 0].includes(n.replaceAll("\n",""))},[n]),(0,d.useBinder)([o],()=>{globalThis.setTimeout(()=>i.current.focus(),300),e(!1)},"chat.available"),{disabled:t||s});return l.default.createElement("div",{className:"input__wrapper"},l.default.createElement("textarea",{...c,rows:1,value:n,onChange:e=>{e=e.target.value,["undefined",void 0].includes(e.replaceAll("\n"))||r(e)},onKeyDown:e=>{var t;"Enter"!==e.key||(t=e.target.value.replaceAll("\n"),["",void 0,null].includes(t))||(e.shiftKey?r(e=>e+"\n"):a())},autoFocus:!0,className:"input__textarea",ref:i}))};var l=e("react"),d=e("@beyond-js/react-18-widgets/hooks"),u=e("./context")}}),b.set("./views/input/timer/index",{hash:1478628646,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=function({action:e}){var t=["restart","start"].includes(e),e="restart"===e,[,t,e,,]=(0,a.useTimer)(t,e),e=e.toString().padStart(2,"0"),t=t.toString().padStart(2,"0");return r.default.createElement("div",{className:"timer-message__container"},r.default.createElement("span",null,""+t,":"),r.default.createElement("span",null,""+e))};var r=e("react"),a=e("./use-timer")}}),b.set("./views/input/timer/use-timer",{hash:1623060353,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useTimer=function(t,e){let[r,a]=c(0),n=(l(()=>{let e;return t&&(e=setInterval(()=>{a(e=>e+1)},10)),()=>{clearInterval(e)}},[t]),l(()=>{e&&a(0)},[e]),r%100),s=Math.floor(r/100%60),o=Math.floor(r/6e3%60),i=Math.floor(r/36e4);return[i,o,s,n]};let r=e("react"),{useState:c,useEffect:l}=r.default}}),b.set("./views/input/types/agents-input",{hash:2366847878,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),b.set("./views/not-found",{hash:4269748456,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ChatNotFound=function(){return r.default.createElement("div",null,"404")};var r=e("react")}}),b.set("./views/use-manager",{hash:3726613334,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useManager=function(r){let[e,a]=o.default.useState(!1),[t,n]=o.default.useState({}),[,s]=o.default.useState({});return o.default.useEffect(()=>{let e=new i.StoreManager(r),t=()=>{s({...e.getProperties()}),a(e.ready)};return e.on("change",t),n(e),a(e.ready),()=>{e.off("change",t)}},[r]),{ready:e,store:t}};var o=e("react"),i=e("../store")}}),b.set("./views/widget/index",{hash:3204793680,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.View=function({store:e,...t}){let[,,]=m.default.useState(e.fetching),[r,a]=m.default.useState(e.ready),n=t.attributes.get("icon"),[s,o]=m.default.useState("top"),{autoplay:i,messages:c,audioManager:{player:l}}=e,d=((0,p.useBinder)([e],()=>{a(e.ready)}),{setScrollPosition:e=>{e||console.trace("setScrollPosition called with no value"),o(e)},scrollPosition:s,store:e,texts:e.texts,autoplay:i,systemIcon:n,messages:c,player:l,ready:e.ready,attributes:t.attributes}),u=e.notFound?y.ChatNotFound:g.Chat,h=r?u:v.ChatSkeleton;return m.default.createElement(f.ChatContext.Provider,{value:d},m.default.createElement(h,null))};var m=e("react"),p=e("@beyond-js/react-18-widgets/hooks"),g=e("../chat"),f=e("../context"),v=e("../chat/skeleton"),y=e("../not-found")}}),C.exports.descriptor=[{im:"./store/audio",from:"AudioManager",name:"AudioManager"},{im:"./store/recorder",from:"Recorder",name:"Recorder"},{im:"./views/chat/index",from:"Chat",name:"Chat"},{im:"./views/container",from:"AgentsChatContainer",name:"AgentsChatContainer"},{im:"./views/context",from:"ChatContext",name:"ChatContext"},{im:"./views/context",from:"useChatContext",name:"useChatContext"},{im:"./views/index",from:"AgentsChatPanel",name:"AgentsChatPanel"},{im:"./views/input/index",from:"AgentsChatInput",name:"AgentsChatInput"},{im:"./views/input/recording/error-modal",from:"PermissionsErrorModal",name:"PermissionsErrorModal"},{im:"./views/input/recording/index",from:"RecordingButton",name:"RecordingButton"},{im:"./views/input/recording/modal",from:"PermissionsModal",name:"PermissionsModal"}],C.exports.process=function({require:e,prop:t,value:r}){!e&&"AudioManager"!==t||a("AudioManager",e?e("./store/audio").AudioManager:r),!e&&"Recorder"!==t||a("Recorder",e?e("./store/recorder").Recorder:r),!e&&"Chat"!==t||a("Chat",e?e("./views/chat/index").Chat:r),!e&&"AgentsChatContainer"!==t||a("AgentsChatContainer",e?e("./views/container").AgentsChatContainer:r),!e&&"ChatContext"!==t||a("ChatContext",e?e("./views/context").ChatContext:r),!e&&"useChatContext"!==t||a("useChatContext",e?e("./views/context").useChatContext:r),!e&&"AgentsChatPanel"!==t||a("AgentsChatPanel",e?e("./views/index").AgentsChatPanel:r),!e&&"AgentsChatInput"!==t||a("AgentsChatInput",e?e("./views/input/index").AgentsChatInput:r),!e&&"PermissionsErrorModal"!==t||a("PermissionsErrorModal",e?e("./views/input/recording/error-modal").PermissionsErrorModal:r),!e&&"RecordingButton"!==t||a("RecordingButton",e?e("./views/input/recording/index").RecordingButton:r),!e&&"PermissionsModal"!==t||a("PermissionsModal",e?e("./views/input/recording/modal").PermissionsModal:r)},a("__beyond_pkg",C),a("hmr",new function(){this.on=(e,t)=>C.hmr.on(e,t),this.off=(e,t)=>C.hmr.off(e,t)}),C.initialise(b)}}});