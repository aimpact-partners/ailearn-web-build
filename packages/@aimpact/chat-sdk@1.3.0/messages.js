System.register(["@beyond-js/kernel@0.1.9/bundle","react@18.2.0","pragmate-ui@1.0.0-beta.6/icons","@aimpact/chat-sdk@1.3.0/components/icons","pragmate-ui@1.0.0-beta.6/empty","@beyond-js/react-18-widgets@1.1.2/hooks","pragmate-ui@1.0.0-beta.6/toast","@aimpact/chat-sdk@1.3.0/audio-player","wavesurfer.js@7.8.5","pragmate-ui@1.0.0-beta.6/image","@aimpact/chat-sdk@1.3.0/widgets/playable","@aimpact/chat-sdk@1.3.0/chat/messages/item","@aimpact/chat-sdk@1.3.0/widgets/markdown","pragmate-ui@1.0.0-beta.6/collapsible","@beyond-js/kernel@0.1.9/styles"],function(s,e){var t,a,n,r,c,o,l,i,u,d,m,f,p,g,h,y,E;return s("Messages",void 0),{setters:[function(e){t=e},function(e){a=e},function(e){n=e},function(e){r=e},function(e){c=e},function(e){o=e},function(e){l=e},function(e){i=e},function(e){u=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){p=e},function(e){g=e},function(e){h=e}],execute:function(){E=t.Bundle,(y=new E({module:{vspecifier:"@aimpact/chat-sdk@1.3.0/messages"},type:"code"},e.meta.url).package()).dependencies.update([["react",a],["pragmate-ui/icons",n],["@aimpact/chat-sdk/components/icons",r],["pragmate-ui/empty",c],["@beyond-js/react-18-widgets/hooks",o],["pragmate-ui/toast",l],["@aimpact/chat-sdk/audio-player",i],["wavesurfer.js",u],["pragmate-ui/image",d],["@aimpact/chat-sdk/widgets/playable",m],["@aimpact/chat-sdk/chat/messages/item",f],["@aimpact/chat-sdk/widgets/markdown",p],["pragmate-ui/collapsible",g],["@beyond-js/kernel/styles",h]]),brequire("@beyond-js/kernel/styles").styles.register("@aimpact/chat-sdk@1.3.0/messages"),(E=new Map).set("./answering",{hash:373385579,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SystemAnswering=void 0;var a=e("react"),s=e("pragmate-ui/icons"),n=e("@aimpact/chat-sdk/components/icons");t.SystemAnswering=()=>a.default.createElement("div",{className:"message answering"},a.default.createElement(s.Icon,{className:"lg",icon:n.ICONS["ai-profile"]}),a.default.createElement("div",{className:""},a.default.createElement("span",{className:"dot"}),a.default.createElement("span",{className:"dot"}),a.default.createElement("span",{className:"dot"})))}}),E.set("./context",{hash:326684797,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useChatMessagesContext=t.ChatMessagesContext=void 0;var a=e("react");let s=t.ChatMessagesContext=a.default.createContext({});t.useChatMessagesContext=()=>a.default.useContext(s)}}),E.set("./index",{hash:2848480687,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Messages=function({chat:e,player:t,messages:a,texts:s,current:n,systemIcon:r}){var c,[n,o]=l.default.useState(n);return a.length?(c=a.map((e,t)=>l.default.createElement(i.MessageItemContainer,{key:"message-"+t,message:e})),l.default.createElement(d.ChatMessagesContext.Provider,{value:e={chat:e,player:t,messages:a,texts:s,currentMessage:n,setCurrentMessage:o,systemIcon:r}},l.default.createElement("div",{className:"messages__list"},c))):l.default.createElement(u.Empty,{text:s.empty})};var l=e("react"),i=e("./message"),u=e("pragmate-ui/empty"),d=e("./context")}}),E.set("./message/actions/index",{hash:61955387,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageActions=function({text:t,message:a,messageTokens:e,play:s=!0}){let{player:n,currentMessage:r,setCurrentMessage:c}=(0,E.useChatMessagesContext)(),[o,l]=p.default.useState("stop"),[i,u]=p.default.useState(!1),d=((0,h.useBinder)([n],()=>u(n.speaking)),(0,h.useBinder)([n],()=>{u(!1),l("")},"on.finish"),r?.id===a?.id&&i),m=d||"play"===o?"stop":"play",f=d||"play"===o?async({})=>{await n.stop(),l("stop"),u(!1)}:async e=>{e.stopPropagation(),c(a),n.positionToCut=0,n.textId=a.id,e=t.replaceAll(/[-\\*_#]+/g,"").trim(),await n.play(e,a.id)};return p.default.createElement("div",null,p.default.createElement("div",{className:"audio__actions"},p.default.createElement(g.IconButton,{onClick:async()=>{await globalThis?.navigator.clipboard.writeText(t),y.toast.success("Message copied to clipboard")},icon:"copy"}),s&&p.default.createElement(g.IconButton,{onClick:f,"data-listen":"api",icon:m})),e&&p.default.createElement("div",{className:"tokens overline"},e," TOKENS"))};var p=e("react"),g=e("pragmate-ui/icons"),h=e("@beyond-js/react-18-widgets/hooks"),y=e("pragmate-ui/toast"),E=e("../../context")}}),E.set("./message/components/audio-player",{hash:1138068273,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Player=function({message:e}){let t=URL.createObjectURL(e.audio),a=s.default.useRef(null);return s.default.useEffect(()=>{let e=a.current;e.addEventListener("loadedmetadata",()=>{e.duration===1/0&&(e.currentTime=1e101,e.ontimeupdate=()=>{e.ontimeupdate=null,e.currentTime=0})})},[t]),t?s.default.createElement("div",{className:"audio-player"},s.default.createElement("audio",{controls:!0,preload:"metadata"},s.default.createElement("source",{src:t,type:"audio/mp3",ref:a}),"Your browser does not support the audio element.")):null};var s=e("react")}}),E.set("./message/components/profile-icon",{hash:1956570049,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileIcon=function({role:e}){let[t,a]=(0,l.useState)(!1),{systemIcon:s,chat:n}=(0,u.useChatMessagesContext)(),r=n.user,c=()=>a(!0),o="user"===e?r.photoURL:s;return l.default.createElement("picture",{className:"picture__container"},r.photoURL&&!t||"user"!==e?l.default.createElement(i.Image,{alt:"agent",src:o,onError:c}):l.default.createElement(i.Image,{alt:"user image profile",src:s,onError:c}))};var l=e("react"),i=e("pragmate-ui/image"),u=e("../../context")}}),E.set("./message/components/text",{hash:542713724,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageText=function({message:e}){let t=c.default.useRef(null),{player:a,currentMessage:s}=(0,l.useChatMessagesContext)(),[n,r]=c.default.useState(e.content??"");return(0,o.useBinder)([e],()=>{r(e.content??"")},"change"),(0,o.useBinder)([a],()=>{t.current.querySelectorAll(".highlight").forEach(e=>e.classList.remove("highlight"))},"on.finish"),"string"!=typeof n?null:(e&&e.role,e.id,s?.id,c.default.createElement("div",{className:"message-text__container p2",ref:t},c.default.createElement("div",null,n),e.audio&&c.default.createElement(i.Player,{message:e})))};var c=e("react"),o=e("@beyond-js/react-18-widgets/hooks"),l=e("../../context"),i=e("./audio-player")}}),E.set("./message/index",{hash:351283860,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageItemContainer=function({message:e}){var t=(0,d.useMessage)(e).fetching,a="message__container "+e.role,s="assistant"===e.role?e.usage?.totalTokens:null,[,n,r]=(0,o.parseText)(e.id,e.content,["transcription","fetching-tool-data","kb-processed-response","function","kb-response"]);return c.default.createElement("div",{className:a,"data-id":e.id},c.default.createElement(i.ProfileIcon,{role:e.role}),c.default.createElement("section",{className:"message__content"},c.default.createElement(u.SystemActions,{actions:r,message:e}),c.default.createElement(m.Message,{message:e,fetching:t}),c.default.createElement("section",{className:"message__actions"},c.default.createElement(l.MessageActions,{play:!e.audio,message:e,text:n,messageTokens:s}))))};var c=e("react"),o=e("@aimpact/chat-sdk/widgets/playable"),l=e("./actions"),i=e("./components/profile-icon"),u=e("./system-actions"),d=e("./use-message"),m=e("@aimpact/chat-sdk/chat/messages/item")}}),E.set("./message/system-actions/action",{hash:1180166203,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Action=function({last:s=!1,texts:e,data:{type:n,data:t}}){var a,r=(0,i.useMarked)(),e=e.systemActions,c=({title:e,children:t})=>{var a=s?u.CollapsibleHeader:l.default.Fragment;return l.default.createElement("div",{className:"message-action "+n+(s?" last-action":"")},l.default.createElement(a,null,l.default.createElement("header",null,l.default.createElement("h4",null,e)),l.default.createElement("section",{className:"detail__content"},t)))};if("fetching-tool-data"===n)return l.default.createElement(c,{title:e[n]});if("kb-response"===n)return a=t.matches.map(e=>l.default.createElement("li",{key:e.id},e.paragraph)),l.default.createElement(c,{title:e[n]},l.default.createElement("ul",null,a));if("kb-processed-response"===n)return l.default.createElement(c,{title:e[n]},l.default.createElement("div",{dangerouslySetInnerHTML:{__html:r(t.response)}}));if("transcription"===n)return l.default.createElement(c,{title:e.transcription},l.default.createElement("p",null,t.transcription));if("function"===n&&"kb"===t.name)try{var o=JSON.parse(t.params).text;return l.default.createElement(c,{title:e.functions[t.name]},l.default.createElement("p",null,o))}catch(e){console.error(e)}return l.default.createElement("div",{className:"message-action "+n},n)};var l=e("react"),i=e("@aimpact/chat-sdk/widgets/markdown"),u=e("pragmate-ui/collapsible")}}),E.set("./message/system-actions/index",{hash:2581913566,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SystemActions=function({actions:e}){if(!e?.length)return null;let a=(0,c.useChatMessagesContext)().texts,t=e[e.length-1];return s.default.createElement("section",{className:"message-actions__container"},s.default.createElement(r.CollapsibleContainer,null,s.default.createElement(n.Action,{data:t,last:!0,texts:a}),s.default.createElement(r.CollapsibleContent,null,s.default.createElement("section",{className:"actions__log"},e.map((e,t)=>s.default.createElement(n.Action,{texts:a,key:"action-"+t,data:e}))))))};var s=e("react"),n=e("./action"),r=e("pragmate-ui/collapsible"),c=e("../../context")}}),E.set("./message/use-message",{hash:4237060,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useMessage=function(a){let[e,s]=c.default.useState(!1),[t,n]=c.default.useState(a?.content??""),r=(0,o.useChatMessagesContext)().chat;return c.default.useEffect(()=>{let e=()=>{s(!0),n(a.content)},t=()=>{n(a.content),s(!1)};return r.on(`message.${a.id}.updated`,e),r.on(`message.${a.id}.ended`,t),()=>{r.off(`message.${a.id}.updated`,e),r.off(`message.${a.id}.ended`,t)}},[]),{fetching:e,setFetching:s,content:t,setContent:n}};var c=e("react"),o=e("../context")}}),y.exports.descriptor=[{im:"./index",from:"Messages",name:"Messages"}],y.exports.process=function({require:e,prop:t,value:a}){!e&&"Messages"!==t||s("Messages",e?e("./index").Messages:a)},s("__beyond_pkg",y),s("hmr",new function(){this.on=(e,t)=>y.hmr.on(e,t),this.off=(e,t)=>y.hmr.off(e,t)}),y.initialise(E)}}});