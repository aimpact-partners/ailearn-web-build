System.register(["@beyond-js/kernel@0.1.9/bundle","@aimpact/chat-sdk@1.0.0/settings","@beyond-js/kernel@0.1.9/core","firebase@10.12.0/auth","@beyond-js/reactive@1.1.12/model","firebase@10.12.0/app","@aimpact/chat-sdk@1.0.0/config"],function(i,e){"use strict";var t,s,r,a,n,o,u,h,d;return i("sessionWrapper",void 0),{setters:[function(e){t=e},function(e){s=e},function(e){r=e},function(e){a=e},function(e){n=e},function(e){o=e},function(e){u=e}],execute:function(){d=t.Bundle,(h=new d({module:{vspecifier:"@aimpact/chat-sdk@1.0.0/session"},type:"ts"},e.meta.url).package()).dependencies.update([["@aimpact/chat-sdk/settings",s],["@beyond-js/kernel/core",r],["firebase/auth",a],["@beyond-js/reactive/model",n],["firebase/app",o],["@aimpact/chat-sdk/config",u]]),(d=new Map).set("./auth",{hash:4215675022,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Auth=void 0;var a=e("./firebase/config"),s=e("@aimpact/chat-sdk/settings"),o=e("@beyond-js/kernel/core"),n=e("firebase/auth");class i extends e("@beyond-js/reactive/model").ReactiveModel{#uid;#pendingLogin;#user;get user(){return this.#user}#getUserPromise;#session;constructor(e){super(),this.session=e,(0,n.getRedirectResult)(a.auth).then(this.onRedirectResult.bind(this)),(0,n.onAuthStateChanged)(a.auth,this.onAuthStateChanged.bind(this))}async onRedirectResult(e){e&&this.onAuthStateChanged(e)}async onAuthStateChanged(e){if(!e&&this.#user&&(this.#user=void 0,this.signOut()),e){if(this.#user&&this.#user.id===e.uid)return;var t=await this.getUserModel({id:e.uid});t.setFirebaseUser(e),await t.login(e.accessToken),await this.appLogin(e),this.#user=t}this.ready=!0,this.trigger("ready")}async setUser(e){if(!e&&this.#user&&(this.#user=void 0,this.signOut()),e){if(!e)return;if(this.#user&&this.#user.id===e.uid)return;var t=await this.getUserModel({id:e.uid});t.setFirebaseUser(e),await t.set(e),this.#user=t}this.ready=!0,this.triggerEvent("change")}async getUserModel(e){return this.#user&&this.#user.id===e.id?await this.#user.set(e):(this.#user&&(this.#user=void 0),this.#user=new s.SDKSettings.userModel(e),await this.#user.initialize(e),this.#user.token&&await this.#user.load()),this.#user}appLogin=async e=>{if(this.#pendingLogin)return this.#pendingLogin;if(e.user?.uid){if(this.#uid===e.user.uid)return;if(this.#uid=e.user.uid,!this.#pendingLogin){this.#pendingLogin=new o.PendingPromise;var{displayName:t,photoURL:s,email:i,phoneNumber:r,uid:a}=e.user,e=await e.user.getIdToken();const n=await this.getUserModel({id:a,displayName:t,photoURL:s,email:i,phoneNumber:r,firebaseToken:e});n.login(e).then(e=>{e||console.error("Could not login",e),console.log("in log in validation",this),this.trigger("login"),this.#pendingLogin.resolve({status:!0,user:n})})}return this.#pendingLogin}return{status:!1,error:"INVALID_USER"}};login=async(e,t)=>{try{var s=await(0,n.signInWithEmailAndPassword)(a.auth,e,t);return await this.appLogin(s)}catch(e){return{status:!1,error:e.message}}};0;signInWithGoogle=async()=>{try{var e=await(0,n.signInWithPopup)(a.auth,a.googleProvider);return await this.appLogin(e)}catch(e){return{status:!1,error:{"auth/account-exists-with-different-credential":"ACCOUNT_EXISTS_WITH_DIFFERENT_CREDENTIAL","auth/popup-closed-by-user":"POPUP_CLOSED_BY_USER"}[e.code]||"CANNOT"}}};registerWithEmail=async(e,t,s)=>{try{var i=await(0,n.createUserWithEmailAndPassword)(a.auth,e,t),r={...i.user,displayName:s};return await this.appLogin({...i,user:r})}catch(e){return{status:!1,error:e.message}}};resetPassword=async e=>{try{return await(0,n.sendPasswordResetEmail)(a.auth,e),{status:!0}}catch(e){return{status:!1,error:e.message}}};confirmPasswordReset=async(e,t)=>{try{return await(0,n.verifyPasswordResetCode)(a.auth,e),await(0,n.confirmPasswordReset)(a.auth,e,t),{status:!0}}catch(e){return{status:!1,error:e.message}}};signOut=async()=>{try{await(this.#pendingLogin=void 0,n.signOut)(a.auth)}catch(e){console.error(e)}};logout=this.signOut}t.Auth=i}}),d.set("./firebase/config",{hash:2348430544,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.googleProvider=t.facebookProvider=t.auth=void 0;var s=e("firebase/app"),i=e("firebase/auth"),e=e("@aimpact/chat-sdk/config"),r={apiKey:"AIzaSyBYiZcPNBky2QvNdVwgCgU_v2B7feLtbQU",authDomain:"aimpact-partners-dev.firebaseapp.com",databaseURL:"https://aimpact-partners-dev-default-rtdb.firebaseio.com",projectId:"aimpact-partners-dev",storageBucket:"aimpact-partners-dev.appspot.com",messagingSenderId:"1081434267674",appId:"1:1081434267674:web:9396cc23e55385b5d171a3",measurementId:"G-QLL5WFH89Y"},a={apiKey:"AIzaSyAEEozzwR0cguqynxvL1qB38i8liOCgtJc",authDomain:"aimpact-partners-prod.firebaseapp.com",projectId:"aimpact-partners-prod",storageBucket:"aimpact-partners-prod.appspot.com",messagingSenderId:"741854278426",appId:"1:741854278426:web:9ff2a50e705edcc501f2a3"},s=(0,s.initializeApp)({local:r,development:r,testing:{apiKey:"AIzaSyDiwwiF_O_WZHyq7QrjnxqIg9EXz1vavV0",authDomain:"chat-api-test-393820.firebaseapp.com",projectId:"chat-api-test-393820",storageBucket:"chat-api-test-393820.appspot.com",messagingSenderId:"1083395329827",appId:"1:1083395329827:web:c6fead0e2d4124b4f90696"},quality:a,production:a}[e.default.environment]);t.auth=(0,i.getAuth)(s),t.googleProvider=new i.GoogleAuthProvider,t.facebookProvider=new i.FacebookAuthProvider}}),d.set("./index",{hash:3248857962,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.sessionWrapper=void 0;var s=e("./firebase/config"),i=e("@beyond-js/reactive/model"),r=e("@beyond-js/kernel/core"),a=e("./auth");class n extends i.ReactiveModel{get user(){return this.#auth.user}get userId(){return s.auth.currentUser?s.auth.currentUser.uid:null}get logged(){return!!this.#auth.user}#promise;get isReady(){return this.#promise}#auth;get auth(){return this.#auth}constructor(){super(),this.#promise=new r.PendingPromise,this.#auth=new a.Auth(this),this.#auth.on("login",()=>this.trigger("login")),this.#auth.on("ready",this.listenReady.bind(this))}listenReady(){this.ready=!0,this.#promise.resolve(this.ready),this.triggerEvent("change")}async signInWithGoogle(){try{var e=await this.#auth.signInWithGoogle();return!!e?.status&&(this.triggerEvent("login"),e)}catch(e){return console.error(e),{status:!1,error:"CANNOT"}}}async registerWithEmail({email:e,password:t,username:s}){try{var i=await this.#auth.registerWithEmail(e,t,s);return i.status?i:{status:!1,error:i.error}}catch(e){return{status:!1,error:"CANNOT"}}}async logout(){try{return await this.#auth.signOut(),globalThis.localStorage.clear(),this.triggerEvent("logout"),!0}catch(e){return console.error(e),!1}}}e=t.sessionWrapper=new n,globalThis.s=e}}),h.exports.descriptor=[{im:"./index",from:"sessionWrapper",name:"sessionWrapper"}],h.exports.process=function({require:e,prop:t,value:s}){!e&&"sessionWrapper"!==t||i("sessionWrapper",e?e("./index").sessionWrapper:s)},i("__beyond_pkg",h),i("hmr",new function(){this.on=(e,t)=>h.hmr.on(e,t),this.off=(e,t)=>h.hmr.off(e,t)}),h.initialise(d)}}});