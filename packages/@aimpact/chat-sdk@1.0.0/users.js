System.register(["@beyond-js/kernel@0.1.9/bundle","@beyond-js/reactive@1.1.12/entities","@beyond-js/kernel@0.1.9/core","firebase@10.12.0/auth","@aimpact/chat-sdk@1.0.0/api","@aimpact/chat-sdk@1.0.0/config"],function(r,e){"use strict";var i,t,s,a,n,o,d,c;return r({IChatUser:void 0,User:void 0}),{setters:[function(e){i=e},function(e){t=e},function(e){s=e},function(e){a=e},function(e){n=e},function(e){o=e}],execute:function(){c=i.Bundle,(d=new c({module:{vspecifier:"@aimpact/chat-sdk@1.0.0/users"},type:"ts"},e.meta.url).package()).dependencies.update([["@beyond-js/reactive/entities",t],["@beyond-js/kernel/core",s],["firebase/auth",a],["@aimpact/chat-sdk/api",n],["@aimpact/chat-sdk/config",o]]),(c=new Map).set("./interface",{hash:4186078931,creator:function(e,i){Object.defineProperty(i,"__esModule",{value:!0})}}),c.set("./item",{hash:2283316067,creator:function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.User=void 0;var t=e("@beyond-js/reactive/entities"),r=e("./provider"),s=e("@beyond-js/kernel/core");class a extends t.Item{properties=["displayName","id","email","photoURL","phoneNumber","token"];#logged;#promiseInit;#firebaseUser;get logged(){return this.#logged}get firebaseToken(){return this.#firebaseUser?this.#firebaseUser.getIdToken():null}constructor(e){super({id:e.id,db:"chat-api",storeName:"User",provider:r.UserProvider})}initialize=async e=>{if(super.initialise(),this.#promiseInit)return this.#promiseInit;this.#promiseInit=new s.PendingPromise,await this.isReady,await this.set(e),this.#promiseInit.resolve(),this.loaded=!0,this.trigger("user.initialized")};setFirebaseUser=async e=>{this.#firebaseUser=e};async login(e){if(await this.isReady,!this.#logged){if(e={...this.getProperties(),id:this.id,firebaseToken:e},(e=await this.provider.load(e)).status)return await this.set(e.data,!0),this.#logged=!0;throw new Error(e.error)}}}i.User=a}}),c.set("./provider",{hash:2462010797,creator:function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.UserProvider=void 0;var t=e("@aimpact/chat-sdk/api"),r=e("@aimpact/chat-sdk/config");i.UserProvider=class{#api;constructor(){this.#api=new t.Api(r.default.params.apis.chat)}async load(e){this.#api.bearer(e.firebaseToken);var{status:e,data:i}=await this.#api.post("/auth/login",e);if(e)return{status:e,data:i};throw new Error("error loading user data")}}}}),d.exports.descriptor=[{im:"./interface",from:"IChatUser",name:"IChatUser"},{im:"./item",from:"User",name:"User"}],d.exports.process=function({require:e,prop:i,value:t}){!e&&"IChatUser"!==i||r("IChatUser",e?e("./interface").IChatUser:t),!e&&"User"!==i||r("User",e?e("./item").User:t)},r("__beyond_pkg",d),r("hmr",new function(){this.on=(e,i)=>d.hmr.on(e,i),this.off=(e,i)=>d.hmr.off(e,i)}),d.initialise(c)}}});