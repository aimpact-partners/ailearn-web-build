System.register(["@beyond-js/kernel@0.1.9/bundle","@beyond-js/reactive@1.1.12/entities","@beyond-js/kernel@0.1.9/core","firebase@10.12.0/auth","@aimpact/chat-sdk@1.0.0/api","@aimpact/ailearn-app@0.0.43/config"],function(r,e){"use strict";var i,t,s,a,n,o,d,c;return r({IChatUser:void 0,User:void 0}),{setters:[function(e){i=e},function(e){t=e},function(e){s=e},function(e){a=e},function(e){n=e},function(e){o=e}],execute:function(){c=i.Bundle,(d=new c({module:{vspecifier:"@aimpact/chat-sdk@1.0.0/users"},type:"ts"},e.meta.url).package()).dependencies.update([["@beyond-js/reactive/entities",t],["@beyond-js/kernel/core",s],["firebase/auth",a],["@aimpact/chat-sdk/api",n],["@aimpact/chat-sdk/config",o]]),(c=new Map).set("./interface",{hash:4186078931,creator:function(e,i){Object.defineProperty(i,"__esModule",{value:!0})}}),c.set("./item",{hash:2283316067,creator:function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.User=void 0;var t=e("@beyond-js/reactive/entities"),r=e("./provider"),s=e("@beyond-js/kernel/core");class a extends t.Item{properties=["displayName","id","email","photoURL","phoneNumber","token"];#logged;#promiseInit;#firebaseUser;get logged(){return this.#logged}get firebaseToken(){return this.#firebaseUser?this.#firebaseUser.getIdToken():null}constructor(e){super({id:e.id,db:"chat-api",storeName:"User",provider:r.UserProvider})}initialize=async e=>{if(super.initialise(),this.#promiseInit)return this.#promiseInit;this.#promiseInit=new s.PendingPromise,await this.isReady,await this.set(e),this.#promiseInit.resolve(),this.loaded=!0,this.trigger("user.initialized")};setFirebaseUser=async e=>{this.#firebaseUser=e};async login(e){if(await this.isReady,!this.#logged){e={...this.getProperties(),id:this.id,firebaseToken:e},e=await this.provider.load(e);if(e.status)return await this.set(e.data,!0),this.#logged=!0;throw new Error(e.error)}}}i.User=a}}),c.set("./provider",{hash:2462010797,creator:function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.UserProvider=void 0;var t=e("@aimpact/chat-sdk/api"),r=e("@aimpact/chat-sdk/config");i.UserProvider=class{#api;constructor(){this.#api=new t.Api(r.default.params.apis.chat)}async load(e){this.#api.bearer(e.firebaseToken);var{status:e,data:i}=await this.#api.post("/auth/login",e);if(e)return{status:e,data:i};throw new Error("error loading user data")}}}}),d.exports.descriptor=[{im:"./interface",from:"IChatUser",name:"IChatUser"},{im:"./item",from:"User",name:"User"}],d.exports.process=function({require:e,prop:i,value:t}){!e&&"IChatUser"!==i||r("IChatUser",e?e("./interface").IChatUser:t),!e&&"User"!==i||r("User",e?e("./item").User:t)},r("__beyond_pkg",d),r("hmr",new function(){this.on=(e,i)=>d.hmr.on(e,i),this.off=(e,i)=>d.hmr.off(e,i)}),d.initialise(c)}}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9pbnRlcmZhY2UudHMiLCIvaXRlbS50cyIsIi9wcm92aWRlci50cyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIl9lbnRpdGllcyIsInJlcXVpcmUiLCJfcHJvdmlkZXIiLCJfY29yZSIsIlVzZXIiLCJJdGVtIiwicHJvcGVydGllcyIsIiNsb2dnZWQiLCIjcHJvbWlzZUluaXQiLCIjZmlyZWJhc2VVc2VyIiwibG9nZ2VkIiwidGhpcyIsImZpcmViYXNlVG9rZW4iLCJnZXRJZFRva2VuIiwiY29uc3RydWN0b3IiLCJzcGVjcyIsInN1cGVyIiwiaWQiLCJkYiIsInN0b3JlTmFtZSIsInByb3ZpZGVyIiwiVXNlclByb3ZpZGVyIiwiaW5pdGlhbGl6ZSIsImluaXRpYWxpc2UiLCJQZW5kaW5nUHJvbWlzZSIsImF3YWl0IiwiaXNSZWFkeSIsInNldCIsInJlc29sdmUiLCJsb2FkZWQiLCJ0cmlnZ2VyIiwic2V0RmlyZWJhc2VVc2VyIiwidXNlciIsImxvZ2luIiwiZ2V0UHJvcGVydGllcyIsInJlc3BvbnNlIiwibG9hZCIsInN0YXR1cyIsImRhdGEiLCJFcnJvciIsImVycm9yIiwiX2FwaSIsIl9jb25maWciLCIjYXBpIiwiQXBpIiwiZGVmYXVsdCIsInBhcmFtcyIsImFwaXMiLCJjaGF0IiwiYmVhcmVyIiwicG9zdCJdLCJtYXBwaW5ncyI6InF3QkFFQUEsT0FBQUMsZUFBQUMsRUFBQSxhQUFBLENBQ0FDLE1BQUEsQ0FBQSxDQUNBLENBQUEsQyx5SENIQSxJQUFBQyxFQUFBQyxFQUFBLDhCQUFBLEVBQ0FDLEVBQUFELEVBQUEsWUFBQSxFQUNBRSxFQUFBRixFQUFBLHdCQUFBLFFBSXdCRyxVQUFhSixFQUFBSyxLQUMxQkMsV0FBYSxDQUFDLGNBQWUsS0FBTSxRQUFTLFdBQVksY0FBZSxTQUNqRkMsUUFHQUMsYUFDQUMsY0FDQUMsYUFDQyxPQUFPQyxLQUFLSixPQUNiLENBRUFLLG9CQUNDLE9BQU9ELEtBQUtGLGNBQWdCRSxLQUFLRixjQUFjSSxXQUFVLEVBQUssSUFDL0QsQ0FNQUMsWUFBWUMsR0FFWEMsTUFBTSxDQUFFQyxHQUFJRixFQUFNRSxHQUFJQyxHQUFJLFdBQVlDLFVBQVcsT0FBUUMsU0FBVWxCLEVBQUFtQixZQUFZLENBQUUsQ0FHbEYsQ0FFQUMsV0FBbUJQLE1BQUFBLElBR2xCLEdBRkFDLE1BQU1PLFdBQVUsRUFFWlosS0FBS0gsYUFBYyxPQUFPRyxLQUFLSCxhQUNuQ0csS0FBS0gsYUFBZSxJQUFJTCxFQUFBcUIsZUFDeEJDLE1BQU1kLEtBQUtlLFFBRVhELE1BQU1kLEtBQUtnQixJQUFJWixDQUFLLEVBRXBCSixLQUFLSCxhQUFhb0IsUUFBTyxFQUN6QmpCLEtBQUtrQixPQUFTLENBQUEsRUFFZGxCLEtBQUttQixRQUFRLGtCQUFrQixDQUNoQyxFQUVBQyxnQkFBd0JDLE1BQUFBLElBQ3ZCckIsS0FBS0YsY0FBZ0J1QixDQUN0QixFQUVBQyxZQUFZckIsR0FFWCxHQURBYSxNQUFNZCxLQUFLZSxRQUNQZixDQUFBQSxLQUFLSixRQUFULENBRU1RLEVBQVEsQ0FBRSxHQUFHSixLQUFLdUIsY0FBYSxFQUFJakIsR0FBSU4sS0FBS00sR0FBSUwsY0FBQUEsQ0FBYSxFQUU3RHVCLEVBQVdWLE1BQU1kLEtBQUtTLFNBQVNnQixLQUFLckIsQ0FBSyxFQUUvQyxHQUFLb0IsRUFBU0UsT0FPZCxPQUpBWixNQUFNZCxLQUFLZ0IsSUFBSVEsRUFBU0csS0FBTSxDQUFBLENBQUksRUFHbEMzQixLQUFLSixRQUFVLENBQUEsRUFMZCxNQUFNLElBQUlnQyxNQUFNSixFQUFTSyxLQUFLLENBUGIsQ0FjbkIsQyxDQUNBMUMsRUFBQU0sS0FBQUEsQyxxSUNyRUQsSUFBQXFDLEVBQUF4QyxFQUFBLHVCQUFBLEVBQ0F5QyxFQUFBekMsRUFBQSwwQkFBQSxFQW9CQ0gsRUFBQXVCLG1CQWpCQXNCLEtBRUE3QixjQUNDSCxLQUFLZ0MsS0FBTyxJQUFJRixFQUFBRyxJQUFJRixFQUFBRyxRQUFPQyxPQUFPQyxLQUFLQyxJQUFJLENBQzVDLENBRUFaLFdBQVdyQixHQUNWSixLQUFLZ0MsS0FBS00sT0FBT2xDLEVBQU1ILGFBQWEsRUFFcEMsR0FBTSxDQUFFeUIsT0FBQUEsRUFBUUMsS0FBQUEsQ0FBSSxFQUFLYixNQUFNZCxLQUFLZ0MsS0FBS08sS0FBSyxjQUFlbkMsQ0FBSyxFQUVsRSxHQUFLc0IsRUFJTCxNQUFPLENBQUVBLE9BQUFBLEVBQVFDLEtBQUFBLENBQUksRUFIcEIsTUFBTSxJQUFJQyxNQUFNLHlCQUF5QixDQUkzQyxDIn0=