System.register(["@beyond-js/kernel@0.1.9/bundle","@beyond-js/reactive@1.1.12/entities","@beyond-js/kernel@0.1.9/core","firebase@10.12.0/auth","@aimpact/chat-sdk@1.0.0/startup","@aimpact/chat-sdk@1.0.0/api","@aimpact/ailearn-app@0.0.46/config"],function(r,e){"use strict";var t,i,s,a,n,o,d,c,p;return r({IChatUser:void 0,User:void 0}),{setters:[function(e){t=e},function(e){i=e},function(e){s=e},function(e){a=e},function(e){n=e},function(e){o=e},function(e){d=e}],execute:function(){p=t.Bundle,(c=new p({module:{vspecifier:"@aimpact/chat-sdk@1.0.0/users"},type:"ts"},e.meta.url).package()).dependencies.update([["@beyond-js/reactive/entities",i],["@beyond-js/kernel/core",s],["firebase/auth",a],["@aimpact/chat-sdk/startup",n],["@aimpact/chat-sdk/api",o],["@aimpact/chat-sdk/config",d]]),(p=new Map).set("./interface",{hash:4186078931,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),p.set("./item",{hash:1556460778,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var i=e("@beyond-js/reactive/entities"),r=e("./provider"),s=e("@beyond-js/kernel/core"),a=e("@aimpact/chat-sdk/startup");class n extends i.Item{properties=["displayName","id","email","photoURL","phoneNumber","token"];#logged;#promiseInit;#firebaseUser;get logged(){return this.#logged}get firebaseToken(){return this.#firebaseUser?this.#firebaseUser.getIdToken():null}constructor(e){super({id:e.id,db:"chat-api",storeName:"User",provider:r.UserProvider})}initialize=async e=>{if(super.initialise(),this.#promiseInit)return this.#promiseInit;this.#promiseInit=new s.PendingPromise,await this.isReady,await this.set(e),this.#promiseInit.resolve(),this.loaded=!0,this.trigger("user.initialized")};setFirebaseUser=async e=>{this.#firebaseUser=e};async login(e){if(await this.isReady,!this.#logged){e={...this.getProperties(),id:this.id,firebaseToken:e},e=await this.provider.load(e);if(e.status)return await this.set(e.data,!0),this.#logged=!0,this.trigger("login"),!0;throw new Error(e.error)}}static async getModel(e){return new(a.sdkConfig.userModel||n)(e)}}t.User=n}}),p.set("./provider",{hash:3883569924,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.UserProvider=void 0;var i=e("@aimpact/chat-sdk/api"),r=e("@aimpact/chat-sdk/startup");t.UserProvider=class{#api;constructor(){this.#api=new i.Api(r.sdkConfig.api)}async load(e){this.#api.bearer(e.firebaseToken);var{status:e,data:t}=await this.#api.post("/auth/login",e);if(e)return{status:e,data:t};throw new Error("error loading user data")}}}}),c.exports.descriptor=[{im:"./interface",from:"IChatUser",name:"IChatUser"},{im:"./item",from:"User",name:"User"}],c.exports.process=function({require:e,prop:t,value:i}){!e&&"IChatUser"!==t||r("IChatUser",e?e("./interface").IChatUser:i),!e&&"User"!==t||r("User",e?e("./item").User:i)},r("__beyond_pkg",c),r("hmr",new function(){this.on=(e,t)=>c.hmr.on(e,t),this.off=(e,t)=>c.hmr.off(e,t)}),c.initialise(p)}}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9pbnRlcmZhY2UudHMiLCIvaXRlbS50cyIsIi9wcm92aWRlci50cyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIl9lbnRpdGllcyIsInJlcXVpcmUiLCJfcHJvdmlkZXIiLCJfY29yZSIsIl9zdGFydHVwIiwiVXNlciIsIkl0ZW0iLCJwcm9wZXJ0aWVzIiwiI2xvZ2dlZCIsIiNwcm9taXNlSW5pdCIsIiNmaXJlYmFzZVVzZXIiLCJsb2dnZWQiLCJ0aGlzIiwiZmlyZWJhc2VUb2tlbiIsImdldElkVG9rZW4iLCJjb25zdHJ1Y3RvciIsInNwZWNzIiwic3VwZXIiLCJpZCIsImRiIiwic3RvcmVOYW1lIiwicHJvdmlkZXIiLCJVc2VyUHJvdmlkZXIiLCJpbml0aWFsaXplIiwiaW5pdGlhbGlzZSIsIlBlbmRpbmdQcm9taXNlIiwiYXdhaXQiLCJpc1JlYWR5Iiwic2V0IiwicmVzb2x2ZSIsImxvYWRlZCIsInRyaWdnZXIiLCJzZXRGaXJlYmFzZVVzZXIiLCJ1c2VyIiwibG9naW4iLCJnZXRQcm9wZXJ0aWVzIiwicmVzcG9uc2UiLCJsb2FkIiwic3RhdHVzIiwiZGF0YSIsIkVycm9yIiwiZXJyb3IiLCJnZXRNb2RlbCIsInNka0NvbmZpZyIsInVzZXJNb2RlbCIsIl9hcGkiLCIjYXBpIiwiQXBpIiwiYXBpIiwiYmVhcmVyIiwicG9zdCJdLCJtYXBwaW5ncyI6IjAxQkFFQUEsT0FBQUMsZUFBQUMsRUFBQSxhQUFBLENBQ0FDLE1BQUEsQ0FBQSxDQUNBLENBQUEsQyx5SENIQSxJQUFBQyxFQUFBQyxFQUFBLDhCQUFBLEVBQ0FDLEVBQUFELEVBQUEsWUFBQSxFQUNBRSxFQUFBRixFQUFBLHdCQUFBLEVBR0FHLEVBQUFILEVBQUEsMkJBQUEsUUFDd0JJLFVBQWFMLEVBQUFNLEtBQzFCQyxXQUFhLENBQUMsY0FBZSxLQUFNLFFBQVMsV0FBWSxjQUFlLFNBQ2pGQyxRQUdBQyxhQUNBQyxjQUNBQyxhQUNDLE9BQU9DLEtBQUtKLE9BQ2IsQ0FFQUssb0JBQ0MsT0FBT0QsS0FBS0YsY0FBZ0JFLEtBQUtGLGNBQWNJLFdBQVUsRUFBSyxJQUMvRCxDQU1BQyxZQUFZQyxHQUVYQyxNQUFNLENBQUVDLEdBQUlGLEVBQU1FLEdBQUlDLEdBQUksV0FBWUMsVUFBVyxPQUFRQyxTQUFVbkIsRUFBQW9CLFlBQVksQ0FBRSxDQUdsRixDQUVBQyxXQUFtQlAsTUFBQUEsSUFHbEIsR0FGQUMsTUFBTU8sV0FBVSxFQUVaWixLQUFLSCxhQUFjLE9BQU9HLEtBQUtILGFBQ25DRyxLQUFLSCxhQUFlLElBQUlOLEVBQUFzQixlQUN4QkMsTUFBTWQsS0FBS2UsUUFFWEQsTUFBTWQsS0FBS2dCLElBQUlaLENBQUssRUFFcEJKLEtBQUtILGFBQWFvQixRQUFPLEVBQ3pCakIsS0FBS2tCLE9BQVMsQ0FBQSxFQUVkbEIsS0FBS21CLFFBQVEsa0JBQWtCLENBQ2hDLEVBRUFDLGdCQUF3QkMsTUFBQUEsSUFDdkJyQixLQUFLRixjQUFnQnVCLENBQ3RCLEVBRUFDLFlBQVlyQixHQUVYLEdBREFhLE1BQU1kLEtBQUtlLFFBQ1BmLENBQUFBLEtBQUtKLFFBQVQsQ0FFTVEsRUFBUSxDQUFFLEdBQUdKLEtBQUt1QixjQUFhLEVBQUlqQixHQUFJTixLQUFLTSxHQUFJTCxjQUFBQSxDQUFhLEVBRTdEdUIsRUFBV1YsTUFBTWQsS0FBS1MsU0FBU2dCLEtBQUtyQixDQUFLLEVBRS9DLEdBQUtvQixFQUFTRSxPQVFkLE9BTEFaLE1BQU1kLEtBQUtnQixJQUFJUSxFQUFTRyxLQUFNLENBQUEsQ0FBSSxFQUdsQzNCLEtBQUtKLFFBQVUsQ0FBQSxFQUNmSSxLQUFLbUIsUUFBUSxPQUFPLEVBQ2IsQ0FBQSxFQVBOLE1BQU0sSUFBSVMsTUFBTUosRUFBU0ssS0FBSyxDQVBiLENBZW5CLENBRUFDLHNCQUFzQjFCLEdBQ3JCLE9BQWdDLElBQTVCWixFQUFBdUMsVUFBVUMsV0FDSHZDLEdBRDZDVyxDQUFLLENBRTlELEMsQ0FDQWxCLEVBQUFPLEtBQUFBLEMscUlDM0VELElBQUF3QyxFQUFBNUMsRUFBQSx1QkFBQSxFQUVBRyxFQUFBSCxFQUFBLDJCQUFBLEVBbUJDSCxFQUFBd0IsbUJBakJBd0IsS0FFQS9CLGNBQ0NILEtBQUtrQyxLQUFPLElBQUlELEVBQUFFLElBQUkzQyxFQUFBdUMsVUFBVUssR0FBRyxDQUNsQyxDQUVBWCxXQUFXckIsR0FDVkosS0FBS2tDLEtBQUtHLE9BQU9qQyxFQUFNSCxhQUFhLEVBRXBDLEdBQU0sQ0FBRXlCLE9BQUFBLEVBQVFDLEtBQUFBLENBQUksRUFBS2IsTUFBTWQsS0FBS2tDLEtBQUtJLEtBQUssY0FBZWxDLENBQUssRUFFbEUsR0FBS3NCLEVBSUwsTUFBTyxDQUFFQSxPQUFBQSxFQUFRQyxLQUFBQSxDQUFJLEVBSHBCLE1BQU0sSUFBSUMsTUFBTSx5QkFBeUIsQ0FJM0MsQyJ9