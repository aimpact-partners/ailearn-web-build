System.register(["@beyond-js/widgets@1.1.0/render","@beyond-js/kernel@0.1.9/bundle","@beyond-js/kernel@0.1.9/styles","@beyond-js/react-18-widgets@1.1.2/page","@aimpact/ailearn-app@0.1.13/main-layout.widget","@beyond-js/reactive@1.2.0/model","@aimpact/ailearn-sdk@1.0.0/learning-modules","@beyond-js/kernel@0.1.9/texts","@aimpact/ailearn-app@0.1.13/i18n.ts","react@18.2.0","pragmate-ui@1.0.0-beta.6/components","@aimpact/ailearn-app@0.1.13/components/ui","@beyond-js/react-18-widgets@1.1.2/hooks","pragmate-ui@1.0.0-beta.6/icons","@aimpact/ailearn-app@0.1.13/components/module-card","pragmate-ui@1.0.0-beta.6/modal","@aimpact/ailearn-app@0.1.13/modules/assign","@aimpact/ailearn-app@0.1.13/modules/owner-assign.code","pragmate-ui@1.0.0-beta.6/tabs","@beyond-js/kernel@0.1.9/routing","pragmate-ui@1.0.0-beta.6/list","pragmate-ui@1.0.0-beta.6/empty"],function(n,e){var t,a,s,r,i,l,o,c,d,u,m,p,f,g,h,y,b,v,x,E,w,C,_,M;return n({Controller:void 0,View:void 0}),{setters:[function(e){t=e},function(e){a=e},function(e){s=e},function(e){r=e},function(e){i=e},function(e){l=e},function(e){o=e},function(e){c=e},function(e){d=e},function(e){u=e},function(e){m=e},function(e){p=e},function(e){f=e},function(e){g=e},function(e){h=e},function(e){y=e},function(e){b=e},function(e){v=e},function(e){x=e},function(e){E=e},function(e){w=e},function(e){C=e}],execute:function(){M=a.Bundle,(_=new M({module:{vspecifier:"@aimpact/ailearn-app@0.1.13/modules/list",multibundle:!0},type:"widget"},e.meta.url).package()).dependencies.update([["@beyond-js/widgets/render",t],["@beyond-js/kernel/styles",s],["@beyond-js/react-18-widgets/page",r],["@aimpact/ailearn-app/main-layout.widget",i],["@beyond-js/reactive/model",l],["@aimpact/ailearn-sdk/learning-modules",o],["@beyond-js/kernel/texts",c],["@aimpact/ailearn-app/i18n.ts",d],["react",u],["pragmate-ui/components",m],["@aimpact/ailearn-app/components/ui",p],["@beyond-js/react-18-widgets/hooks",f],["pragmate-ui/icons",g],["@aimpact/ailearn-app/components/module-card",h],["pragmate-ui/modal",y],["@aimpact/ailearn-app/modules/assign",b],["@aimpact/ailearn-app/modules/owner-assign.code",v],["pragmate-ui/tabs",x],["@beyond-js/kernel/routing",E],["pragmate-ui/list",w],["pragmate-ui/empty",C]]),brequire("@beyond-js/widgets/render").widgets.register([{name:"ailearn-modules-list",vspecifier:"@aimpact/ailearn-app@0.1.13/modules/list.widget",is:"page",route:"/modules/list",layout:"main-layout"}]),brequire("@beyond-js/kernel/styles").styles.register("@aimpact/ailearn-app@0.1.13/modules/list.widget"),(M=new Map).set("./controller",{hash:2233299519,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0;var a=e("@beyond-js/react-18-widgets/page"),n=e("./views"),s=e("./store");class r extends a.PageReactWidgetController{#store;createStore(){return this.#store=new s.StoreManager,this.#store}get Widget(){return n.View}show(){var e=this.uri.qs.get("tab");this.#store.init(),this.#store.load(e)}hide(){this.#store.clear()}}t.Controller=r}}),M.set("./store",{hash:3782673124,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StoreManager=void 0;var a=e("@aimpact/ailearn-app/main-layout.widget"),n=e("@beyond-js/reactive/model"),s=e("@aimpact/ailearn-sdk/learning-modules"),r=e("@beyond-js/kernel/texts"),i=e("beyond_context"),l=e("@aimpact/ailearn-app/i18n.ts");class o extends n.ReactiveModel{#drafts;get draft(){return this.#drafts}#modules;get modules(){return this.#modules}#tab;get tab(){return this.#tab}#texts=new r.CurrentTexts(i.module.specifier);get texts(){return this.#texts?.value}get globalTexts(){return l.globalTexts.texts}get ready(){return super.ready&&this.#texts.ready&&l.globalTexts.ready}constructor(){super(),this.#drafts=new s.LearningModules,this.#modules=new s.LearningModules}init(){this.#texts.on("change",this.listenTexts),this.listenTexts()}listenTexts=()=>{this.#texts.ready&&(this.setBreadcrumb(),this.triggerEvent())};clear(){super.ready=!1,this.#texts.off("change",this.listenTexts)}setBreadcrumb(){a.LayoutBroker.overlay=!1}async loadModules(){this.#tab="published",this.#modules.loaded||(await this.#modules.load({type:"module",route:""}),globalThis.m=this.#modules,super.ready=!0)}async loadDrafts(){this.#tab="draft",this.#drafts.loaded||(await this.#drafts.load({type:"draft",route:"/drafts"}),super.ready=!0)}load(e="published"){var t={draft:this.loadDrafts.bind(this),published:this.loadModules.bind(this)};if(!t[e])throw new Error("Invalid type: "+e);t[e]()}async deleteDraft(e){await this.#drafts.elements.get(e).delete(),await this.#drafts.load({type:"draft",route:"/drafts"}),this.triggerEvent()}async deleteModule(e){await e.deleteItem(),await this.#modules.load({type:"module",route:""}),this.triggerEvent()}}t.StoreManager=o}}),M.set("./views/context",{hash:515844683,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useListContext=t.ListContext=void 0;var a=e("react");let n=t.ListContext=a.default.createContext({});t.useListContext=()=>a.default.useContext(n)}}),M.set("./views/empty",{hash:1830535700,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EmptyList=function(){var e=(0,s.useListContext)().texts;return a.createElement(r.EmptyCard,{text:e.empty.general.title,description:e.empty.general.description,icon:"edit"},a.createElement("div",{className:"actions flex-container flex-center"},a.createElement(n.Link,{href:"/modules/management",className:"grow btn btn-primary"},e.actions.create)))};var a=e("react"),n=e("pragmate-ui/components"),s=e("./context"),r=e("@aimpact/ailearn-app/components/ui")}}),M.set("./views/index",{hash:820208469,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.View=function({store:e}){let[t,a]=(0,i.useState)(e.ready),[n]=(0,i.useState)(e.fetching),s=e.texts;return(0,l.useBinder)([e],()=>a(e.ready)),t?i.default.createElement(d.ListContext.Provider,{value:{texts:s,store:e,fetching:n}},i.default.createElement(r.PageContainer,null,i.default.createElement(r.PageTitle,{title:s.title},i.default.createElement("section",{className:"title__actions"},i.default.createElement(c.Link,{href:"/modules/management"},i.default.createElement(o.Icon,{icon:"add-circle"}),s.actions.create))),i.default.createElement(u.List,null))):i.default.createElement(r.PageLoader,{fetching:!0})};var r=e("@aimpact/ailearn-app/components/ui"),i=e("react"),l=e("@beyond-js/react-18-widgets/hooks"),o=e("pragmate-ui/icons"),c=e("pragmate-ui/components"),d=e("./context"),u=e("./list")}}),M.set("./views/interfaces",{hash:12017522,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),M.set("./views/item/drafts",{hash:4141982947,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ItemDrafts=function({item:t}){let{texts:e,store:a}=(0,i.useListContext)(),[n,s]=r.useState(!1);return r.createElement(r.Fragment,null,r.createElement(l.ModuleCard,{item:t,texts:e,href:"/modules/management?id="+t.id},r.createElement(l.ModuleCardFooter,{item:t},r.createElement(o.IconButton,{icon:"delete",onClick:e=>{e.preventDefault(),e.stopPropagation(),s(!0)},title:e.actions.delete}))),n&&r.createElement(c.ConfirmModal,{title:e.deleteItem.title,show:!0,onConfirm:async e=>{await a.deleteDraft(t.id)},btnConfirm:{label:a.globalTexts.actions.confirm},btnCancel:{label:a.globalTexts.actions.cancel},onCancel:()=>s(!1)},r.createElement("span",null,e.deleteItem.description)))};var r=e("react"),i=e("../context"),l=e("@aimpact/ailearn-app/components/module-card"),o=e("pragmate-ui/icons"),c=e("pragmate-ui/modal")}}),M.set("./views/item/module/delete",{hash:2137978036,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteItemModal=function({onClose:e,item:t,texts:a}){let[,,]=c.useState(!1),[n,s]=c.useState(!1),[r,i]=c.useState(null),l=(0,p.useListContext)().store,o=l.globalTexts;return c.createElement(d.Modal,{show:!0,onClose:e,className:"pui-modal-delete"},c.createElement("header",{className:"modal__header"},c.createElement("h2",null,a.delete.title)),c.createElement(m.ErrorRenderer,{error:r}),c.createElement("div",{className:"modal__content"},c.createElement("p",null,a.delete.description)),c.createElement("footer",{className:"modal__actions"},c.createElement(u.Button,{onClick:e,variant:"primary",bordered:!0},o.actions.cancel),c.createElement(u.Button,{onClick:async()=>{try{s(!0),await l.deleteModule(t),e()}catch(e){console.log(e),i(a.delete.errors[e.code.toString()]??a.delete.errors.default)}finally{s(!1)}},variant:"primary"},o.actions.confirm)),c.createElement(m.ProcessContainer,{fetching:n}))};var c=e("react"),d=e("pragmate-ui/modal"),u=e("pragmate-ui/components"),m=e("@aimpact/ailearn-app/components/ui"),p=e("../../context")}}),M.set("./views/item/module/module",{hash:2048369212,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Item=function({item:e}){let{texts:t,store:a,store:{globalTexts:n}}=(0,g.useListContext)(),[,s]=m.useState(e.getProperties()),[r,i]=m.useState(!1),[l,o]=m.useState(!1),[c,d]=m.useState(!1),u=((0,f.useBinder)([e],()=>{globalThis.item=e,s(e.getProperties())}),()=>d(!c));return m.createElement(m.Fragment,null,m.createElement(h.ModuleCard,{item:e,texts:t,actions:{delete:()=>{console.log("delete")}}},m.createElement(h.ModuleCardFooter,{item:e},m.createElement("div",{className:"flex-container gap-05"},m.createElement(y.Button,{variant:"primary",bordered:!0,onClick:()=>i(!0)},t.actions.use),m.createElement(y.Button,{variant:"primary",onClick:e=>{e.stopPropagation(),o(!0)}},t.actions.assign)),m.createElement("div",{className:"flex-container gap-05"},m.createElement(v.IconButton,{icon:"delete",title:n.actions.delete,onClick:u})))),l&&m.createElement(p.ModuleAssignments,{item:e,onClose:()=>o(!l),texts:t.assign}),r&&m.createElement(b.OwnerAssignForm,{item:e,onClose:()=>i(!r),texts:t.assign}),c&&m.createElement(x.DeleteItemModal,{store:a,item:e,onClose:u,texts:t}))};var m=e("react"),p=e("@aimpact/ailearn-app/modules/assign"),f=e("@beyond-js/react-18-widgets/hooks"),g=e("../../context"),h=e("@aimpact/ailearn-app/components/module-card"),y=e("pragmate-ui/components"),b=e("@aimpact/ailearn-app/modules/owner-assign.code"),v=e("pragmate-ui/icons"),x=e("./delete")}}),M.set("./views/item/status",{hash:3172238619,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({synthesis:e,relevance:t,assessment:a}){var n=(0,i.useListContext)().texts,s=e=>l[e]??"red";return r.default.createElement("section",{className:"statuses"},r.default.createElement("div",{className:"status"},r.default.createElement("div",null,r.default.createElement("div",{className:"status-circle "+s(t?.status)}),r.default.createElement("h5",null,n.classes.elements.relevance)),r.default.createElement("div",null,r.default.createElement("div",{className:"status-circle "+s(e?.status)}),r.default.createElement("h5",null,n.classes.elements.synthesis)),r.default.createElement("div",null,r.default.createElement("div",{className:"status-circle "+s(a?.status)}),r.default.createElement("h5",null,n.classes.elements.assessment))))};var r=e("react"),i=e("../context");let l={ready:"green",processing:"yellow"}}}),M.set("./views/item/title",{hash:2842038646,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({item:e}){var t=(0,r.useListContext)().texts,a=e.title??e.objective,t=e.description??t.item.description;return n.default.createElement("section",null,n.default.createElement(s.Link,{href:"/modules/management?id="+e.id},n.default.createElement("h4",null,a)),n.default.createElement("span",null,t))};var n=e("react"),s=e("pragmate-ui/components"),r=e("../context")}}),M.set("./views/list/index",{hash:40682162,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.List=function({}){let{texts:e,store:s}=(0,l.useListContext)(),r=["draft","published"],t=r.indexOf(s.tab),[a,i]=n.default.useState(t);return n.default.createElement(n.default.Fragment,null,n.default.createElement(o.TabsContainer,{onChange:(e,t)=>{var a=new URLSearchParams(globalThis.location.search),n=r[t];a.set("tab",n),u.routing.replaceState({},document.title,"/modules/list?"+a.toString()),i(t),s.load(n)},active:a},n.default.createElement(o.Tabs,{className:"module-list__tabs"},n.default.createElement(o.Tab,null,e.tabs.drafts),n.default.createElement(o.Tab,null,e.tabs.published)),n.default.createElement(o.Panes,{className:"module-list__panes"},n.default.createElement(c.ManageList,{className:"module-list",name:"draft",collection:s.draft,control:m.ItemDrafts,preventMessage:e.empty.drafts,loadingMessage:e.loading}),n.default.createElement(c.ManageList,{collection:s.modules,name:"modules",control:d.Item,className:"module-list",preventMessage:e.empty.published,loadingMessage:e.loading}))))};var n=e("react"),l=e("../context"),o=e("pragmate-ui/tabs"),c=e("./manage-list"),d=e("../item/module/module"),u=e("@beyond-js/kernel/routing"),m=e("../item/drafts")}}),M.set("./views/list/manage-list",{hash:683784199,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ManageList=function({name:e,control:t,preventMessage:a}){let n=(0,m.useListContext)().store;if(!n[e])throw new Error(`The store ${e} is not defined`);let s=n[e],[r,i]=l.useState({items:s.items,fetching:s.fetching,total:s.items?.length});return(0,d.useBinder)([n[e]],()=>{i({...r,items:n[e].items,fetching:n[e].fetching,total:n[e].items?.length})}),!r.fetching||r.total?n[e].items?.length||n[e].fetching?l.createElement(l.Fragment,null,l.createElement(o.List,{className:"entity__list mt-15",items:n[e].items,control:t})):l.createElement(c.EmptyCard,{text:a.title,description:a.description,icon:"info"}):l.createElement(u.Empty,{className:"loading-list-page"},l.createElement(c.AppLoader,{fetching:!0}))};var l=e("react"),o=e("pragmate-ui/list"),c=e("@aimpact/ailearn-app/components/ui"),d=e("@beyond-js/react-18-widgets/hooks"),u=e("pragmate-ui/empty"),m=e("../context")}}),_.exports.descriptor=[{im:"./controller",from:"Controller",name:"Controller"},{im:"./views/index",from:"View",name:"View"}],_.exports.process=function({require:e,prop:t,value:a}){!e&&"Controller"!==t||n("Controller",e?e("./controller").Controller:a),!e&&"View"!==t||n("View",e?e("./views/index").View:a)},n("__beyond_pkg",_),n("hmr",new function(){this.on=(e,t)=>_.hmr.on(e,t),this.off=(e,t)=>_.hmr.off(e,t)}),_.initialise(M)}}});