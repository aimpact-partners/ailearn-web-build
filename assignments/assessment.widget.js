System.register(["@beyond-js/widgets@1.1.0/render","@beyond-js/kernel@0.1.9/bundle","@beyond-js/react-18-widgets@1.1.2/page","@aimpact/ailearn-app@0.1.6-dev.33/main-layout.widget","@beyond-js/reactive@1.2.0/model","@beyond-js/kernel@0.1.9/texts","@aimpact/ailearn-sdk@1.0.0/tracking","react@18.2.0","@aimpact/ailearn-app@0.1.6-dev.33/components/ui","@beyond-js/react-18-widgets@1.1.2/hooks","pragmate-ui@1.0.0-beta.6/form","pragmate-ui@1.0.0-beta.6/icons","pragmate-ui@1.0.0-beta.6/components","pragmate-ui@1.0.0-beta.6/alert","@beyond-js/kernel@0.1.9/styles"],function(n,e){"use strict";var t,s,r,a,o,i,l,c,u,d,m,f,p,v,g,h,y;return n({Controller:void 0,View:void 0,Form:void 0,SelectionForm:void 0,Selection:void 0,Results:void 0}),{setters:[function(e){t=e},function(e){s=e},function(e){r=e},function(e){a=e},function(e){o=e},function(e){i=e},function(e){l=e},function(e){c=e},function(e){u=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){p=e},function(e){v=e},function(e){g=e}],execute:function(){y=s.Bundle,(h=new y({module:{vspecifier:"@aimpact/ailearn-app@0.1.6-dev.33/assignments/assessment",multibundle:!0},type:"widget"},e.meta.url).package()).dependencies.update([["@beyond-js/widgets/render",t],["@beyond-js/react-18-widgets/page",r],["@aimpact/ailearn-app/main-layout.widget",a],["@beyond-js/reactive/model",o],["@beyond-js/kernel/texts",i],["@aimpact/ailearn-sdk/tracking",l],["react",c],["@aimpact/ailearn-app/components/ui",u],["@beyond-js/react-18-widgets/hooks",d],["pragmate-ui/form",m],["pragmate-ui/icons",f],["pragmate-ui/components",p],["pragmate-ui/alert",v],["@beyond-js/kernel/styles",g]]),brequire("@beyond-js/widgets/render").widgets.register([{name:"ailearn-assignments-assessment",vspecifier:"@aimpact/ailearn-app@0.1.6-dev.33/assignments/assessment.widget",is:"page",route:"/assignments/${assignmentId}/assessment/${id}",layout:"main-layout"}]),brequire("@beyond-js/kernel/styles").styles.register("@aimpact/ailearn-app@0.1.6-dev.33/assignments/assessment.widget"),(y=new Map).set("./controller",{hash:3196055500,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0;var s=e("@beyond-js/react-18-widgets/page"),n=e("./store"),r=e("./views");class a extends s.PageReactWidgetController{#store;#assignmentId;#activityId;createStore(){return this.#store=new n.StoreManager,this.#store}get Widget(){return r.View}show(){this.#store.load(this.uri.vars.get("assignmentId"),this.uri.vars.get("id"))}hide(){}}t.Controller=a}}),y.set("./helpers/get-form-data",{hash:187723676,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getFormData=void 0,t.getFormData=e=>{const t={};return Array.from(e.elements).forEach(e=>{e.name&&("checkbox"===e.type?t[e.name]=e.checked:"radio"===e.type&&!e.checked||(t[e.name]=e.value))}),t}}}),y.set("./store",{hash:3437092998,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StoreManager=void 0;var r=e("@aimpact/ailearn-app/main-layout.widget"),s=e("@beyond-js/reactive/model"),n=e("@beyond-js/kernel/texts"),a=e("beyond_context"),o=e("@aimpact/ailearn-sdk/tracking");class i extends s.ReactiveModel{#model;#activityId;get model(){return this.#model}#items;get items(){return this.#items}#assignmentId;get assignmentId(){return this.#assignmentId}#paramsUri;get paramsUri(){return this.#paramsUri}#answers=new Map;get answers(){return this.#answers}#texts=new n.CurrentTexts(a.module.specifier);get texts(){return this.#texts?.value}get ready(){return super.ready&&this.#texts.ready}#found;get found(){return this.#found}get canConsumeCredits(){return this.#found}#tracking;get tracking(){return this.#tracking}constructor(){super(),this.assignmentId||(this.#assignmentId=this.sessionId),this.#texts.on("change",this.triggerEvent)}async load(e,t){try{var s,n;r.LayoutBroker.overlay=!0,r.LayoutBroker.canConsumeCredits=!0,e===this.#assignmentId&&this.#activityId===t?r.LayoutBroker.addModel(this.#tracking):(this.#assignmentId=e,this.#activityId=t,s=o.Tracking.get({assignmentId:e}),n=await(this.#tracking=s).activities.load({id:t}),this.#model=n,r.LayoutBroker.addModel(this.#tracking),super.ready=!0,this.#found=!0,this.triggerEvent())}catch(e){super.ready=!0,this.#found=!1,r.LayoutBroker.canConsumeCredits=!1}}setAnswer(e,t){this.#answers.set(e,t),this.trigger("set.answer")}async save(e){super.ready=!1,e={answers:e,assignmentId:this.assignmentId,activityId:this.#activityId},await this.model.publish({params:e,type:"assessment"}),super.ready=!0}}t.StoreManager=i}}),y.set("./views/context",{hash:4165182190,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useAssessmentContext=t.AssessmentContext=void 0;var s=e("react");const n=t.AssessmentContext=s.default.createContext({});t.useAssessmentContext=()=>s.default.useContext(n)}}),y.set("./views/index",{hash:2998685036,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.View=function({store:e}){const[t,s]=(0,i.useState)(e.ready),n=e.texts;var r,a;return(0,l.useBinder)([e],()=>s(e.ready)),t&&!e.found?i.default.createElement("app-missing",null):t?(r=e.model["assessment"],a={texts:n,fetching:e.fetching,store:e},i.default.createElement(c.AssessmentContext.Provider,{value:a},i.default.createElement(o.ActivityHeader,{title:e.model.title,icon:"multiple-choice",type:e.model.type}),i.default.createElement(o.PageContainer,null,i.default.createElement(u.Selection,{assessments:r})))):i.default.createElement(o.PageLoader,{fetching:!0})};var o=e("@aimpact/ailearn-app/components/ui"),i=e("react"),l=e("@beyond-js/react-18-widgets/hooks"),c=e("./context"),u=e("./selection")}}),y.set("./views/selection/form/Input",{hash:489088116,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.InputControl=void 0,t.RadioInput=m;var c=e("react"),u=e("pragmate-ui/form"),d=e("../interfaces/answer"),r=e("pragmate-ui/icons"),a=e("./controls/form-context");function m({selected:e,index:t,label:s,onChange:n}){var{}=(0,a.useFormContext)();return c.default.createElement("div",{className:"item__option"+(e===t?" selected":""),onClick:e=>{n(e)}},s,e===t&&c.default.createElement(r.Icon,{icon:"circle-check"}))}t.InputControl=({index:e,done:t,selected:s,value:n,option:r,name:a,isMultiple:o,onChange:i})=>{let l=o?u.CheckBox:m;return t&&(l=d.Answer),c.default.createElement(l,{label:r,selected:s,value:n,name:a,index:e,onChange:i,required:!0})}}}),y.set("./views/selection/form/controls/form-context",{hash:1804000310,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useFormContext=t.FormContext=void 0;var s=e("react");const n=t.FormContext=s.default.createContext({});t.useFormContext=()=>s.default.useContext(n)}}),y.set("./views/selection/form/controls/index",{hash:1895905073,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Form=function(e){e.fetching;var[,,]=s.default.useState(!1);return s.default.useRef(null),e.store?.answers.size,null};var s=e("react")}}),y.set("./views/selection/form/controls/is-ready-function",{hash:3877003488,creator:function(e,t){}}),y.set("./views/selection/form/controls/submit-button",{hash:1795831310,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SubmitButton=function(e){const t=e.store,[,s]=o.default.useState(!t.isValid),n=((0,i.useBinder)([t],()=>{s(!t.isValid)},"set.answer"),e.children),r={...e};return r.disabled=e.disabled,delete r.children,o.default.createElement(a.Button,{...r},n)};var a=e("pragmate-ui/components"),o=e("react"),i=e("@beyond-js/react-18-widgets/hooks")}}),y.set("./views/selection/form/index",{hash:861037594,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionForm=function({assessments:e}){const{store:n,texts:t}=(0,y.useAssessmentContext)(),[,r]=g.default.useState(""),[s,a]=g.default.useState(n.answers.size),[o,i]=g.default.useState(!1),l=g.default.useRef(null),[c,u]=g.default.useState(!1),d={disabled:n.answers.size!==e.questions.length},m=((0,w.useBinder)([n],()=>{a(n.answers.size),n.answers.size===e.questions.length&&u(!0)},"set.answer"),e.questions.map((e,t)=>g.default.createElement(v.Question,{key:t,index:t,question:e,store:n}))),f={isValid:c,totalAnswered:s,fetching:o,store:n};return g.default.createElement(p.FormContext.Provider,{value:f},g.default.createElement("form",{onSubmit:async e=>{e.preventDefault(),e.stopPropagation();try{e.preventDefault(),i(!0),e.target;const s={};n.answers.forEach((e,t)=>{s[t]=e}),await n.save(s)}catch(e){r(e.message)}finally{i(!1)}},className:"assessment__container",ref:l},m,g.default.createElement("footer",{className:"assessment__footer"},g.default.createElement(h.SubmitButton,{store:n,...d,variant:"primary",type:"submit"},t?.finish))))};var p=e("./controls/form-context"),v=e("./question"),g=e("react"),h=e("./controls/submit-button"),y=e("../../context"),w=e("@beyond-js/react-18-widgets/hooks")}}),y.set("./views/selection/form/question",{hash:3269473002,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Question=void 0;var i=e("react"),l=e("./Input");t.Question=({question:t,index:r,store:a})=>{const[s,o]=i.default.useState();var e=t.options.map((e,n)=>i.default.createElement(l.InputControl,{key:r+"."+n,value:""+n,option:e,selected:s,name:r,index:n,questionIndex:r,isMultiple:t.isMultiple,onChange:e=>{var t=r,s=n;e.stopPropagation(),a.setAnswer(t,s),o(s)}}));return i.default.createElement("div",{className:"question__form-container"},i.default.createElement("h3",{className:"question-title"},t.question),e)}}}),y.set("./views/selection/index",{hash:2276256325,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Selection=function({assessments:e}){var[,t]=(0,c.useTexts)(i.module.specifier),s=(0,l.useAssessmentContext)().store,n=s.model?.data?"results":"form",s={results:a.Results,form:o.SelectionForm}[s?.model.resources.materials.assessment.selection||n];return r.default.createElement(s,{assessments:e,texts:t})};var r=e("react"),a=e("./results"),o=e("./form"),i=e("beyond_context"),l=e("../context"),c=e("@beyond-js/react-18-widgets/hooks")}}),y.set("./views/selection/interfaces/answer",{hash:1239399579,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Answer=function({option:e}){return s.default.createElement("div",{className:"flex-container flex-space-between"},s.default.createElement("span",null,e))};var s=e("react")}}),y.set("./views/selection/interfaces/questions",{hash:4168001512,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),y.set("./views/selection/interfaces/selection-props",{hash:3118408654,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}),y.set("./views/selection/results/index",{hash:1841192681,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Results=void 0;var n=e("pragmate-ui/alert"),o=e("react"),r=e("../../context");t.Results=({assessments:e})=>{var{store:t,texts:s}=(0,r.useAssessmentContext)();const a=t.model.data;return t=a.counters,e=e.questions.map((n,e)=>{let r=a?.answers?a.answers:a?.responses;return r=r[e],e=n.options.map((e,t)=>{let s=`option-item${r.answer===t?" option--selected":""} `;return r.answer===t&&(s+="option"+(r.accuracy?" option--correct":" option--wrong")),n.correctAnswer===t&&(s+=" option--correct"),o.default.createElement("div",{key:e,className:s},o.default.createElement("span",null,e))}),o.default.createElement("div",{key:n.question,className:"question__container question__container--results"},o.default.createElement("h3",{className:"question-title"},n.question),e)}),o.default.createElement("div",{key:"",className:"assessment__container"},o.default.createElement(n.Alert,{type:"info"},o.default.createElement("div",{className:"flex-container flex-100 flex-space-between"},o.default.createElement("strong",null,s.correct,":"),o.default.createElement("section",null,o.default.createElement("span",null,t.correct),"/",o.default.createElement("span",null,t.total)))),e)}}}),h.exports.descriptor=[{im:"./controller",from:"Controller",name:"Controller"},{im:"./views/index",from:"View",name:"View"},{im:"./views/selection/form/controls/index",from:"Form",name:"Form"},{im:"./views/selection/form/index",from:"SelectionForm",name:"SelectionForm"},{im:"./views/selection/index",from:"Selection",name:"Selection"},{im:"./views/selection/results/index",from:"Results",name:"Results"}],h.exports.process=function({require:e,prop:t,value:s}){!e&&"Controller"!==t||n("Controller",e?e("./controller").Controller:s),!e&&"View"!==t||n("View",e?e("./views/index").View:s),!e&&"Form"!==t||n("Form",e?e("./views/selection/form/controls/index").Form:s),!e&&"SelectionForm"!==t||n("SelectionForm",e?e("./views/selection/form/index").SelectionForm:s),!e&&"Selection"!==t||n("Selection",e?e("./views/selection/index").Selection:s),!e&&"Results"!==t||n("Results",e?e("./views/selection/results/index").Results:s)},n("__beyond_pkg",h),n("hmr",new function(){this.on=(e,t)=>h.hmr.on(e,t),this.off=(e,t)=>h.hmr.off(e,t)}),h.initialise(y)}}});