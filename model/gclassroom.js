System.register(["@beyond-js/kernel@0.1.9/bundle","@beyond-js/reactive@1.2.0/model","@aimpact/ailearn-app@0.1.6-dev.29/model/wrapper","@aimpact/http-suite@0.0.1/api","@beyond-js/kernel@0.1.9/core","@aimpact/ailearn-app@0.1.6-dev.29/config","dayjs@1.11.13","@aimpact/chat-sdk@1.1.0/session"],function(t,e){"use strict";var s,r,a,i,o,n,c,p,l,h;return t("gclassroom",void 0),{setters:[function(e){s=e},function(e){r=e},function(e){a=e},function(e){i=e},function(e){o=e},function(e){n=e},function(e){c=e},function(e){p=e}],execute:function(){h=s.Bundle,(l=new h({module:{vspecifier:"@aimpact/ailearn-app@0.1.6-dev.29/model/gclassroom"},type:"ts"},e.meta.url).package()).dependencies.update([["@beyond-js/reactive/model",r],["@aimpact/ailearn-app/model/wrapper",a],["@aimpact/http-suite/api",i],["@beyond-js/kernel/core",o],["@aimpact/ailearn-app/config",n],["dayjs",c],["@aimpact/chat-sdk/session",p]]),(h=new Map).set("./class",{hash:956808558,creator:function(e,s){Object.defineProperty(s,"__esModule",{value:!0}),s.GClass=void 0;class r extends e("@beyond-js/reactive/model").ReactiveModel{#course;#name;get name(){return this.#name}#code;get code(){return this.#code}#section;get section(){return this.#section}get id(){return this.#course.id}constructor(e){super(),this.#course=e,this.#init()}#init(){this.#name=this.#course.name,this.#section=this.#course.section}}s.GClass=r}}),h.set("./index",{hash:1292236012,creator:function(e,s){Object.defineProperty(s,"__esModule",{value:!0}),s.gclassroom=s.GClassRoom=void 0;var r=e("@aimpact/ailearn-app/model/wrapper"),t=e("@aimpact/http-suite/api"),a=e("./class"),i=e("@beyond-js/kernel/core"),o=e("@beyond-js/reactive/model"),n=e("@aimpact/ailearn-app/config"),c=e("dayjs"),p=e("@aimpact/chat-sdk/session");class l extends o.ReactiveModel{#promise;#url;#MAX_TIME=3e5;#state;get state(){return this.#state}#code;get code(){return this.#code}get isReady(){return this.#promise}#api;#lastClassesQueryTime;get lastClassesQueryTime(){return this.#lastClassesQueryTime}#error;get error(){return this.#error}#authorized;#processedCallback;get processedCallback(){return this.#processedCallback}get authorized(){return this.#authorized}#classes=new Map;get classes(){return this.#classes}constructor(){super();var e=new t.Api(n.default.params.apis.ailearn);this.#api=e,p.sessionWrapper.on("login",this.onLogin.bind(this))}onLogin(){}async checkPermissions(){try{var e=await this.#api.bearer(p.sessionWrapper.user.token).get("/gclassroom/me");if("error"!==e.status)return e.data.verifiedTeacher;this.#error=e.error}catch(e){console.error(e)}}async#init(){try{var e;if(this.#promise=new i.PendingPromise,await p.sessionWrapper.isReady,!p.sessionWrapper.logged)return p.sessionWrapper.on("change",()=>{p.sessionWrapper.ready&&this.#promise.resolve(!0)}),this.triggerEvent(),this.#promise;e=await this.#api.bearer(p.sessionWrapper.user.token).get("/gclassroom/oauth/authorized"),this.#authorized=e.data.authorized,this.#promise.resolve(!0),r.AiLearnWrapper.isTeacher=!1,this.triggerEvent()}catch(e){console.error(e)}finally{this.ready=!0,this.#promise.resolve(!0)}}async getUrl(){try{var e=await this.#api.bearer(p.sessionWrapper.user.token).get("/gclassroom/oauth/url");if(e.status)return e.data.url;throw new Error(e.error)}catch(e){throw new Error("ERROR_GETTING_URL")}}async callback(e,s){try{this.#state=e,this.#code=s,this.fetching=!0;var r=await this.#api.get("/gclassroom/oauth/callback",{bearer:p.sessionWrapper.user.token,state:e,code:s});"error"===r.status?this.#error=r.error:(this.#authorized=!0,this.#processedCallback=!0,this.triggerEvent())}catch(e){console.trace(e)}finally{this.fetching=!1}}async courses(){try{this.fetching=!0;var e=await this.#api.get("/gclassroom/courses",{bearer:p.sessionWrapper.user.token,id:p.sessionWrapper.user.id});return"error"===e.status?(this.#error=e.error,[]):(e.courses.forEach(e=>{var s=new a.GClass(e);this.#classes.set(e.id,s)}),this.#lastClassesQueryTime=(0,c.default)(),this.#classes)}catch(e){console.error(e)}finally{this.fetching=!1}}}s.GClassRoom=l,s.gclassroom=new l}}),l.exports.descriptor=[{im:"./index",from:"gclassroom",name:"gclassroom"}],l.exports.process=function({require:e,prop:s,value:r}){!e&&"gclassroom"!==s||t("gclassroom",e?e("./index").gclassroom:r)},t("__beyond_pkg",l),t("hmr",new function(){this.on=(e,s)=>l.hmr.on(e,s),this.off=(e,s)=>l.hmr.off(e,s)}),l.initialise(h)}}});