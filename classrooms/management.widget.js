System.register(["@beyond-js/widgets@1.1.0/render","@beyond-js/kernel@0.1.9/bundle","@beyond-js/kernel@0.1.9/styles","@beyond-js/react-18-widgets@1.1.2/page","@aimpact/ailearn-sdk@1.0.0/entities/classrooms","@beyond-js/reactive@1.2.0/model","@aimpact/chat-sdk@1.3.0/session","@beyond-js/kernel@0.1.9/texts","react@18.2.0","pragmate-ui@1.0.0-beta.6/toast","@beyond-js/kernel@0.1.9/routing","@beyond-js/react-18-widgets@1.1.2/hooks","pragmate-ui@1.0.0-beta.6/form","pragmate-ui@1.0.0-beta.6/components","@aimpact/ailearn-app@0.1.13/components/ui","pragmate-ui@1.0.0-beta.6/form/react-select"],function(a,e){var t,r,n,o,s,i,l,c,u,d,m,p,g,h,f,v,y,b;return a("Controller",void 0),{setters:[function(e){t=e},function(e){r=e},function(e){n=e},function(e){o=e},function(e){s=e},function(e){i=e},function(e){l=e},function(e){c=e},function(e){u=e},function(e){d=e},function(e){m=e},function(e){p=e},function(e){g=e},function(e){h=e},function(e){f=e},function(e){v=e}],execute:function(){b=r.Bundle,(y=new b({module:{vspecifier:"@aimpact/ailearn-app@0.1.13/classrooms/management",multibundle:!0},type:"widget"},e.meta.url).package()).dependencies.update([["@beyond-js/widgets/render",t],["@beyond-js/kernel/styles",n],["@beyond-js/react-18-widgets/page",o],["@aimpact/ailearn-sdk/entities/classrooms",s],["@beyond-js/reactive/model",i],["@aimpact/chat-sdk/session",l],["@beyond-js/kernel/texts",c],["react",u],["pragmate-ui/toast",d],["@beyond-js/kernel/routing",m],["@beyond-js/react-18-widgets/hooks",p],["pragmate-ui/form",g],["pragmate-ui/components",h],["@aimpact/ailearn-app/components/ui",f],["pragmate-ui/form/react-select",v]]),brequire("@beyond-js/widgets/render").widgets.register([{name:"app-classrooms-management",vspecifier:"@aimpact/ailearn-app@0.1.13/classrooms/management.widget",is:"page",route:"/classrooms/management",layout:"main-layout"}]),brequire("@beyond-js/kernel/styles").styles.register("@aimpact/ailearn-app@0.1.13/classrooms/management.widget"),(b=new Map).set("./controller",{hash:940274451,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0;var r=e("@beyond-js/react-18-widgets/page"),a=e("./store"),n=e("./views");class o extends r.PageReactWidgetController{#store;createStore(){return this.#store=new a.StoreManager,this.#store}get Widget(){return n.View}show(){this.#store.load(this.uri.qs.get("id"))}hide(){this.#store.clear()}}t.Controller=o}}),b.set("./store",{hash:2075719461,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StoreManager=void 0;var r=e("@aimpact/ailearn-sdk/entities/classrooms"),a=e("@beyond-js/reactive/model"),n=e("@aimpact/chat-sdk/session"),o=e("@beyond-js/kernel/texts"),s=e("beyond_context");class i extends a.ReactiveModel{#model;get model(){return this.#model}get user(){return n.sessionWrapper.user}#texts=new o.CurrentTexts(s.module.specifier);get texts(){return this.#texts?.value}get ready(){return super.ready&&this.#texts.ready}constructor(){super(),this.#texts.on("change",this.triggerEvent)}clear(){this.#model=void 0,super.ready=!1}async load(e){try{var t;super.ready=!1,e&&this.#model&&this.#model.id===e||(t=()=>this.triggerEvent(),this.#model&&(this.#model.off("change",t),this.#model=void 0),this.#model=new r.Classroom({id:e}),this.#model.on("change",t),e&&await this.#model.load())}catch(e){console.error(e)}finally{super.ready=!0}}async delete(e){this.#model.classrooms.remove(e),this.trigger("change")}}t.StoreManager=i}}),b.set("./views/context",{hash:952274567,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useModuleContext=t.ModuleContext=void 0;var r=e("react");let a=t.ModuleContext=r.createContext({});t.useModuleContext=()=>r.useContext(a)}}),b.set("./views/events",{hash:2413272433,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useForm=function(e,t,r){let a={name:t?.model?.name||"",description:t?.model?.description||""},[n,o]=d.useState(a),[s,i]=d.useState(!1),[l,c]=d.useState("");if((0,g.useBinder)([t],()=>{t.ready||o(t.model?.getProperties()||a)}),!e)return{};let u=t.model;return{values:n,fetching:s,error:l,setFetching:i,onChange:({currentTarget:e})=>{var t={...n};t[e.name]=e.value,o(t),c("")},onSubmit:async e=>{e.preventDefault(),e.stopPropagation(),i(!0);try{await u.publish(n),m.toast.success(r.create.success),p.routing.replaceState({},null,"/classrooms/view/"+u.id)}catch(e){console.error(e),c(r.errors.default)}finally{i(!1)}},setValues:o}};var d=e("react"),m=e("pragmate-ui/toast"),p=e("@beyond-js/kernel/routing"),g=e("@beyond-js/react-18-widgets/hooks")}}),b.set("./views/index",{hash:3215304630,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.View=function({store:e}){var{ready:t,texts:r}=(0,g.useModel)(e),{fetching:a,values:n,onChange:o,onSubmit:s,setValues:i,error:l}=(0,h.useForm)(t,e,r);return t?(t={disabled:a||""===n.name},c.createElement(p.ModuleContext.Provider,{value:e={texts:r,store:e}},c.createElement(m.PageContainer,{className:"form-page-container",fetching:a},c.createElement("header",{className:"page__header"},c.createElement("h3",null,r.create.title)),c.createElement(m.ErrorRenderer,{error:l,texts:r.errors}),c.createElement(u.Form,{onSubmit:s,className:"form__container"},c.createElement(f.OwnershipField,{setValues:i,values:n}),c.createElement(u.Input,{label:r.create.name.label,placeholder:r.create.name.placeholder,value:n.name,name:"name",type:"text",onChange:o,required:!0}),c.createElement(u.Textarea,{label:r.create.description.label,name:"description",value:n.description,placeholder:r.create.description.placeholder,onChange:o}),c.createElement("div",{className:"form__footer"},c.createElement(d.Button,{fetching:a,...t,variant:"primary",type:"submit"},r.create.actions.save)))))):null};var c=e("react"),u=e("pragmate-ui/form"),d=e("pragmate-ui/components"),m=e("@aimpact/ailearn-app/components/ui"),p=e("./context"),g=e("./use-model"),h=e("./events"),f=e("./ownership")}}),b.set("./views/ownership",{hash:724679060,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.OwnershipField=function({setValues:e,values:t}){let{store:r,texts:a}=(0,l.useModuleContext)();var n,o;return r.user.teacher?.orgs?(n={value:"",label:a.institution.select},o=[...r.user.teacher.orgs.map(e=>({value:e.id,label:e.name})),{value:r.user.id,label:a.institution.own}],s.createElement("div",null,s.createElement("label",{htmlFor:""},a.institution.label," *"),s.createElement(i.ReactSelect,{value:t.owner,defaultOption:n,placeholder:a.institution.select,name:"owner",options:o,onChange:({currentTarget:t})=>{t.value===r.user.id?e(e=>({...e,owner:r.user.id})):e(e=>({...e,owner:t.value,organizationId:t.value}))}}))):null};var s=e("react"),i=e("pragmate-ui/form/react-select"),l=e("./context")}}),b.set("./views/use-model",{hash:347815426,creator:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useModel=function(t){let[e,r]=a.useState(t.ready);return a.useEffect(()=>{let e=()=>{r(t.ready)};return t.on("change",e),()=>t.off("change",e)}),{ready:e,store:t,texts:t?.texts}};var a=e("react")}}),y.exports.descriptor=[{im:"./controller",from:"Controller",name:"Controller"}],y.exports.process=function({require:e,prop:t,value:r}){!e&&"Controller"!==t||a("Controller",e?e("./controller").Controller:r)},a("__beyond_pkg",y),a("hmr",new function(){this.on=(e,t)=>y.hmr.on(e,t),this.off=(e,t)=>y.hmr.off(e,t)}),y.initialise(b)}}});